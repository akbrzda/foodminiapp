# –û—Ç—á–µ—Ç –ø–æ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å iiko –∏ PremiumBonus

**–î–∞—Ç–∞:** 13 —Ñ–µ–≤—Ä–∞–ª—è 2026 –≥.  
**–°—Ç–∞—Ç—É—Å:** –ê–Ω–∞–ª–∏–∑ —Ç–µ–∫—É—â–µ–π —Å–∏—Å—Ç–µ–º—ã –∏ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏  
**–í–µ—Ä—Å–∏—è:** 1.0

---

## üìã –û–≥–ª–∞–≤–ª–µ–Ω–∏–µ

1. [–û–±—â–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è](#–æ–±—â–∞—è-–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è)
2. [–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã](#—Ç–µ–∫—É—â–µ–µ-—Å–æ—Å—Ç–æ—è–Ω–∏–µ-—Å–∏—Å—Ç–µ–º—ã)
3. [–ê–Ω–∞–ª–∏–∑ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å iiko](#–∞–Ω–∞–ª–∏–∑-–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏-—Å-iiko)
4. [–ê–Ω–∞–ª–∏–∑ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å PremiumBonus](#–∞–Ω–∞–ª–∏–∑-–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏-—Å-premiumbonus)
5. [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è](#–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ-—Ä–µ—à–µ–Ω–∏—è)
6. [–ß—Ç–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –¥–æ—Ä–∞–±–æ—Ç–∞—Ç—å](#—á—Ç–æ-–Ω–µ–æ–±—Ö–æ–¥–∏–º–æ-–¥–æ—Ä–∞–±–æ—Ç–∞—Ç—å)
7. [–õ–∏—à–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏](#–ª–∏—à–Ω–∏–µ-—Ñ—É–Ω–∫—Ü–∏–∏-–≤-–∫–æ–Ω—Ç–µ–∫—Å—Ç–µ-–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏)
8. [–ù–µ–¥–æ—Å—Ç–∞—é—â–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏](#–Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ-—Ñ—É–Ω–∫—Ü–∏–∏)
9. [–ü–æ—ç—Ç–∞–ø–Ω—ã–π –ø–ª–∞–Ω –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏](#–ø–æ—ç—Ç–∞–ø–Ω—ã–π-–ø–ª–∞–Ω-–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏)
10. [–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –º–æ–º–µ–Ω—Ç—ã –∏ —Ä–∏—Å–∫–∏](#–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ-–º–æ–º–µ–Ω—Ç—ã-–∏-—Ä–∏—Å–∫–∏)

---

## 1. –û–±—â–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

### 1.1 –¶–µ–ª—å –æ—Ç—á–µ—Ç–∞

–ü—Ä–æ–≤–µ—Å—Ç–∏ –ø–æ–ª–Ω—ã–π –∞–Ω–∞–ª–∏–∑ —Ç–µ–∫—É—â–µ–π —Å–∏—Å—Ç–µ–º—ã FoodMiniApp –∏ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å:

- **iiko** ‚Äî —Å–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ä–µ—Å—Ç–æ—Ä–∞–Ω–æ–º (–º–µ–Ω—é, –∑–∞–∫–∞–∑—ã, —Å–∫–ª–∞–¥—Å–∫–æ–π —É—á–µ—Ç)
- **PremiumBonus** ‚Äî —Å–∏—Å—Ç–µ–º–∞ –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–π –±–∞–∑–æ–π

### 1.2 –ü—Ä–∏–Ω—Ü–∏–ø —Ä–∞–±–æ—Ç—ã —Å–∏—Å—Ç–µ–º—ã

–°–∏—Å—Ç–µ–º–∞ –¥–æ–ª–∂–Ω–∞ —Ä–∞–±–æ—Ç–∞—Ç—å –≤ **–¥–≤—É—Ö —Ä–µ–∂–∏–º–∞—Ö**:

- **–ê–≤—Ç–æ–Ω–æ–º–Ω—ã–π —Ä–µ–∂–∏–º** ‚Äî –±–µ–∑ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π, –∏—Å–ø–æ–ª—å–∑—É—è —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—É—é –ë–î (–ø–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—é)
- **–†–µ–∂–∏–º —Å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π** ‚Äî —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å iiko (–º–µ–Ω—é, –∑–∞–∫–∞–∑—ã) –∏ PremiumBonus (–∫–ª–∏–µ–Ω—Ç—ã, –±–æ–Ω—É—Å—ã)

**–í–∞–∂–Ω—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∂–∏–º–∞ —Å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π:**

1. **–ü—Ä–∏ –≤–∫–ª—é—á–µ–Ω–∏–∏ iiko**:
   - –õ–æ–∫–∞–ª—å–Ω—ã–µ –º–æ–¥—É–ª–∏ (–º–µ–Ω—é, —Å—Ç–æ–ø-–ª–∏—Å—Ç, –∑–æ–Ω—ã –¥–æ—Å—Ç–∞–≤–∫–∏) –ø–µ—Ä–µ—Ö–æ–¥—è—Ç –≤ —Ä–µ–∂–∏–º **"—Ç–æ–ª—å–∫–æ —á—Ç–µ–Ω–∏—è"**
   - –î–∞–Ω–Ω—ã–µ –ø–æ–ª—É—á–∞—é—Ç—Å—è –∏–∑ iiko, –Ω–æ –∏—Ö –º–æ–∂–Ω–æ —Ç–æ–ª—å–∫–æ –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å –≤ —Å–∏—Å—Ç–µ–º–µ
   - –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–æ–∑–º–æ–∂–Ω–æ —Ç–æ–ª—å–∫–æ –≤ —Å–∞–º–æ–π —Å–∏—Å—Ç–µ–º–µ iiko

2. **–ü—Ä–∏ –≤–∫–ª—é—á–µ–Ω–∏–∏ PremiumBonus**:
   - –ù–æ–≤—ã–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ Telegram ‚Üí –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ—Ç—Å—è –∫–∞—Ä—Ç–æ—á–∫–∞ –≤ PremiumBonus
   - –ï—Å–ª–∏ –∫–ª–∏–µ–Ω—Ç —É–∂–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω –≤ PremiumBonus:
     - –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ –Ω–æ–º–µ—Ä—É —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –≤—Ö–æ–¥–µ –≤ Telegram Mini App
     - –ó–∞–≥—Ä—É–∂–∞–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é –∫–∞—Ä—Ç–æ—á–∫—É –∏–∑ PremiumBonus
     - **–ù–ï –Ω–∞—á–∏—Å–ª—è–µ–º –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–µ –±–æ–Ω—É—Å—ã** (–∫–ª–∏–µ–Ω—Ç —É–∂–µ –ø–æ–ª—É—á–∏–ª –∏—Ö —Ä–∞–Ω–µ–µ)
   - –õ–æ–∫–∞–ª—å–Ω—ã–π –º–æ–¥—É–ª—å –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã–º, –≤—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –∏–¥—É—Ç —á–µ—Ä–µ–∑ PremiumBonus API

3. **–õ–æ–∫–∞–ª—å–Ω–∞—è –ë–î –∫–∞–∫ –±—É—Ñ–µ—Ä —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ (–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω–æ!)**:
   - **–í—Å–µ –¥–∞–Ω–Ω—ã–µ –≤—Å–µ–≥–¥–∞ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –ª–æ–∫–∞–ª—å–Ω–æ–π –ë–î**, –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –≤–Ω–µ—à–Ω–∏—Ö —Å–∏—Å—Ç–µ–º
   - –ü—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ iiko –∏–ª–∏ PremiumBonus:
     - –î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º `sync_status: 'pending'`
     - –°–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –±–µ–∑ —Å–±–æ–µ–≤
     - –ù–∞–∫–∞–ø–ª–∏–≤–∞–µ—Ç—Å—è –æ—á–µ—Ä–µ–¥—å –Ω–µ—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
   - –ü—Ä–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å–≤—è–∑–∏:
     - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –Ω–∞–∫–æ–ø–ª–µ–Ω–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π
     - –î–∞–Ω–Ω—ã–µ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –≤ –ø–æ—Ä—è–¥–∫–µ –æ—á–µ—Ä–µ–¥–∏
     - –°—Ç–∞—Ç—É—Å –º–µ–Ω—è–µ—Ç—Å—è –Ω–∞ `sync_status: 'synced'` –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏
   - –≠—Ç–æ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç **–±–µ—Å–ø–µ—Ä–µ–±–æ–π–Ω—É—é —Ä–∞–±–æ—Ç—É** —Å–∏—Å—Ç–µ–º—ã –∏ **–æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø–æ—Ç–µ—Ä–∏ –¥–∞–Ω–Ω—ã—Ö**

---

## 2. –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã

### 2.1 –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
FoodMiniApp
‚îú‚îÄ‚îÄ Backend (Node.js/Express)
‚îÇ   ‚îú‚îÄ‚îÄ –ú–æ–¥—É–ª—å –º–µ–Ω—é (–ø–æ–ª–Ω–æ—Å—Ç—å—é –∞–≤—Ç–æ–Ω–æ–º–Ω—ã–π)
‚îÇ   ‚îú‚îÄ‚îÄ –ú–æ–¥—É–ª—å –∑–∞–∫–∞–∑–æ–≤ (–ø–æ–ª–Ω–æ—Å—Ç—å—é –∞–≤—Ç–æ–Ω–æ–º–Ω—ã–π)
‚îÇ   ‚îú‚îÄ‚îÄ –ú–æ–¥—É–ª—å –∫–ª–∏–µ–Ω—Ç–æ–≤ (–ø–æ–ª–Ω–æ—Å—Ç—å—é –∞–≤—Ç–æ–Ω–æ–º–Ω—ã–π)
‚îÇ   ‚îú‚îÄ‚îÄ –ú–æ–¥—É–ª—å –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏ (—Å–æ–±—Å—Ç–≤–µ–Ω–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è)
‚îÇ   ‚îú‚îÄ‚îÄ –ú–æ–¥—É–ª—å –¥–æ—Å—Ç–∞–≤–∫–∏ (–≥–µ–æ–∑–æ–Ω—ã, —Ç–∞—Ä–∏—Ñ—ã)
‚îÇ   ‚îú‚îÄ‚îÄ –ú–æ–¥—É–ª—å —Ä–∞—Å—Å—ã–ª–æ–∫ (Telegram)
‚îÇ   ‚îî‚îÄ‚îÄ Background workers (BullMQ)
‚îú‚îÄ‚îÄ Admin Panel (Vue 3)
‚îú‚îÄ‚îÄ Telegram Mini App (Vue 3)
‚îî‚îÄ‚îÄ Database (MySQL 8 + PostGIS)
```

### 2.2 –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –º–æ–¥—É–ª–∏

#### –ú–æ–¥—É–ª—å –º–µ–Ω—é

- ‚úÖ –ü–æ–ª–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏, –ø–æ–∑–∏—Ü–∏—è–º–∏, –≤–∞—Ä–∏–∞–Ω—Ç–∞–º–∏
- ‚úÖ –°–∏—Å—Ç–µ–º–∞ –º–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä–æ–≤ (–≥—Ä—É–ø–ø—ã, –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ —Ü–µ–Ω—ã)
- ‚úÖ –¶–µ–Ω—ã –ø–æ –≥–æ—Ä–æ–¥–∞–º –∏ –∫–∞–Ω–∞–ª–∞–º –ø—Ä–æ–¥–∞–∂ (delivery, pickup, dine_in)
- ‚úÖ –ö–ë–ñ–£ –Ω–∞ 100–≥ –∏ –Ω–∞ –ø–æ—Ä—Ü–∏—é
- ‚úÖ –¢–µ–≥–∏, —Å—Ç–æ–ø-–ª–∏—Å—Ç, –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
- ‚úÖ –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –º–µ–Ω—é –≤ Redis

**–û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç:**

- ‚ùå –°–≤—è–∑—å —Å –≤–Ω–µ—à–Ω–∏–º–∏ ID (iiko ID)
- ‚ùå –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å –≤–Ω–µ—à–Ω–∏–º–∏ —Å–∏—Å—Ç–µ–º–∞–º–∏
- ‚ùå –ú–∞–ø–ø–∏–Ω–≥ –ø–æ–∑–∏—Ü–∏–π –º–µ–∂–¥—É FoodMiniApp –∏ iiko

#### –ú–æ–¥—É–ª—å –∑–∞–∫–∞–∑–æ–≤

- ‚úÖ –ü–æ–ª–Ω—ã–π —Ü–∏–∫–ª –∑–∞–∫–∞–∑–∞ (pending ‚Üí completed)
- ‚úÖ –†–∞—Å—á–µ—Ç —Å—Ç–æ–∏–º–æ—Å—Ç–∏ —Å —É—á–µ—Ç–æ–º –º–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä–æ–≤
- ‚úÖ –î–≤—É—Ö–∫–∞–Ω–∞–ª—å–Ω–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞ (–¥–æ—Å—Ç–∞–≤–∫–∞/—Å–∞–º–æ–≤—ã–≤–æ–∑)
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –≥–µ–æ–∑–æ–Ω–∞–º–∏ –∏ —Ç–∞—Ä–∏—Ñ–∞–º–∏
- ‚úÖ WebSocket –¥–ª—è real-time –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
- ‚úÖ –¶–∏–∫–ª–∏—á–µ—Å–∫–∏–π –Ω–æ–º–µ—Ä –∑–∞–∫–∞–∑–∞ (0001-9999)

**–û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç:**

- ‚ùå –û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–∫–∞–∑–æ–≤ –≤–æ –≤–Ω–µ—à–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã (iiko)
- ‚ùå –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å—Ç–∞—Ç—É—Å–æ–≤ —Å iiko
- ‚ùå –•—Ä–∞–Ω–µ–Ω–∏–µ –≤–Ω–µ—à–Ω–∏—Ö ID –∑–∞–∫–∞–∑–æ–≤ (iiko_order_id)
- ‚ùå Webhooks –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π –∏–∑ iiko

#### –ú–æ–¥—É–ª—å –∫–ª–∏–µ–Ω—Ç–æ–≤

- ‚úÖ –ë–∞–∑–∞ –∫–ª–∏–µ–Ω—Ç–æ–≤ —Å –ø—Ä–æ—Ñ–∏–ª—è–º–∏
- ‚úÖ Telegram ID, —Ç–µ–ª–µ—Ñ–æ–Ω, email, –¥–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è
- ‚úÖ –ê–¥—Ä–µ—Å–∞ –¥–æ—Å—Ç–∞–≤–∫–∏
- ‚úÖ –ò—Å—Ç–æ—Ä–∏—è –∑–∞–∫–∞–∑–æ–≤

**–û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç:**

- ‚ùå –°–≤—è–∑—å —Å –≤–Ω–µ—à–Ω–∏–º–∏ ID (PremiumBonus client_id)
- ‚ùå –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ø—Ä–æ—Ñ–∏–ª–µ–π —Å PremiumBonus
- ‚ùå –•—Ä–∞–Ω–µ–Ω–∏–µ external_id –¥–ª—è PremiumBonus

#### –ú–æ–¥—É–ª—å –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏ (—Å–æ–±—Å—Ç–≤–µ–Ω–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è)

- ‚úÖ –°–∏—Å—Ç–µ–º–∞ —É—Ä–æ–≤–Ω–µ–π (–ë—Ä–æ–Ω–∑–∞, –°–µ—Ä–µ–±—Ä–æ, –ó–æ–ª–æ—Ç–æ)
- ‚úÖ –ù–∞—á–∏—Å–ª–µ–Ω–∏–µ/—Å–ø–∏—Å–∞–Ω–∏–µ –±–æ–Ω—É—Å–æ–≤
- ‚úÖ –ò—Å—Ç–æ—Ä–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
- ‚úÖ –ò—Å—Ç–µ—á–µ–Ω–∏–µ –±–æ–Ω—É—Å–æ–≤
- ‚úÖ –¢—Ä–∏–≥–≥–µ—Ä–Ω—ã–µ –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è (–¥–µ–Ω—å —Ä–æ–∂–¥–µ–Ω–∏—è, —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è)

**–ü—Ä–æ–±–ª–µ–º–∞:** –ü–æ–ª–Ω–æ—Å—Ç—å—é –∫–æ–Ω—Ñ–ª–∏–∫—Ç—É–µ—Ç —Å PremiumBonus, —Ç—Ä–µ–±—É–µ—Ç—Å—è **–ø–æ–ª–Ω–∞—è –∑–∞–º–µ–Ω–∞** –Ω–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é —Å PremiumBonus.

---

## 3. –ê–Ω–∞–ª–∏–∑ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å iiko

### 3.1 –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ iiko API

iiko –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç REST API –¥–ª—è:

- **–ú–µ–Ω—é**: –ø–æ–ª—É—á–µ–Ω–∏–µ –Ω–æ–º–µ–Ω–∫–ª–∞—Ç—É—Ä—ã, –∫–∞—Ç–µ–≥–æ—Ä–∏–π, –º–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä–æ–≤, —Ü–µ–Ω
- **–ó–∞–∫–∞–∑—ã**: —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–æ–≤, –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–æ–≤, –æ—Ç–º–µ–Ω–∞
- **–°–∫–ª–∞–¥—Å–∫–æ–π —É—á–µ—Ç**: –æ—Å—Ç–∞—Ç–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤, —Å—Ç–æ–ø-–ª–∏—Å—Ç
- **–î–æ—Å—Ç–∞–≤–∫–∞**: –∑–æ–Ω—ã –¥–æ—Å—Ç–∞–≤–∫–∏, –∫—É—Ä—å–µ—Ä—ã
- **Webhooks**: —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ —Å–º–µ–Ω–µ —Å—Ç–∞—Ç—É—Å–∞ –∑–∞–∫–∞–∑–∞

### 3.2 –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∞—Å–ø–µ–∫—Ç—ã –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å iiko

#### 3.2.1 –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –º–µ–Ω—é

**–ü—Ä–æ–±–ª–µ–º–∞:**  
–¢–µ–∫—É—â–∞—è —Å–∏—Å—Ç–µ–º–∞ –∏–º–µ–µ—Ç —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –º–µ–Ω—é —Å –≤–∞—Ä–∏–∞–Ω—Ç–∞–º–∏ –∏ –º–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä–∞–º–∏, –∫–æ—Ç–æ—Ä–∞—è –º–æ–∂–µ—Ç –Ω–µ —Å–æ–≤–ø–∞–¥–∞—Ç—å —Å –Ω–æ–º–µ–Ω–∫–ª–∞—Ç—É—Ä–æ–π iiko.

**–†–µ—à–µ–Ω–∏–µ:**

**–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –º–µ–Ω—é –∏–∑ iiko:**

1. **–ö–Ω–æ–ø–∫–∞ "–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å –º–µ–Ω—é –∏–∑ iiko"** –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏
   - –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç –ø–æ–ª–Ω—É—é –Ω–æ–º–µ–Ω–∫–ª–∞—Ç—É—Ä—É –∏–∑ iiko API
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ—Ç/–æ–±–Ω–æ–≤–ª—è–µ—Ç –∫–∞—Ç–µ–≥–æ—Ä–∏–∏, –ø–æ–∑–∏—Ü–∏–∏, –≤–∞—Ä–∏–∞–Ω—Ç—ã, –º–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã –≤ –ª–æ–∫–∞–ª—å–Ω–æ–π –ë–î
   - –°–æ—Ö—Ä–∞–Ω—è–µ—Ç iiko ID –≤ —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ–º –ø–æ–ª–µ –¥–ª—è –ø–æ—Å–ª–µ–¥—É—é—â–∏—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
   - –ó–∞–≥—Ä—É–∂–∞–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏–∑ iiko (URL –∏–ª–∏ —Ñ–∞–π–ª—ã)

2. **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö —Å iiko ID:**

   ```sql
   ALTER TABLE menu_items
   ADD COLUMN iiko_item_id VARCHAR(255) NULL,
   ADD COLUMN iiko_synced_at TIMESTAMP NULL,
   ADD INDEX idx_iiko_item_id (iiko_item_id);

   ALTER TABLE item_variants
   ADD COLUMN iiko_variant_id VARCHAR(255) NULL,
   ADD INDEX idx_iiko_variant_id (iiko_variant_id);

   ALTER TABLE modifiers
   ADD COLUMN iiko_modifier_id VARCHAR(255) NULL,
   ADD INDEX idx_iiko_modifier_id (iiko_modifier_id);

   ALTER TABLE menu_categories
   ADD COLUMN iiko_category_id VARCHAR(255) NULL,
   ADD INDEX idx_iiko_category_id (iiko_category_id);
   ```

3. **–ü—Ä–æ—Ü–µ—Å—Å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏:**
   - –ü–æ–ª—É—á–∏—Ç—å –ø–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫ –Ω–æ–º–µ–Ω–∫–ª–∞—Ç—É—Ä—ã –∏–∑ iiko: `GET /api/1/nomenclature`
   - –î–ª—è –∫–∞–∂–¥–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏/–ø–æ–∑–∏—Ü–∏–∏/–º–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä–∞ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ –≤ –ª–æ–∫–∞–ª—å–Ω–æ–π –ë–î –ø–æ `iiko_*_id`
   - –ï—Å–ª–∏ –∑–∞–ø–∏—Å–∏ –Ω–µ—Ç ‚Üí —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º `iiko_*_id`
   - –ï—Å–ª–∏ –∑–∞–ø–∏—Å—å –µ—Å—Ç—å ‚Üí –æ–±–Ω–æ–≤–∏—Ç—å (–Ω–∞–∑–≤–∞–Ω–∏–µ, –æ–ø–∏—Å–∞–Ω–∏–µ, —Ü–µ–Ω—É, –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ, –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å)
   - –ó–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏–∑ iiko –∏ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –ª–æ–∫–∞–ª—å–Ω–æ –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å URL –∏–∑ iiko

4. **–ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∞—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è:**
   - –í–æ—Ä–∫–µ—Ä —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç –º–µ–Ω—é –∫–∞–∂–¥—ã–µ 30 –º–∏–Ω—É—Ç
   - –û–±–Ω–æ–≤–ª—è–µ—Ç —Ü–µ–Ω—ã, –æ–ø–∏—Å–∞–Ω–∏—è, –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å
   - –õ–æ–≥–∏—Ä—É–µ—Ç –≤—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

5. **–ß—Ç–æ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç—Å—è –∏–∑ iiko:**
   - ‚úÖ –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ (–Ω–∞–∑–≤–∞–Ω–∏—è, –ø–æ—Ä—è–¥–æ–∫)
   - ‚úÖ –ü–æ–∑–∏—Ü–∏–∏ –º–µ–Ω—é (–Ω–∞–∑–≤–∞–Ω–∏–µ, –æ–ø–∏—Å–∞–Ω–∏–µ, —Å–æ—Å—Ç–∞–≤, –ö–ë–ñ–£, –≤–µ—Å)
   - ‚úÖ –í–∞—Ä–∏–∞–Ω—Ç—ã (—Ä–∞–∑–º–µ—Ä—ã —Å —Ä–∞–∑–Ω—ã–º–∏ —Ü–µ–Ω–∞–º–∏)
   - ‚úÖ –ú–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã (–¥–æ–ø–æ–ª–Ω–µ–Ω–∏—è, —Å–æ—É—Å—ã)
   - ‚úÖ –¶–µ–Ω—ã –ø–æ –≤—Å–µ–º –ø–æ–∑–∏—Ü–∏—è–º
   - ‚úÖ –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (URL –∏–ª–∏ —Ñ–∞–π–ª—ã)
   - ‚úÖ –î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å (–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø–æ–∑–∏—Ü–∏–π)
   - ‚úÖ –°—Ç–æ–ø-–ª–∏—Å—Ç (–ø–æ–∑–∏—Ü–∏–∏ —Å –Ω—É–ª–µ–≤—ã–º –æ—Å—Ç–∞—Ç–∫–æ–º)

**–†–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã:**

- **–° –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π iiko**:
  - –ü—Ä–∏ –ø–µ—Ä–≤–æ–º –≤–∫–ª—é—á–µ–Ω–∏–∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ ‚Üí –∫–Ω–æ–ø–∫–∞ "–ó–∞–≥—Ä—É–∑–∏—Ç—å –º–µ–Ω—é –∏–∑ iiko"
  - –ú–µ–Ω—é –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç—Å—è –∫–∞–∂–¥—ã–µ 30 –º–∏–Ω—É—Ç
  - –õ–æ–∫–∞–ª—å–Ω–∞—è –ë–î —Å–ª—É–∂–∏—Ç –∫–µ—à–µ–º –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞
  - –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å FoodMiniApp –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –≤ —Ä–µ–∂–∏–º **"—Ç–æ–ª—å–∫–æ —á—Ç–µ–Ω–∏—è"**
  - –í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –º–µ–Ω—é –≤–æ–∑–º–æ–∂–Ω—ã —Ç–æ–ª—å–∫–æ –≤ —Å–∏—Å—Ç–µ–º–µ iiko
  - –ö–Ω–æ–ø–∫–∞ "–û–±–Ω–æ–≤–∏—Ç—å –º–µ–Ω—é —Å–µ–π—á–∞—Å" –¥–ª—è —Ä—É—á–Ω–æ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
- **–ë–µ–∑ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏**:
  - –ú–µ–Ω—é –ø–æ–ª–Ω–æ—Å—Ç—å—é —É–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å FoodMiniApp
  - –î–æ—Å—Ç—É–ø–Ω–æ —Å–æ–∑–¥–∞–Ω–∏–µ, —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —É–¥–∞–ª–µ–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–π, –ø–æ–∑–∏—Ü–∏–π, –º–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä–æ–≤

#### 3.2.2 –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∑–∞–∫–∞–∑–æ–≤ —Å –±—É—Ñ–µ—Ä–∏–∑–∞—Ü–∏–µ–π

**–ü—Ä–æ–±–ª–µ–º–∞:**  
–ó–∞–∫–∞–∑—ã —Å–æ–∑–¥–∞—é—Ç—Å—è –≤ FoodMiniApp, –Ω–æ –¥–æ–ª–∂–Ω—ã –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å—Å—è –≤ iiko –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –Ω–∞ –∫—É—Ö–Ω–µ –∏ –≤ –∫–∞—Å—Å–µ.

**–†–µ—à–µ–Ω–∏–µ —Å –º–µ—Ö–∞–Ω–∏–∑–º–æ–º –±—É—Ñ–µ—Ä–∏–∑–∞—Ü–∏–∏:**

1. **–õ–æ–∫–∞–ª—å–Ω–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç ‚Ññ1)**
   - –ó–∞–∫–∞–∑ –í–°–ï–ì–î–ê —Å–Ω–∞—á–∞–ª–∞ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ —Ç–∞–±–ª–∏—Ü—É `orders`
   - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∞–µ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–∫–∞–∑–∞ –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ
   - –î–∞–∂–µ –µ—Å–ª–∏ iiko –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞, –∑–∞–∫–∞–∑ —Å–æ–∑–¥–∞–Ω –∏ –≤–∏–¥–∏–º –≤ —Å–∏—Å—Ç–µ–º–µ

2. **–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è**
   - –ü–æ—Å–ª–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞ —Å–æ–∑–¥–∞–µ—Ç—Å—è –∑–∞–¥–∞—á–∞ –≤ –æ—á–µ—Ä–µ–¥–∏ BullMQ
   - –ó–∞–¥–∞—á–∞ –ø—ã—Ç–∞–µ—Ç—Å—è –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞–∫–∞–∑ –≤ iiko API
   - –ü—Ä–∏ —É—Å–ø–µ—Ö–µ: —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è `iiko_order_id`, —Å—Ç–∞—Ç—É—Å ‚Üí `synced`
   - –ü—Ä–∏ –æ—à–∏–±–∫–µ: —Å—Ç–∞—Ç—É—Å ‚Üí `pending` –∏–ª–∏ `error`, –∑–∞–¥–∞—á–∞ –ø–µ—Ä–µ–Ω–æ—Å–∏—Ç—Å—è –Ω–∞ –ø–æ–≤—Ç–æ—Ä

3. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π retry –ø—Ä–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å–≤—è–∑–∏**
   - Worker –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç –Ω–∞—Ö–æ–¥–∏—Ç –∑–∞–∫–∞–∑—ã —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º `pending`/`error`
   - –ü–æ–≤—Ç–æ—Ä–Ω–æ –ø—ã—Ç–∞–µ—Ç—Å—è –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –∏—Ö –≤ iiko
   - –ú–∞–∫—Å–∏–º—É–º 5 –ø–æ–ø—ã—Ç–æ–∫, –∑–∞—Ç–µ–º —Å—Ç–∞—Ç—É—Å ‚Üí `failed` (—Ç—Ä–µ–±—É–µ—Ç—Å—è —Ä—É—á–Ω–æ–µ –≤–º–µ—à–∞—Ç–µ–ª—å—Å—Ç–≤–æ)

- –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª—è –≤ —Ç–∞–±–ª–∏—Ü—É `orders`:

  ```sql
  ALTER TABLE orders
  ADD COLUMN iiko_order_id VARCHAR(255) NULL COMMENT 'ID –∑–∞–∫–∞–∑–∞ –≤ iiko',
  ADD COLUMN iiko_sync_status ENUM('pending', 'synced', 'error', 'failed') DEFAULT 'pending',
  ADD COLUMN iiko_sync_error TEXT NULL,
  ADD COLUMN iiko_sync_attempts INT DEFAULT 0,
  ADD COLUMN iiko_last_sync_at TIMESTAMP NULL,
  ADD INDEX idx_iiko_sync_status (iiko_sync_status);
  ```

- –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Ñ–æ–Ω–æ–≤—É—é –æ—á–µ—Ä–µ–¥—å –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –∑–∞–∫–∞–∑–æ–≤ –≤ iiko (BullMQ)
- Endpoint –¥–ª—è webhook –æ—Ç iiko: `POST /api/webhooks/iiko/order-status`
- –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å—Ç–∞—Ç—É—Å–æ–≤: iiko ‚Üí FoodMiniApp

**–ó–∞–º–∞–ø–ø–∏—Ä–æ–≤–∞—Ç—å —Å—Ç–∞—Ç—É—Å—ã:**
| FoodMiniApp | iiko |
|----------------|--------------------|
| pending | Unconfirmed |
| confirmed | WaitCooking |
| preparing | CookingStarted |
| ready | CookingCompleted |
| delivering | OnWay |
| completed | Delivered/Closed |
| cancelled | Cancelled |

**–í–∞–∂–Ω–æ:** –ü—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ iiko –∫—É—Ö–Ω—è —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ –∑–∞–∫–∞–∑–∞–º –∏–∑ –ª–æ–∫–∞–ª—å–Ω–æ–π –ë–î. –ü–æ—Å–ª–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è —Å–≤—è–∑–∏ –≤—Å–µ –∑–∞–∫–∞–∑—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É—é—Ç—Å—è.

#### 3.2.3 –°—Ç–æ–ø-–ª–∏—Å—Ç –∏ –æ—Å—Ç–∞—Ç–∫–∏

**–ü—Ä–æ–±–ª–µ–º–∞:**  
–°—Ç–æ–ø-–ª–∏—Å—Ç –≤ FoodMiniApp —É–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –≤—Ä—É—á–Ω—É—é, –≤ iiko –æ–Ω –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –æ—Å—Ç–∞—Ç–∫–æ–≤ –Ω–∞ —Å–∫–ª–∞–¥–µ.

**–†–µ—à–µ–Ω–∏–µ:**

- –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ –∑–∞–ø—Ä–∞—à–∏–≤–∞—Ç—å –æ—Å—Ç–∞—Ç–∫–∏ –∏–∑ iiko (–∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç)
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª—è—Ç—å –≤ —Å—Ç–æ–ø-–ª–∏—Å—Ç –ø–æ–∑–∏—Ü–∏–∏ —Å –Ω—É–ª–µ–≤—ã–º –æ—Å—Ç–∞—Ç–∫–æ–º
- –£—á–∏—Ç—ã–≤–∞—Ç—å –ø–æ–ª—É—Ñ–∞–±—Ä–∏–∫–∞—Ç—ã –∏ —Ä–∞—Å—á–µ—Ç –æ—Å—Ç–∞—Ç–∫–æ–≤ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ä–µ—Ü–µ–ø—Ç—É—Ä—ã

#### 3.2.4 –ú–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã

**–ü—Ä–æ–±–ª–µ–º–∞:**  
–ú–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã –≤ FoodMiniApp –∏–º–µ—é—Ç –≥–∏–±–∫—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É (–≥—Ä—É–ø–ø—ã, –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ/–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ), –≤ iiko –æ–Ω–∏ –ø—Ä–∏–≤—è–∑–∞–Ω—ã –∫ –±–ª—é–¥–∞–º —á–µ—Ä–µ–∑ "–º–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä–Ω—ã–µ —Å—Ö–µ–º—ã".

**–†–µ—à–µ–Ω–∏–µ:**

- –ü—Ä–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –º–µ–Ω—é –∏–∑ iiko –º–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –≤–º–µ—Å—Ç–µ —Å –ø–æ–∑–∏—Ü–∏—è–º–∏
- –°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ—Ç –≥—Ä—É–ø–ø—ã –º–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä–æ–≤ –∏ –æ—Ç–¥–µ–ª—å–Ω—ã–µ –º–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã
- –í –ª–æ–∫–∞–ª—å–Ω–æ–π –ë–î —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è `iiko_modifier_id` –¥–ª—è –ø–æ—Å–ª–µ–¥—É—é—â–∏—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
- –¶–µ–Ω—ã –º–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä–æ–≤ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –ø—Ä–∏ –∫–∞–∂–¥–æ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
- –ü—Ä–∏–≤—è–∑–∫–∞ –º–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä–æ–≤ –∫ –ø–æ–∑–∏—Ü–∏—è–º –æ—Å—É—â–µ—Å—Ç–≤–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ iiko

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏:**

```
iiko –ú–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã ‚Üí FoodMiniApp
‚îú‚îÄ‚îÄ –ì—Ä—É–ø–ø–∞ –º–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä–æ–≤ (—Å–æ–∑–¥–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
‚îÇ   ‚îú‚îÄ‚îÄ –ù–∞–∑–≤–∞–Ω–∏–µ
‚îÇ   ‚îú‚îÄ‚îÄ –¢–∏–ø (single/multiple)
‚îÇ   ‚îú‚îÄ‚îÄ –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å
‚îÇ   ‚îî‚îÄ‚îÄ iiko_modifier_group_id
‚îú‚îÄ‚îÄ –ú–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã –≤ –≥—Ä—É–ø–ø–µ
‚îÇ   ‚îú‚îÄ‚îÄ –ù–∞–∑–≤–∞–Ω–∏–µ
‚îÇ   ‚îú‚îÄ‚îÄ –¶–µ–Ω–∞
‚îÇ   ‚îú‚îÄ‚îÄ –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ (–µ—Å–ª–∏ –µ—Å—Ç—å)
‚îÇ   ‚îî‚îÄ‚îÄ iiko_modifier_id
‚îî‚îÄ‚îÄ –°–≤—è–∑—å —Å –ø–æ–∑–∏—Ü–∏–µ–π –º–µ–Ω—é (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è)
```

---

## 4. –ê–Ω–∞–ª–∏–∑ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å PremiumBonus

### 4.1 –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ PremiumBonus API

PremiumBonus –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç REST API –¥–ª—è:

- **–ö–ª–∏–µ–Ω—Ç—ã**: —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è, –ø–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏, —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- **–ë–æ–Ω—É—Å—ã**: –Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ, —Å–ø–∏—Å–∞–Ω–∏–µ, –±–∞–ª–∞–Ω—Å, –∏—Å—Ç–æ—Ä–∏—è
- **–ü–æ–∫—É–ø–∫–∏**: —Å–æ–∑–¥–∞–Ω–∏–µ –ø–æ–∫—É–ø–∫–∏, —ç–º—É–ª—è—Ü–∏—è (dry-run), –æ—Ç–º–µ–Ω–∞
- **–ì—Ä—É–ø–ø—ã –∫–ª–∏–µ–Ω—Ç–æ–≤**: —É—Ä–æ–≤–Ω–∏ –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏
- **–ü—Ä–æ–º–æ–∫–æ–¥—ã**: –∞–∫—Ç–∏–≤–∞—Ü–∏—è, –ø—Ä–æ–≤–µ—Ä–∫–∞
- **–ö–æ–¥—ã –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è**: –æ—Ç–ø—Ä–∞–≤–∫–∞ SMS, –ø—Ä–æ–≤–µ—Ä–∫–∞

### 4.2 –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∞—Å–ø–µ–∫—Ç—ã –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å PremiumBonus

#### 4.2.1 –ó–∞–º–µ–Ω–∞ –º–æ–¥—É–ª—è –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏

**–ü—Ä–æ–±–ª–µ–º–∞:**  
–¢–µ–∫—É—â–∞—è —Å–∏—Å—Ç–µ–º–∞ –∏–º–µ–µ—Ç —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—É—é —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏ (—Ç–∞–±–ª–∏—Ü—ã `loyalty_levels`, `user_loyalty_levels`, `loyalty_transactions`), –∫–æ—Ç–æ—Ä–∞—è **–¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–º–µ–Ω–µ–Ω–∞** –Ω–∞ PremiumBonus.

**–†–µ—à–µ–Ω–∏–µ:**

- **–°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ç–∞–±–ª–∏—Ü—ã** –¥–ª—è —Ä–µ–∂–∏–º–∞ –±–µ–∑ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
- –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–µ –≤ `users`:

  ```sql
  ALTER TABLE users
  ADD COLUMN pb_client_id VARCHAR(255) NULL COMMENT 'ID –∫–ª–∏–µ–Ω—Ç–∞ –≤ PremiumBonus',
  ADD COLUMN pb_external_id VARCHAR(255) NULL COMMENT 'external_id –¥–ª—è PremiumBonus',
  ADD COLUMN loyalty_mode ENUM('local', 'premiumbonus') DEFAULT 'local',
  ADD INDEX idx_pb_client_id (pb_client_id);
  ```

- –°–æ–∑–¥–∞—Ç—å **–∞–¥–∞–ø—Ç–µ—Ä –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏** (`loyaltyAdapter.js`), –∫–æ—Ç–æ—Ä—ã–π –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ä–µ–∂–∏–º–∞ (`loyalty_mode`) –Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–ø—Ä–æ—Å—ã –ª–∏–±–æ –≤ –ª–æ–∫–∞–ª—å–Ω—É—é –ë–î, –ª–∏–±–æ –≤ PremiumBonus API

- –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –º–µ—Ç–æ–¥—ã:
  - `getUserBalance(userId)` ‚Äî –ø–æ–ª—É—á–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞
  - `earnBonuses(userId, amount, reason)` ‚Äî –Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ
  - `spendBonuses(userId, amount, reason)` ‚Äî —Å–ø–∏—Å–∞–Ω–∏–µ
  - `getUserLevel(userId)` ‚Äî —Ç–µ–∫—É—â–∏–π —É—Ä–æ–≤–µ–Ω—å
  - `getTransactionHistory(userId)` ‚Äî –∏—Å—Ç–æ—Ä–∏—è

**–†–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã:**
| –†–µ–∂–∏–º | –ò—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö |
|-------------------|------------------------|
| `local` | –õ–æ–∫–∞–ª—å–Ω–∞—è –ë–î |
| `premiumbonus` | PremiumBonus API |

#### 4.2.2 –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∫–ª–∏–µ–Ω—Ç–æ–≤ —Å –±—É—Ñ–µ—Ä–∏–∑–∞—Ü–∏–µ–π

**–ü—Ä–æ–±–ª–µ–º–∞:**  
–ö–ª–∏–µ–Ω—Ç—ã —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É—é—Ç—Å—è –≤ FoodMiniApp —á–µ—Ä–µ–∑ Telegram, –Ω–æ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω—ã –≤ PremiumBonus –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –±–æ–Ω—É—Å–∞–º–∏.

**–ú–µ—Ö–∞–Ω–∏–∑–º –±—É—Ñ–µ—Ä–∏–∑–∞—Ü–∏–∏ –¥–ª—è –∫–ª–∏–µ–Ω—Ç–æ–≤:**

1. **–õ–æ–∫–∞–ª—å–Ω–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç ‚Ññ1)**
   - –ö–ª–∏–µ–Ω—Ç –í–°–ï–ì–î–ê —Å–Ω–∞—á–∞–ª–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç—Å—è –≤ –ª–æ–∫–∞–ª—å–Ω–æ–π —Ç–∞–±–ª–∏—Ü–µ `users`
   - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∞–µ—Ç –¥–æ—Å—Ç—É–ø –∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ
   - –î–∞–∂–µ –µ—Å–ª–∏ PremiumBonus –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω, –∫–ª–∏–µ–Ω—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç —Å —Å–∏—Å—Ç–µ–º–æ–π

2. **–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å PremiumBonus**
   - –ü–æ—Å–ª–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ —Å–æ–∑–¥–∞–µ—Ç—Å—è –∑–∞–¥–∞—á–∞ –≤ –æ—á–µ—Ä–µ–¥–∏ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏/—Å–æ–∑–¥–∞–Ω–∏—è –≤ PB
   - –ü—Ä–∏ —É—Å–ø–µ—Ö–µ: —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è `pb_client_id`, —Å—Ç–∞—Ç—É—Å ‚Üí `synced`
   - –ü—Ä–∏ –æ—à–∏–±–∫–µ: —Å—Ç–∞—Ç—É—Å ‚Üí `pending`, –∑–∞–¥–∞—á–∞ –ø–µ—Ä–µ–Ω–æ—Å–∏—Ç—Å—è –Ω–∞ –ø–æ–≤—Ç–æ—Ä

3. **–î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª—è –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏:**

```sql
ALTER TABLE users
ADD COLUMN pb_client_id VARCHAR(255) NULL COMMENT 'ID –∫–ª–∏–µ–Ω—Ç–∞ –≤ PremiumBonus',
ADD COLUMN pb_sync_status ENUM('pending', 'synced', 'error', 'failed') DEFAULT 'pending',
ADD COLUMN pb_sync_error TEXT NULL,
ADD COLUMN pb_sync_attempts INT DEFAULT 0,
ADD COLUMN pb_last_sync_at TIMESTAMP NULL,
ADD INDEX idx_pb_sync_status (pb_sync_status);
```

**–†–µ—à–µ–Ω–∏–µ:**

**–°—Ü–µ–Ω–∞—Ä–∏–π 1: –ù–æ–≤—ã–π –∫–ª–∏–µ–Ω—Ç (–Ω–µ—Ç –≤ PremiumBonus)**

1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–µ—Ä–≤—ã–π —Ä–∞–∑ –∞–≤—Ç–æ—Ä–∏–∑—É–µ—Ç—Å—è –≤ Telegram Mini App –∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞
2. –°–æ–∑–¥–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å –≤ –ª–æ–∫–∞–ª—å–Ω–æ–π –ë–î FoodMiniApp (—Å—Ç–∞—Ç—É—Å `pb_sync_status: 'pending'`)
3. –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ñ–æ–Ω–æ–≤—É—é –∑–∞–¥–∞—á—É:
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ –∫–ª–∏–µ–Ω—Ç–∞ –≤ PremiumBonus: `POST /buyer-info` —Å –Ω–æ–º–µ—Ä–æ–º —Ç–µ–ª–µ—Ñ–æ–Ω–∞
   - –ï—Å–ª–∏ –∫–ª–∏–µ–Ω—Ç–∞ –Ω–µ—Ç (–æ—Ç–≤–µ—Ç `is_registered: false`):
     - –°–æ–∑–¥–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å –≤ PremiumBonus —á–µ—Ä–µ–∑ `POST /buyer-register`
     - –ü–µ—Ä–µ–¥–∞—Ç—å: `phone`, `first_name`, `last_name`, `email`, `birth_date`, `external_id`
     - –°–æ—Ö—Ä–∞–Ω–∏—Ç—å `client_id` –∏–∑ –æ—Ç–≤–µ—Ç–∞ –≤ `users.pb_client_id`
     - **–ù–∞—á–∏—Å–ª–∏—Ç—å –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–µ –±–æ–Ω—É—Å—ã** (–Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è –≤ PremiumBonus)
     - –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å ‚Üí `synced`
   - –ü—Ä–∏ –æ—à–∏–±–∫–µ: —Å—Ç–∞—Ç—É—Å ‚Üí `error`, –ø–æ–≤—Ç–æ—Ä —á–µ—Ä–µ–∑ 5 –º–∏–Ω—É—Ç

**–°—Ü–µ–Ω–∞—Ä–∏–π 2: –°—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–ª–∏–µ–Ω—Ç PremiumBonus (–ø–µ—Ä–≤—ã–π –≤—Ö–æ–¥ –≤ Telegram Mini App)**

1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–µ—Ä–≤—ã–π —Ä–∞–∑ –∞–≤—Ç–æ—Ä–∏–∑—É–µ—Ç—Å—è –≤ Telegram Mini App –∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞
2. –°–æ–∑–¥–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å –≤ –ª–æ–∫–∞–ª—å–Ω–æ–π –ë–î FoodMiniApp (—Å—Ç–∞—Ç—É—Å `pb_sync_status: 'pending'`)
3. –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ñ–æ–Ω–æ–≤—É—é –∑–∞–¥–∞—á—É:
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ –∫–ª–∏–µ–Ω—Ç–∞ –≤ PremiumBonus: `POST /buyer-info` —Å –Ω–æ–º–µ—Ä–æ–º —Ç–µ–ª–µ—Ñ–æ–Ω–∞
   - –ï—Å–ª–∏ –∫–ª–∏–µ–Ω—Ç –Ω–∞–π–¥–µ–Ω (–æ—Ç–≤–µ—Ç `is_registered: true`):
     - –ó–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –∫–ª–∏–µ–Ω—Ç–∞ –∏–∑ PremiumBonus (`client_id`, –±–∞–ª–∞–Ω—Å, —É—Ä–æ–≤–µ–Ω—å, –ø—Ä–æ—Ñ–∏–ª—å)
     - –û–±–Ω–æ–≤–∏—Ç—å –ª–æ–∫–∞–ª—å–Ω—É—é –∑–∞–ø–∏—Å—å —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º `pb_client_id`
     - –°–≤—è–∑–∞—Ç—å Telegram ID —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –∫–∞—Ä—Ç–æ—á–∫–æ–π PremiumBonus
     - **–ù–ï –Ω–∞—á–∏—Å–ª—è—Ç—å –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–µ –±–æ–Ω—É—Å—ã** (–∫–ª–∏–µ–Ω—Ç —É–∂–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω)
     - –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å ‚Üí `synced`
   - –ü—Ä–∏ –æ—à–∏–±–∫–µ: —Å—Ç–∞—Ç—É—Å ‚Üí `error`, –ø–æ–≤—Ç–æ—Ä —á–µ—Ä–µ–∑ 5 –º–∏–Ω—É—Ç

**–°—Ü–µ–Ω–∞—Ä–∏–π 3: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è —Å –±—É—Ñ–µ—Ä–∏–∑–∞—Ü–∏–µ–π**

- –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö –≤ –ø—Ä–æ—Ñ–∏–ª–µ Telegram Mini App (–∏–º—è, email, –¥–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è):
  1. –û–±–Ω–æ–≤–∏—Ç—å –ª–æ–∫–∞–ª—å–Ω—É—é –∑–∞–ø–∏—Å—å –≤ FoodMiniApp
  2. –ü–æ—Å—Ç–∞–≤–∏—Ç—å –∑–∞–¥–∞—á—É –≤ –æ—á–µ—Ä–µ–¥—å –Ω–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é —Å PremiumBonus
  3. –§–æ–Ω–æ–≤—ã–π worker –æ—Ç–ø—Ä–∞–≤–∏—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è —á–µ—Ä–µ–∑ `POST /buyer-edit`
  4. –ü—Ä–∏ –æ—à–∏–±–∫–µ: –¥–∞–Ω–Ω—ã–µ –æ—Å—Ç–∞–Ω—É—Ç—Å—è –≤ –æ—á–µ—Ä–µ–¥–∏ –Ω–∞ –ø–æ–≤—Ç–æ—Ä

**–°—Ü–µ–Ω–∞—Ä–∏–π 4: –ü–æ–ª—É—á–µ–Ω–∏–µ –∞–∫—Ç—É–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö**

- –ë–∞–ª–∞–Ω—Å –∏ —É—Ä–æ–≤–µ–Ω—å –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏ –∑–∞–ø—Ä–∞—à–∏–≤–∞—é—Ç—Å—è –∏–∑ PremiumBonus –ø—Ä–∏ –∫–∞–∂–¥–æ–º –æ—Ç–∫—Ä—ã—Ç–∏–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- –ú–µ—Ç–æ–¥: `POST /buyer-info` —Å `identificator` (—Ç–µ–ª–µ—Ñ–æ–Ω –∏–ª–∏ `client_id`)
- –ö–µ—à–∏—Ä–æ–≤–∞—Ç—å –≤ Redis –Ω–∞ 5 –º–∏–Ω—É—Ç –¥–ª—è —Å–Ω–∏–∂–µ–Ω–∏—è –Ω–∞–≥—Ä—É–∑–∫–∏
- –ü—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ PremiumBonus: –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ –ª–æ–∫–∞–ª—å–Ω–æ–π –ë–î

**–í–∞–∂–Ω–æ:** –ö–ª–∏–µ–Ω—Ç –≤—Å–µ–≥–¥–∞ –º–æ–∂–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º, –¥–∞–∂–µ –µ—Å–ª–∏ PremiumBonus –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω. –í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –±—É–¥—É—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ—Å–ª–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è —Å–≤—è–∑–∏.

#### 4.2.3 –ù–∞—á–∏—Å–ª–µ–Ω–∏–µ –∏ —Å–ø–∏—Å–∞–Ω–∏–µ –±–æ–Ω—É—Å–æ–≤ —Å –±—É—Ñ–µ—Ä–∏–∑–∞—Ü–∏–µ–π

**–ü—Ä–æ–±–ª–µ–º–∞:**  
–¢–µ–∫—É—â–∞—è —Å–∏—Å—Ç–µ–º–∞ –Ω–∞—á–∏—Å–ª—è–µ—Ç –±–æ–Ω—É—Å—ã –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ –∑–∞–∫–∞–∑–∞, —Å–ø–∏—Å—ã–≤–∞–µ—Ç –ø—Ä–∏ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–∏. PremiumBonus —Ç—Ä–µ–±—É–µ—Ç —Å–æ–∑–¥–∞–Ω–∏—è "–ø–æ–∫—É–ø–∫–∏" —Å –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–µ–π —Å–æ—Å—Ç–∞–≤–∞ –∑–∞–∫–∞–∑–∞.

**–ú–µ—Ö–∞–Ω–∏–∑–º –±—É—Ñ–µ—Ä–∏–∑–∞—Ü–∏–∏ –¥–ª—è –ø–æ–∫—É–ø–æ–∫:**

1. **–õ–æ–∫–∞–ª—å–Ω–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞ (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç ‚Ññ1)**
   - –ó–∞–∫–∞–∑ –í–°–ï–ì–î–ê —Å–æ–∑–¥–∞–µ—Ç—Å—è –≤ –ª–æ–∫–∞–ª—å–Ω–æ–π –ë–î —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ–± –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã—Ö –±–æ–Ω—É—Å–∞—Ö
   - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç –∑–∞–∫–∞–∑ –≤ —Å–∏—Å—Ç–µ–º–µ –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ
   - –î–∞–∂–µ –µ—Å–ª–∏ PremiumBonus –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω, –∑–∞–∫–∞–∑ –ø—Ä–∏–Ω—è—Ç

2. **–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ø–æ–∫—É–ø–∫–∏**
   - –ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–∫–∞–∑–∞ –∑–∞–¥–∞—á–∞ –≤ –æ—á–µ—Ä–µ–¥–∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç `POST /purchase` –≤ PB
   - –ü—Ä–∏ —É—Å–ø–µ—Ö–µ: —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è `pb_purchase_id`, —Å—Ç–∞—Ç—É—Å ‚Üí `synced`
   - –ü—Ä–∏ –æ—à–∏–±–∫–µ: —Å—Ç–∞—Ç—É—Å ‚Üí `pending`, –ø–æ–≤—Ç–æ—Ä —á–µ—Ä–µ–∑ 5 –º–∏–Ω—É—Ç

3. **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –ø–æ–∫—É–ø–∫–∏**
   - –ü—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏/–æ—Ç–º–µ–Ω–µ –∑–∞–∫–∞–∑–∞ –∑–∞–¥–∞—á–∞ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π —Å—Ç–∞—Ç—É—Å –≤ PB
   - –ü—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ PB: —Å—Ç–∞—Ç—É—Å –æ—Å—Ç–∞–µ—Ç—Å—è `pending`, —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–∏

**–†–µ—à–µ–Ω–∏–µ:**

**–ü—Ä–∏ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–∏ –∑–∞–∫–∞–∑–∞:**

1. –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ –≤—ã–∑–≤–∞—Ç—å `POST /purchase-request` –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π –¥–æ—Å—Ç—É–ø–Ω–æ–π –≤—ã–≥–æ–¥—ã
   - –ü—Ä–∏ —É—Å–ø–µ—Ö–µ: –æ—Ç–æ–±—Ä–∞–∑–∏—Ç—å –∫–ª–∏–µ–Ω—Ç—É –¥–æ—Å—Ç—É–ø–Ω—ã–µ –±–æ–Ω—É—Å—ã
   - –ü—Ä–∏ –æ—à–∏–±–∫–µ: –ø–æ–∫–∞–∑–∞—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–µ –¥–∞–Ω–Ω—ã–µ –±–∞–ª–∞–Ω—Å–∞ –∏–∑ –ª–æ–∫–∞–ª—å–Ω–æ–π –ë–î
2. –°–æ–∑–¥–∞—Ç—å –∑–∞–∫–∞–∑ –≤ –ª–æ–∫–∞–ª—å–Ω–æ–π –ë–î —Å –ø–æ–ª–µ–º `bonuses_used` (—Å—Ç–∞—Ç—É—Å `pb_sync_status: 'pending'`)
3. –ü–æ—Å—Ç–∞–≤–∏—Ç—å –≤ –æ—á–µ—Ä–µ–¥—å –∑–∞–¥–∞—á—É –Ω–∞ —Å–æ–∑–¥–∞–Ω–∏–µ –ø–æ–∫—É–ø–∫–∏ –≤ PB: `POST /purchase`
4. –§–æ–Ω–æ–≤—ã–π worker –æ—Ç–ø—Ä–∞–≤–∏—Ç –ø–æ–∫—É–ø–∫—É –∏ —Å–æ—Ö—Ä–∞–Ω–∏—Ç `pb_purchase_id`

**–ü—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ –∑–∞–∫–∞–∑–∞:**

1. –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å –∑–∞–∫–∞–∑–∞ –≤ –ª–æ–∫–∞–ª—å–Ω–æ–π –ë–î
2. –ü–æ—Å—Ç–∞–≤–∏—Ç—å –≤ –æ—á–µ—Ä–µ–¥—å –∑–∞–¥–∞—á—É –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –≤ PB: `POST /change-purchase-status`
3. –§–æ–Ω–æ–≤—ã–π worker –æ—Ç–ø—Ä–∞–≤–∏—Ç –Ω–æ–≤—ã–π —Å—Ç–∞—Ç—É—Å, –ø–æ–ª—É—á–∏—Ç –Ω–∞—á–∏—Å–ª–µ–Ω–Ω—ã–µ –±–æ–Ω—É—Å—ã

**–ü—Ä–∏ –æ—Ç–º–µ–Ω–µ –∑–∞–∫–∞–∑–∞:**

1. –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å –∑–∞–∫–∞–∑–∞ –≤ –ª–æ–∫–∞–ª—å–Ω–æ–π –ë–î
2. –ü–æ—Å—Ç–∞–≤–∏—Ç—å –≤ –æ—á–µ—Ä–µ–¥—å –∑–∞–¥–∞—á—É –Ω–∞ –æ—Ç–º–µ–Ω—É –≤ PB: `POST /cancel-purchase`
3. –§–æ–Ω–æ–≤—ã–π worker –æ—Ç–º–µ–Ω–∏—Ç –ø–æ–∫—É–ø–∫—É, –±–æ–Ω—É—Å—ã –±—É–¥—É—Ç –≤–æ–∑–≤—Ä–∞—â–µ–Ω—ã

**–î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª—è –≤ —Ç–∞–±–ª–∏—Ü—É `orders`:**

```sql
ALTER TABLE orders
ADD COLUMN pb_purchase_id VARCHAR(255) NULL COMMENT 'ID –ø–æ–∫—É–ø–∫–∏ –≤ PremiumBonus',
ADD COLUMN pb_sync_status ENUM('pending', 'synced', 'error', 'failed') DEFAULT 'pending',
ADD COLUMN pb_sync_error TEXT NULL,
ADD COLUMN pb_sync_attempts INT DEFAULT 0,
ADD COLUMN pb_last_sync_at TIMESTAMP NULL,
ADD INDEX idx_pb_purchase_id (pb_purchase_id),
ADD INDEX idx_pb_sync_status (pb_sync_status);
```

**–í–∞–∂–Ω–æ:** –ö–ª–∏–µ–Ω—Ç –≤–∏–¥–∏—Ç —Å–ø–∏—Å–∞–Ω–Ω—ã–µ –±–æ–Ω—É—Å—ã –≤ –∑–∞–∫–∞–∑–µ —Å—Ä–∞–∑—É (–ª–æ–∫–∞–ª—å–Ω–æ). –§–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ —Å–ø–∏—Å–∞–Ω–∏–µ –≤ PremiumBonus –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ. –ü—Ä–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å–≤—è–∑–∏ –≤—Å–µ –ø–æ–∫—É–ø–∫–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É—é—Ç—Å—è.

#### 4.2.4 –£—Ä–æ–≤–Ω–∏ –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏

**–ü—Ä–æ–±–ª–µ–º–∞:**  
–£—Ä–æ–≤–Ω–∏ –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏ –≤ —Ç–µ–∫—É—â–µ–π —Å–∏—Å—Ç–µ–º–µ –∂–µ—Å—Ç–∫–æ –∑–∞–∫–æ–¥–∏—Ä–æ–≤–∞–Ω—ã (–ë—Ä–æ–Ω–∑–∞, –°–µ—Ä–µ–±—Ä–æ, –ó–æ–ª–æ—Ç–æ), –≤ PremiumBonus –æ–Ω–∏ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å PremiumBonus.

**–†–µ—à–µ–Ω–∏–µ:**

- –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ –∑–∞–ø—Ä–∞—à–∏–≤–∞—Ç—å —Å–ø–∏—Å–æ–∫ –≥—Ä—É–ø–ø –∫–ª–∏–µ–Ω—Ç–æ–≤ –∏–∑ PremiumBonus:
  - –ú–µ—Ç–æ–¥: `POST /buyer-groups`
  - –ö–µ—à–∏—Ä–æ–≤–∞—Ç—å –≤ Redis –Ω–∞ 1 —á–∞—Å

- –ü—Ä–∏ —Ä–∞—Å—á–µ—Ç–µ –Ω–∞—á–∏—Å–ª–µ–Ω–∏–π/—Å–ø–∏—Å–∞–Ω–∏–π –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≥—Ä—É–ø–ø—ã –∏–∑ PremiumBonus
- –û—Ç–æ–±—Ä–∞–∂–∞—Ç—å —Ç–µ–∫—É—â–∏–π —É—Ä–æ–≤–µ–Ω—å –∫–ª–∏–µ–Ω—Ç–∞ –∏–∑ PremiumBonus –≤ Mini App

#### 4.2.5 –¢—Ä–∏–≥–≥–µ—Ä–Ω—ã–µ –±–æ–Ω—É—Å—ã (–¥–µ–Ω—å —Ä–æ–∂–¥–µ–Ω–∏—è, —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è)

**–ü—Ä–æ–±–ª–µ–º–∞:**  
–í —Ç–µ–∫—É—â–µ–π —Å–∏—Å—Ç–µ–º–µ —Ç—Ä–∏–≥–≥–µ—Ä–Ω—ã–µ –±–æ–Ω—É—Å—ã –Ω–∞—á–∏—Å–ª—è—é—Ç—Å—è —á–µ—Ä–µ–∑ background workers. –í PremiumBonus —ç—Ç–æ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ "—Å—Ü–µ–Ω–∞—Ä–∏–∏".

**–†–µ—à–µ–Ω–∏–µ:**

- **–° –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π PremiumBonus**: –æ—Ç–∫–ª—é—á–∏—Ç—å –ª–æ–∫–∞–ª—å–Ω—ã–µ –≤–æ—Ä–∫–µ—Ä—ã, –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å —Å—Ü–µ–Ω–∞—Ä–∏–∏ –≤ –ø–∞–Ω–µ–ª–∏ PremiumBonus
- **–ë–µ–∑ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏**: –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ª–æ–∫–∞–ª—å–Ω—ã–µ –≤–æ—Ä–∫–µ—Ä—ã

**–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞:** –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–µ—Ç–æ–¥ `POST /trigger` –¥–ª—è –∑–∞–ø—É—Å–∫–∞ —Å–æ–±—ã—Ç–∏–π –∏–∑ FoodMiniApp

---

## 5. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è

### 5.1 –ü—Ä–∏–Ω—Ü–∏–ø –¥–≤–æ–π–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞ —Ä–∞–±–æ—Ç—ã

–î–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ —Ä–∞–±–æ—Ç—ã –∫–∞–∫ —Å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è–º–∏, —Ç–∞–∫ –∏ –±–µ–∑ –Ω–∏—Ö, –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤–Ω–µ–¥—Ä–∏—Ç—å **–ø–∞—Ç—Ç–µ—Ä–Ω "–ê–¥–∞–ø—Ç–µ—Ä"** –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –º–æ–¥—É–ª—è:

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ         –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                   ‚îÇ
          ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
          ‚îÇ     Adapter      ‚îÇ
          ‚îÇ  (—Ä–µ–∂–∏–º: local   ‚îÇ
          ‚îÇ   –∏–ª–∏ external)  ‚îÇ
          ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                   ‚îÇ
        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
        ‚îÇ                     ‚îÇ
    ‚îå‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îê          ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚îÇ Local  ‚îÇ          ‚îÇ  External  ‚îÇ
    ‚îÇ   DB   ‚îÇ          ‚îÇ  API (iiko)‚îÇ
    ‚îÇ (R/W)  ‚îÇ          ‚îÇ  (read)    ‚îÇ
    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò          ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**–õ–æ–≥–∏–∫–∞ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ä–µ–∂–∏–º–æ–≤:**

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  System Settings (system_settings table)            ‚îÇ
‚îÇ  ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ  ‚îÇ
‚îÇ  iiko_enabled: false/true                           ‚îÇ
‚îÇ  premiumbonus_enabled: false/true                   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                   ‚îÇ
        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
        ‚îÇ                     ‚îÇ
  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
  ‚îÇ –†–µ–∂–∏–º OFF ‚îÇ        ‚îÇ  –†–µ–∂–∏–º ON   ‚îÇ
  ‚îÇ  (local)  ‚îÇ        ‚îÇ (external)  ‚îÇ
  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò        ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
        ‚îÇ                     ‚îÇ
        ‚îÇ                     ‚îÇ
  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
  ‚îÇ UI: R/W   ‚îÇ        ‚îÇ UI: Read-only ‚îÇ
  ‚îÇ –ü–æ–ª–Ω—ã–π    ‚îÇ        ‚îÇ –¢–æ–ª—å–∫–æ        ‚îÇ
  ‚îÇ –¥–æ—Å—Ç—É–ø    ‚îÇ        ‚îÇ –ø—Ä–æ—Å–º–æ—Ç—Ä      ‚îÇ
  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò        ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**–ú–µ—Ö–∞–Ω–∏–∑–º –±—É—Ñ–µ—Ä–∏–∑–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö (–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω–æ!):**

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ         –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞/—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∫–ª–∏–µ–Ω—Ç–∞      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                   ‚îÇ
                   ‚ñº
          ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
          ‚îÇ  1. –°–æ—Ö—Ä–∞–Ω–∏—Ç—å  ‚îÇ
          ‚îÇ  –≤ –ª–æ–∫–∞–ª—å–Ω—É—é   ‚îÇ ‚Üê –í–°–ï–ì–î–ê —Å–Ω–∞—á–∞–ª–∞ –≤ –ë–î
          ‚îÇ      –ë–î        ‚îÇ
          ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                   ‚îÇ
          ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
          ‚îÇ  2. –ü–æ—Å—Ç–∞–≤–∏—Ç—å   ‚îÇ
          ‚îÇ  –≤ –æ—á–µ—Ä–µ–¥—å –Ω–∞   ‚îÇ
          ‚îÇ  —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é  ‚îÇ
          ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                   ‚îÇ
        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
        ‚îÇ                     ‚îÇ
    ‚îå‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îê          ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚îÇ iiko   ‚îÇ          ‚îÇ PremiumB.  ‚îÇ
    ‚îÇ–¥–æ—Å—Ç—É–ø–Ω–∞‚îÇ          ‚îÇ –¥–æ—Å—Ç—É–ø–Ω–∞   ‚îÇ
    ‚îî‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îò          ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
        ‚îÇ                     ‚îÇ
    ‚îå‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê      ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚îÇ –û—Ç–ø—Ä–∞–≤–∏—Ç—å  ‚îÇ      ‚îÇ  –û—Ç–ø—Ä–∞–≤–∏—Ç—å     ‚îÇ
    ‚îÇ –≤ iiko API ‚îÇ      ‚îÇ  –≤ PB API      ‚îÇ
    ‚îî‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò      ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
        ‚îÇ                     ‚îÇ
    ‚îå‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê      ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚îÇ –£—Å–ø–µ—à–Ω–æ?   ‚îÇ      ‚îÇ  –£—Å–ø–µ—à–Ω–æ?      ‚îÇ
    ‚îî‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò      ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
        ‚îÇ                     ‚îÇ
   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îê           ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îê
   ‚îÇ         ‚îÇ           ‚îÇ         ‚îÇ
  –î–∞        –ù–µ—Ç         –î–∞        –ù–µ—Ç
   ‚îÇ         ‚îÇ           ‚îÇ         ‚îÇ
   ‚ñº         ‚ñº           ‚ñº         ‚ñº
synced    pending     synced    pending
           ‚Üì                       ‚Üì
    [–ü–æ–≤—Ç–æ—Ä —á–µ—Ä–µ–∑ N –º–∏–Ω—É—Ç –ø—Ä–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å–≤—è–∑–∏]
```

**–°—Ç–∞—Ç—É—Å—ã —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏:**

- `pending` ‚Äî –æ–∂–∏–¥–∞–µ—Ç –æ—Ç–ø—Ä–∞–≤–∫–∏ (–Ω–æ–≤–∞—è –∑–∞–ø–∏—Å—å)
- `synced` ‚Äî —É—Å–ø–µ—à–Ω–æ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–æ —Å –≤–Ω–µ—à–Ω–µ–π —Å–∏—Å—Ç–µ–º–æ–π
- `error` ‚Äî –æ—à–∏–±–∫–∞ –ø—Ä–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ (–±—É–¥—É—Ç –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏)
- `failed` ‚Äî –ø—Ä–µ–≤—ã—à–µ–Ω–æ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ø—ã—Ç–æ–∫ (—Ç—Ä–µ–±—É–µ—Ç—Å—è —Ä—É—á–Ω–æ–µ –≤–º–µ—à–∞—Ç–µ–ª—å—Å—Ç–≤–æ)

**–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏:**

- Periodic worker –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç
- –ù–∞—Ö–æ–¥–∏—Ç –≤—Å–µ –∑–∞–ø–∏—Å–∏ —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º `pending` –∏–ª–∏ `error` (–º–∞–∫—Å. 5 –ø–æ–ø—ã—Ç–æ–∫)
- –ü—ã—Ç–∞–µ—Ç—Å—è –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –∏—Ö –≤–æ –≤–Ω–µ—à–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã
- –ü—Ä–∏ —É—Å–ø–µ—Ö–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç —Å—Ç–∞—Ç—É—Å –Ω–∞ `synced`

**–ü—Ä–∏–º–µ—Ä —Ä–∞–±–æ—Ç—ã –¥–ª—è –º–æ–¥—É–ª—è –º–µ–Ω—é:**

| –ü–∞—Ä–∞–º–µ—Ç—Ä          | `iiko_enabled: false` | `iiko_enabled: true`    |
| ----------------- | --------------------- | ----------------------- |
| –ò—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö   | –õ–æ–∫–∞–ª—å–Ω–∞—è –ë–î          | iiko API + –∫–µ—à –≤ –ë–î     |
| –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–∏  | ‚úÖ –î–æ—Å—Ç—É–ø–Ω–æ           | ‚ùå –ù–µ–¥–æ—Å—Ç—É–ø–Ω–æ (403)     |
| –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ    | ‚úÖ –î–æ—Å—Ç—É–ø–Ω–æ           | ‚ùå –ù–µ–¥–æ—Å—Ç—É–ø–Ω–æ (403)     |
| –£–¥–∞–ª–µ–Ω–∏–µ          | ‚úÖ –î–æ—Å—Ç—É–ø–Ω–æ           | ‚ùå –ù–µ–¥–æ—Å—Ç—É–ø–Ω–æ (403)     |
| –ü—Ä–æ—Å–º–æ—Ç—Ä          | ‚úÖ –î–æ—Å—Ç—É–ø–Ω–æ           | ‚úÖ –î–æ—Å—Ç—É–ø–Ω–æ (read-only) |
| –°—Ç–æ–ø-–ª–∏—Å—Ç         | –†—É—á–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ     | –ò–∑ iiko (–æ—Å—Ç–∞—Ç–∫–∏)       |
| –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è     | –ù–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è          | –ö–∞–∂–¥—ã–µ 30 –º–∏–Ω—É—Ç         |
| –ü—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ | –ù–µ –ø—Ä–∏–º–µ–Ω–∏–º–æ          | –†–∞–±–æ—Ç–∞ —Å –∫–µ—à–µ–º –≤ –ë–î     |

### 5.2 –ê–¥–∞–ø—Ç–µ—Ä –º–µ–Ω—é (MenuAdapter)

```javascript
class MenuAdapter {
  constructor(mode = "local") {
    this.mode = mode; // 'local' –∏–ª–∏ 'iiko'
  }

  async getMenu(cityId) {
    if (this.mode === "iiko") {
      return await iikoIntegration.syncMenu(cityId);
    }
    return await localMenuService.getMenu(cityId);
  }

  async updateItem(itemId, data) {
    if (this.mode === "iiko") {
      throw new Error("Menu updates via iiko only");
    }
    return await localMenuService.updateItem(itemId, data);
  }

  async getStopList(branchId) {
    if (this.mode === "iiko") {
      return await iikoIntegration.getStopList(branchId);
    }
    return await localMenuService.getStopList(branchId);
  }
}
```

### 5.3 –ê–¥–∞–ø—Ç–µ—Ä –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏ (LoyaltyAdapter)

```javascript
class LoyaltyAdapter {
  constructor(mode = "local") {
    this.mode = mode; // 'local' –∏–ª–∏ 'premiumbonus'
  }

  async getUserBalance(userId) {
    if (this.mode === "premiumbonus") {
      return await premiumBonusIntegration.getBalance(userId);
    }
    return await localLoyaltyService.getUserBalance(userId);
  }

  async earnBonuses(userId, amount, reason) {
    if (this.mode === "premiumbonus") {
      return await premiumBonusIntegration.earnBonuses(userId, amount, reason);
    }
    return await localLoyaltyService.earnBonuses(userId, amount, reason);
  }

  async spendBonuses(userId, amount, reason) {
    if (this.mode === "premiumbonus") {
      // –°–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —á–µ—Ä–µ–∑ —Å–æ–∑–¥–∞–Ω–∏–µ –ø–æ–∫—É–ø–∫–∏
      return await premiumBonusIntegration.createPurchase({ userId, bonusSpent: amount });
    }
    return await localLoyaltyService.spendBonuses(userId, amount, reason);
  }
}
```

### 5.4 –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

–î–æ–±–∞–≤–∏—Ç—å –≤ `system_settings`:

```sql
INSERT INTO system_settings (`key`, value, description) VALUES
('integration_mode', '{"menu": "local", "loyalty": "local", "orders": "local"}', '–†–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã –º–æ–¥—É–ª–µ–π'),
('iiko_enabled', 'false', '–í–∫–ª—é—á–∏—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é —Å iiko'),
('iiko_api_url', '""', 'URL API iiko'),
('iiko_api_token', '""', '–¢–æ–∫–µ–Ω API iiko'),
('iiko_organization_id', '""', 'ID –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ –≤ iiko'),
('premiumbonus_enabled', 'false', '–í–∫–ª—é—á–∏—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é —Å PremiumBonus'),
('premiumbonus_api_url', '"https://api.premiumbonus.ru"', 'URL API PremiumBonus'),
('premiumbonus_api_token', '""', '–¢–æ–∫–µ–Ω API PremiumBonus'),
('premiumbonus_sale_point_id', '""', 'ID —Ç–æ—á–∫–∏ –ø—Ä–æ–¥–∞–∂ –≤ PremiumBonus');
```

–ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏:

```
–ù–∞—Å—Ç—Ä–æ–π–∫–∏ ‚Üí –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å iiko                       ‚îÇ
‚îÇ ‚òë –í–∫–ª—é—á–∏—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é —Å iiko            ‚îÇ ‚Üê –ü—Ä–∏ –≤–∫–ª—é—á–µ–Ω–∏–∏
‚îÇ   API URL: ____________________________  ‚îÇ   –º–µ–Ω—é –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç
‚îÇ   API Token: __________________________  ‚îÇ   –≤ —Ä–µ–∂–∏–º —á—Ç–µ–Ω–∏—è
‚îÇ   Organization ID: ____________________  ‚îÇ
‚îÇ                                         ‚îÇ
‚îÇ –†–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã –º–æ–¥—É–ª–µ–π:                   ‚îÇ
‚îÇ   –ú–µ–Ω—é: ‚óã –õ–æ–∫–∞–ª—å–Ω–æ–µ  ‚óè iiko             ‚îÇ
‚îÇ   –ó–∞–∫–∞–∑—ã: ‚óã –õ–æ–∫–∞–ª—å–Ω–æ–µ  ‚óè iiko           ‚îÇ
‚îÇ                                         ‚îÇ
‚îÇ ‚ö†Ô∏è –í–Ω–∏–º–∞–Ω–∏–µ! –ü—Ä–∏ –≤–∫–ª—é—á–µ–Ω–∏–∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏   ‚îÇ
‚îÇ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –º–µ–Ω—é –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ      ‚îÇ
‚îÇ —Ç–æ–ª—å–∫–æ –≤ —Å–∏—Å—Ç–µ–º–µ iiko                   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å PremiumBonus               ‚îÇ
‚îÇ ‚òë –í–∫–ª—é—á–∏—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é —Å PremiumBonus    ‚îÇ ‚Üê –ü—Ä–∏ –≤–∫–ª—é—á–µ–Ω–∏–∏
‚îÇ   API URL: ____________________________  ‚îÇ   –ª–æ—è–ª—å–Ω–æ—Å—Ç—å
‚îÇ   API Token: __________________________  ‚îÇ   —É–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –≤ PB
‚îÇ   Sale Point ID: ______________________  ‚îÇ
‚îÇ                                         ‚îÇ
‚îÇ –†–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã:                           ‚îÇ
‚îÇ   –õ–æ—è–ª—å–Ω–æ—Å—Ç—å: ‚óã –õ–æ–∫–∞–ª—å–Ω–∞—è  ‚óè PremiumBonus‚îÇ
‚îÇ                                         ‚îÇ
‚îÇ ‚ö†Ô∏è –í–Ω–∏–º–∞–Ω–∏–µ! –ü—Ä–∏ –≤–∫–ª—é—á–µ–Ω–∏–∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏   ‚îÇ
‚îÇ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–æ–Ω—É—Å–∞–º–∏ –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ      ‚îÇ
‚îÇ —Ç–æ–ª—å–∫–æ –≤ —Å–∏—Å—Ç–µ–º–µ PremiumBonus           ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

[–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏]  [–¢–µ—Å—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è]
```

**–ö–∞–∫ –≤—ã–≥–ª—è–¥–∏—Ç UI –ø—Ä–∏ –≤–∫–ª—é—á–µ–Ω–Ω–æ–π –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å iiko:**

–í —Ä–∞–∑–¥–µ–ª–µ "–ú–µ–Ω—é" –ø–æ—è–≤–ª—è–µ—Ç—Å—è –±–∞–Ω–Ω–µ—Ä:

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ ‚ÑπÔ∏è –†–µ–∂–∏–º —á—Ç–µ–Ω–∏—è: –î–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∏–∑ iiko‚îÇ
‚îÇ –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–æ—Å—Ç—É–ø–Ω–æ —Ç–æ–ª—å–∫–æ –≤ iiko   ‚îÇ
‚îÇ                                         ‚îÇ
‚îÇ –ü–æ—Å–ª–µ–¥–Ω—è—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è: 13.02.2026 14:30‚îÇ
‚îÇ [–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å–µ–π—á–∞—Å]               ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

–ö–Ω–æ–ø–∫–∏ "–°–æ–∑–¥–∞—Ç—å", "–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å", "–£–¥–∞–ª–∏—Ç—å" –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã:

```
–ö–∞—Ç–µ–≥–æ—Ä–∏–∏
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
[üîí –°–æ–∑–¥–∞—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é]  ‚Üê –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ
                           (—Å–µ—Ä–∞—è, —Å –∏–∫–æ–Ω–∫–æ–π –∑–∞–º–∫–∞)

–°–ø–∏—Å–æ–∫ –∫–∞—Ç–µ–≥–æ—Ä–∏–π:
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ –ü–∏—Ü—Ü–∞              [üëÅ –ü—Ä–æ—Å–º–æ—Ç—Ä]‚îÇ ‚Üê —Ç–æ–ª—å–∫–æ –ø—Ä–æ—Å–º–æ—Ç—Ä
‚îÇ –†–æ–ª–ª—ã              [üëÅ –ü—Ä–æ—Å–º–æ—Ç—Ä]‚îÇ
‚îÇ –ù–∞–ø–∏—Ç–∫–∏            [üëÅ –ü—Ä–æ—Å–º–æ—Ç—Ä]‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## 6. –ß—Ç–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –¥–æ—Ä–∞–±–æ—Ç–∞—Ç—å

### 6.1 –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞

1. **–ü–æ–ª—è –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –≤–Ω–µ—à–Ω–∏—Ö ID –∏ —Å—Ç–∞—Ç—É—Å–æ–≤ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Ç–∞–±–ª–∏—Ü–∞—Ö**
   - –î–æ–±–∞–≤–∏—Ç—å `iiko_*_id` –∏ `iiko_synced_at` –≤ —Ç–∞–±–ª–∏—Ü—ã:
     - `menu_items`: `iiko_item_id`, `iiko_synced_at`
     - `item_variants`: `iiko_variant_id`
     - `modifiers`: `iiko_modifier_id`
     - `modifier_groups`: `iiko_modifier_group_id`
     - `menu_categories`: `iiko_category_id`
   - –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –¥–ª—è –∫–ª–∏–µ–Ω—Ç–æ–≤ –≤ `users`:
     - `pb_client_id`, `pb_external_id`
     - `pb_sync_status ENUM('pending', 'synced', 'error', 'failed')`
     - `pb_sync_error TEXT`, `pb_sync_attempts INT`, `pb_last_sync_at TIMESTAMP`
   - –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –¥–ª—è –∑–∞–∫–∞–∑–æ–≤ –≤ `orders`:
     - `iiko_order_id`, `iiko_sync_status`, `iiko_sync_error`, `iiko_sync_attempts`, `iiko_last_sync_at`
     - `pb_purchase_id`, `pb_sync_status`, `pb_sync_error`, `pb_sync_attempts`, `pb_last_sync_at`
   - –°–æ–∑–¥–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É `integration_sync_logs` –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏

2. **–û—á–µ—Ä–µ–¥–∏ –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ —Å –±—É—Ñ–µ—Ä–∏–∑–∞—Ü–∏–µ–π** (BullMQ)
   - `sync:iiko:menu` ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –º–µ–Ω—é –∏–∑ iiko (–∫–∞–∂–¥—ã–µ 30 –º–∏–Ω)
   - `sync:iiko:menu:manual` ‚Äî —Ä—É—á–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ø–æ –∫–Ω–æ–ø–∫–µ –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏
   - `sync:iiko:stoplist` ‚Äî —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å—Ç–æ–ø-–ª–∏—Å—Ç–∞ (–∫–∞–∂–¥—ã–µ 5 –º–∏–Ω)
   - `sync:iiko:orders` ‚Äî –æ—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–∫–∞–∑–æ–≤ –≤ iiko (–æ—á–µ—Ä–µ–¥—å —Å –ø–æ–≤—Ç–æ—Ä–Ω—ã–º–∏ –ø–æ–ø—ã—Ç–∫–∞–º–∏)
   - `sync:iiko:orders:retry` ‚Äî worker –¥–ª—è –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏ pending/error –∑–∞–∫–∞–∑–æ–≤
   - `sync:premiumbonus:clients` ‚Äî —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∫–ª–∏–µ–Ω—Ç–æ–≤ (–ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏/–æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏)
   - `sync:premiumbonus:clients:retry` ‚Äî worker –¥–ª—è –ø–æ–≤—Ç–æ—Ä–Ω–æ–π —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ pending/error –∫–ª–∏–µ–Ω—Ç–æ–≤
   - `sync:premiumbonus:purchases` ‚Äî —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ø–æ–∫—É–ø–æ–∫ (–ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏/–∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ –∑–∞–∫–∞–∑–∞)
   - `sync:premiumbonus:purchases:retry` ‚Äî worker –¥–ª—è –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏ pending/error –ø–æ–∫—É–ø–æ–∫

3. **Worker'—ã –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—á–µ—Ä–µ–¥–µ–π –±—É—Ñ–µ—Ä–∏–∑–∞—Ü–∏–∏**
   - `iikoOrderSyncWorker` ‚Äî –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∑–∞–∫–∞–∑—ã —Å `iiko_sync_status: 'pending'/'error'`
   - `pbClientSyncWorker` ‚Äî –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∫–ª–∏–µ–Ω—Ç–æ–≤ —Å `pb_sync_status: 'pending'/'error'`
   - `pbPurchaseSyncWorker` ‚Äî –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ø–æ–∫—É–ø–∫–∏ —Å `pb_sync_status: 'pending'/'error'`
   - –ú–∞–∫—Å. 5 –ø–æ–ø—ã—Ç–æ–∫, –∑–∞—Ç–µ–º —Å—Ç–∞—Ç—É—Å ‚Üí `failed` —Å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ–º –∞–¥–º–∏–Ω—É

4. **–ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–Ω–µ—à–Ω–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤**
   - –ö–µ—à–∏—Ä–æ–≤–∞—Ç—å –º–µ–Ω—é –∏–∑ iiko –≤ Redis (TTL: 30 –º–∏–Ω—É—Ç)
   - –ü–æ–ª–Ω–∞—è –∫–æ–ø–∏—è –º–µ–Ω—é –≤ –ª–æ–∫–∞–ª—å–Ω–æ–π –ë–î (–¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –∏ fallback)
   - –ö–µ—à–∏—Ä–æ–≤–∞—Ç—å –±–∞–ª–∞–Ω—Å –∫–ª–∏–µ–Ω—Ç–∞ –∏–∑ PremiumBonus (TTL: 5 –º–∏–Ω—É—Ç)
   - –ö–µ—à–∏—Ä–æ–≤–∞—Ç—å –≥—Ä—É–ø–ø—ã –∫–ª–∏–µ–Ω—Ç–æ–≤ –∏–∑ PremiumBonus (TTL: 1 —á–∞—Å)

### 6.2 API endpoints

#### –î–ª—è –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏:

- `GET /api/admin/integrations/settings` ‚Äî —Ç–µ–∫—É—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π
- `PUT /api/admin/integrations/settings` ‚Äî –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫
- `POST /api/admin/integrations/iiko/test-connection` ‚Äî —Ç–µ—Å—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ iiko
- `POST /api/admin/integrations/premiumbonus/test-connection` ‚Äî —Ç–µ—Å—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ PremiumBonus
- `POST /api/admin/integrations/iiko/sync-menu` ‚Äî —Ä—É—á–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –º–µ–Ω—é –∏–∑ iiko (–∑–∞–≥—Ä—É–∑–∏—Ç—å –≤—Å—ë –º–µ–Ω—é)
- `GET /api/admin/integrations/iiko/sync-status` ‚Äî —Å—Ç–∞—Ç—É—Å –ø–æ—Å–ª–µ–¥–Ω–µ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
- `GET /api/admin/integrations/sync-logs` ‚Äî –ª–æ–≥–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ —Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏

#### Webhooks:

- `POST /api/webhooks/iiko/order-status` ‚Äî webhook –æ—Ç iiko –æ —Å–º–µ–Ω–µ —Å—Ç–∞—Ç—É—Å–∞ –∑–∞–∫–∞–∑–∞
- `POST /api/webhooks/iiko/stoplist` ‚Äî webhook –æ—Ç iiko –æ–± –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å—Ç–æ–ø-–ª–∏—Å—Ç–∞

#### –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ —Å–µ—Ä–≤–∏—Å—ã:

- `iikoIntegration.js` ‚Äî –∫–ª–∏–µ–Ω—Ç –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å iiko API
- `premiumBonusIntegration.js` ‚Äî –∫–ª–∏–µ–Ω—Ç –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å PremiumBonus API
- `menuAdapter.js` ‚Äî –∞–¥–∞–ø—Ç–µ—Ä –º–µ–Ω—é
- `loyaltyAdapter.js` ‚Äî –∞–¥–∞–ø—Ç–µ—Ä –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏
- `ordersAdapter.js` ‚Äî –∞–¥–∞–ø—Ç–µ—Ä –∑–∞–∫–∞–∑–æ–≤

#### Middleware –¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:

- `checkIikoIntegration.js` ‚Äî middleware –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–µ–∂–∏–º–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å iiko
  ```javascript
  // –ü—Ä–∏–º–µ—Ä
  export const checkIikoIntegration = async (req, res, next) => {
    const settings = await getSystemSettings();
    if (settings.iiko_enabled && req.method !== "GET") {
      return res.status(403).json({
        error: "Menu editing is disabled when iiko integration is active",
        message: "Please manage menu in iiko system",
      });
    }
    next();
  };
  ```
- `checkPremiumBonusIntegration.js` ‚Äî middleware –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–µ–∂–∏–º–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å PremiumBonus
  ```javascript
  // –ü—Ä–∏–º–µ—Ä
  export const checkPremiumBonusIntegration = async (req, res, next) => {
    const settings = await getSystemSettings();
    if (settings.premiumbonus_enabled && ["POST", "PUT", "DELETE"].includes(req.method)) {
      return res.status(403).json({
        error: "Loyalty management is disabled when PremiumBonus integration is active",
        message: "Please manage loyalty in PremiumBonus system",
      });
    }
    next();
  };
  ```
- –ü—Ä–∏–º–µ–Ω–∏—Ç—å middleware –Ω–∞ –≤—Å–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –º–µ–Ω—é, –∫–∞—Ç–µ–≥–æ—Ä–∏–π, –º–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä–æ–≤, —É—Ä–æ–≤–Ω–µ–π –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏

### 6.3 –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å

1. **–ù–æ–≤—ã–π —Ä–∞–∑–¥–µ–ª "–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏"** –≤ –º–µ–Ω—é
   - –ù–∞—Å—Ç—Ä–æ–π–∫–∏ iiko
   - –ù–∞—Å—Ç—Ä–æ–π–∫–∏ PremiumBonus
   - –õ–æ–≥–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
   - –¢–µ—Å—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

2. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –º–µ–Ω—é –∏–∑ iiko**
   - –ö–Ω–æ–ø–∫–∞ **"–ó–∞–≥—Ä—É–∑–∏—Ç—å –º–µ–Ω—é –∏–∑ iiko"** –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –≤–∫–ª—é—á–µ–Ω–∏–∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
   - –ö–Ω–æ–ø–∫–∞ **"–û–±–Ω–æ–≤–∏—Ç—å –º–µ–Ω—é —Å–µ–π—á–∞—Å"** –¥–ª—è —Ä—É—á–Ω–æ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
   - –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏:
     ```
     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
     ‚îÇ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –º–µ–Ω—é –∏–∑ iiko              ‚îÇ
     ‚îÇ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ ‚îÇ
     ‚îÇ –°—Ç–∞—Ç—É—Å: ‚úÖ –£—Å–ø–µ—à–Ω–æ                      ‚îÇ
     ‚îÇ –ü–æ—Å–ª–µ–¥–Ω—è—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è: 13.02.2026 14:30‚îÇ
     ‚îÇ –ó–∞–≥—Ä—É–∂–µ–Ω–æ –ø–æ–∑–∏—Ü–∏–π: 156                  ‚îÇ
     ‚îÇ –ö–∞—Ç–µ–≥–æ—Ä–∏–π: 12                           ‚îÇ
     ‚îÇ –ú–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä–æ–≤: 48                       ‚îÇ
     ‚îÇ                                         ‚îÇ
     ‚îÇ [–û–±–Ω–æ–≤–∏—Ç—å –º–µ–Ω—é —Å–µ–π—á–∞—Å]                  ‚îÇ
     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
     ```
   - –ü—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä –ø—Ä–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
   - –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ–± —É—Å–ø–µ—à–Ω–æ–π/–Ω–µ—É—Å–ø–µ—à–Ω–æ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏

3. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å—Ç–∞—Ç—É—Å–æ–≤ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ (–ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û)**
   - –í–∏–¥–∂–µ—Ç —Å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –Ω–µ—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π:
     ```
     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
     ‚îÇ –°—Ç–∞—Ç—É—Å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏                    ‚îÇ
     ‚îÇ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ ‚îÇ
     ‚îÇ –ó–∞–∫–∞–∑—ã (iiko):                          ‚îÇ
     ‚îÇ   ‚úÖ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–æ: 1245             ‚îÇ
     ‚îÇ   ‚è≥ –í –æ—á–µ—Ä–µ–¥–∏: 3                       ‚îÇ
     ‚îÇ   ‚ùå –û—à–∏–±–æ–∫: 1                          ‚îÇ
     ‚îÇ   ‚ö†Ô∏è –¢—Ä–µ–±—É—é—Ç –≤–Ω–∏–º–∞–Ω–∏—è: 0                ‚îÇ
     ‚îÇ                                         ‚îÇ
     ‚îÇ –ö–ª–∏–µ–Ω—Ç—ã (PremiumBonus):                 ‚îÇ
     ‚îÇ   ‚úÖ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–æ: 856              ‚îÇ
     ‚îÇ   ‚è≥ –í –æ—á–µ—Ä–µ–¥–∏: 2                       ‚îÇ
     ‚îÇ   ‚ùå –û—à–∏–±–æ–∫: 0                          ‚îÇ
     ‚îÇ                                         ‚îÇ
     ‚îÇ –ü–æ–∫—É–ø–∫–∏ (PremiumBonus):                 ‚îÇ
     ‚îÇ   ‚úÖ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–æ: 1180             ‚îÇ
     ‚îÇ   ‚è≥ –í –æ—á–µ—Ä–µ–¥–∏: 5                       ‚îÇ
     ‚îÇ   ‚ùå –û—à–∏–±–æ–∫: 2                          ‚îÇ
     ‚îÇ                                         ‚îÇ
     ‚îÇ [–ü–æ–≤—Ç–æ—Ä–∏—Ç—å –≤—Å–µ –æ—à–∏–±–æ—á–Ω—ã–µ]               ‚îÇ
     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
     ```
   - –ê–ª–µ—Ä—Ç—ã –ø—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ –ø–æ—Ä–æ–≥–∞ –æ—à–∏–±–æ–∫ (–Ω–∞–ø—Ä–∏–º–µ—Ä, >10 failed –∑–∞–ø–∏—Å–µ–π)
   - –ö–Ω–æ–ø–∫–∞ –¥–ª—è —Ä—É—á–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ –ø–æ–≤—Ç–æ—Ä–Ω–æ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏

4. **–õ–æ–≥–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏**
   - –¢–∞–±–ª–∏—Ü–∞ —Å –∏—Å—Ç–æ—Ä–∏–µ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
   - –§–∏–ª—å—Ç—Ä—ã: –¥–∞—Ç–∞, –º–æ–¥—É–ª—å, —Å—Ç–∞—Ç—É—Å (success/error)
   - –î–µ—Ç–∞–ª–∏ –æ—à–∏–±–æ–∫ –∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π
   - –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å, —á—Ç–æ –∏–º–µ–Ω–Ω–æ –±—ã–ª–æ –æ–±–Ω–æ–≤–ª–µ–Ω–æ (–¥–æ–±–∞–≤–ª–µ–Ω–æ –Ω–æ–≤—ã—Ö –ø–æ–∑–∏—Ü–∏–π, –æ–±–Ω–æ–≤–ª–µ–Ω–æ —Ü–µ–Ω –∏ —Ç.–¥.)

5. **–ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ UI –ø—Ä–∏ –≤–∫–ª—é—á–µ–Ω–Ω–æ–π –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏**
   - –ü—Ä–∏ `iiko_enabled: true`:
     - –°–∫—Ä—ã—Ç—å –∫–Ω–æ–ø–∫–∏ "–°–æ–∑–¥–∞—Ç—å", "–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å", "–£–¥–∞–ª–∏—Ç—å" –≤ —Ä–∞–∑–¥–µ–ª–∞—Ö: –ú–µ–Ω—é, –ö–∞—Ç–µ–≥–æ—Ä–∏–∏, –ú–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã, –°—Ç–æ–ø-–ª–∏—Å—Ç
     - –ü–æ–∫–∞–∑–∞—Ç—å badge "–†–µ–∂–∏–º —á—Ç–µ–Ω–∏—è (–¥–∞–Ω–Ω—ã–µ –∏–∑ iiko)" –≤ —à–∞–ø–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü
     - –ü—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ–∫–∞–∑–∞—Ç—å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ: "–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å iiko –∞–∫—Ç–∏–≤–Ω–∞."
   - –ü—Ä–∏ `premiumbonus_enabled: true`:
     - –°–∫—Ä—ã—Ç—å —Ä–∞–∑–¥–µ–ª "–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —É—Ä–æ–≤–Ω—è–º–∏ –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏"
     - –°–∫—Ä—ã—Ç—å –∫–Ω–æ–ø–∫–∏ —Ä—É—á–Ω–æ–≥–æ –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è/—Å–ø–∏—Å–∞–Ω–∏—è –±–æ–Ω—É—Å–æ–≤
     - –ü–æ–∫–∞–∑–∞—Ç—å badge "–õ–æ—è–ª—å–Ω–æ—Å—Ç—å —á–µ—Ä–µ–∑ PremiumBonus"
     - –û—Å—Ç–∞–≤–∏—Ç—å –ø—Ä–æ—Å–º–æ—Ç—Ä –¥–∞–Ω–Ω—ã—Ö (read-only)

### 6.4 Telegram Mini App

1. **–†–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã —Å PremiumBonus**
   - –û—Ç–æ–±—Ä–∞–∂–∞—Ç—å –±–∞–ª–∞–Ω—Å –∏ —É—Ä–æ–≤–µ–Ω—å –∏–∑ PremiumBonus
   - –ü—Ä–∏ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–∏ –∑–∞–∫–∞–∑–∞ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –¥–æ—Å—Ç—É–ø–Ω—ã–µ –±–æ–Ω—É—Å—ã –∏–∑ PremiumBonus
   - –ò—Å—Ç–æ—Ä–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –∏–∑ PremiumBonus

2. **–ò–Ω–¥–∏–∫–∞—Ü–∏—è —Ä–µ–∂–∏–º–∞ —Ä–∞–±–æ—Ç—ã**
   - –í –ø—Ä–æ—Ñ–∏–ª–µ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –∏—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏ (–ª–æ–∫–∞–ª—å–Ω—ã–π / PremiumBonus)

---

## 7. –§—É–Ω–∫—Ü–∏–∏, –∫–æ—Ç–æ—Ä—ã–µ —Å—Ç–∞–Ω–æ–≤—è—Ç—Å—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã –ø—Ä–∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

### 7.1 –ü—Ä–∏ –≤–∫–ª—é—á–µ–Ω–∏–∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å iiko (–º–µ–Ω—é)

**–°—Ç–∞–Ω–æ–≤—è—Ç—Å—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã –≤ UI –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏ (—Ä–µ–∂–∏–º "—Ç–æ–ª—å–∫–æ —á—Ç–µ–Ω–∏—è"):**

- ‚ùå –°–æ–∑–¥–∞–Ω–∏–µ/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ/—É–¥–∞–ª–µ–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–π (—É–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –≤ iiko)
- ‚ùå –°–æ–∑–¥–∞–Ω–∏–µ/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ/—É–¥–∞–ª–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–π –º–µ–Ω—é (—É–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –≤ iiko)
- ‚ùå –°–æ–∑–¥–∞–Ω–∏–µ/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ/—É–¥–∞–ª–µ–Ω–∏–µ –º–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä–æ–≤ (—É–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –≤ iiko)
- ‚ùå –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ü–µ–Ω–∞–º–∏ (—Ü–µ–Ω—ã –±–µ—Ä—É—Ç—Å—è –∏–∑ iiko)
- ‚ùå –†—É—á–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ç–æ–ø-–ª–∏—Å—Ç–æ–º (—É–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –∏–∑ iiko –ø–æ –æ—Å—Ç–∞—Ç–∫–∞–º)
- ‚ùå –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–æ–Ω–∞–º–∏ –¥–æ—Å—Ç–∞–≤–∫–∏ (–±–µ—Ä—É—Ç—Å—è –∏–∑ iiko)

**–û—Å—Ç–∞—é—Ç—Å—è –¥–æ—Å—Ç—É–ø–Ω—ã–º–∏:**

- ‚úÖ –ü—Ä–æ—Å–º–æ—Ç—Ä –º–µ–Ω—é –≤ —Ä–µ–∂–∏–º–µ —á—Ç–µ–Ω–∏—è (read-only)
- ‚úÖ –ú–∞–ø–ø–∏–Ω–≥ –ø–æ–∑–∏—Ü–∏–π —Å iiko ID (—Å–≤—è–∑—ã–≤–∞–Ω–∏–µ –ª–æ–∫–∞–ª—å–Ω—ã—Ö ID —Å ID –≤ iiko)
- ‚úÖ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–µ–≥–∞–º–∏ (–ª–æ–∫–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è, –Ω–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç—Å—è —Å iiko)
- ‚úÖ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏ (–µ—Å–ª–∏ iiko –Ω–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç —Ñ–æ—Ç–æ –∏–ª–∏ –Ω—É–∂–Ω—ã –ª–æ–∫–∞–ª—å–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã)
- ‚úÖ –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏

**–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è:**

- –ö–Ω–æ–ø–∫–∏ "–°–æ–∑–¥–∞—Ç—å", "–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å", "–£–¥–∞–ª–∏—Ç—å" —Å–∫—Ä—ã–≤–∞—é—Ç—Å—è –∏–ª–∏ –±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è –≤ UI
- –ü—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –ø—Ä—è–º–æ–≥–æ POST/PUT/DELETE –∑–∞–ø—Ä–æ—Å–∞ –∫ API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –æ—à–∏–±–∫–∞ —Å –∫–æ–¥–æ–º 403:
  ```json
  {
    "error": "Menu editing is disabled. Integration with iiko is active. Please manage menu in iiko system."
  }
  ```
- –î–∞–Ω–Ω—ã–µ –≤ –ª–æ–∫–∞–ª—å–Ω–æ–π –ë–î –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é –∏–∑ iiko

### 7.2 –ü—Ä–∏ –≤–∫–ª—é—á–µ–Ω–∏–∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å PremiumBonus (–ª–æ—è–ª—å–Ω–æ—Å—Ç—å)

**–°—Ç–∞–Ω–æ–≤—è—Ç—Å—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã –≤ UI –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏:**

- ‚ùå –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —É—Ä–æ–≤–Ω—è–º–∏ –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏ (–Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è –≤ –ø–∞–Ω–µ–ª–∏ PremiumBonus)
- ‚ùå –†—É—á–Ω–æ–µ –Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ/—Å–ø–∏—Å–∞–Ω–∏–µ –±–æ–Ω—É—Å–æ–≤ (–¥–µ–ª–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ –ø–∞–Ω–µ–ª—å PremiumBonus)
- ‚ùå –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏: –ø—Ä–æ—Ü–µ–Ω—Ç –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è, —Å—Ä–æ–∫ –∏—Å—Ç–µ—á–µ–Ω–∏—è, —É—Å–ª–æ–≤–∏—è —É—Ä–æ–≤–Ω–µ–π (–≤ PremiumBonus)
- ‚ùå –¢—Ä–∏–≥–≥–µ—Ä–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (–¥–µ–Ω—å —Ä–æ–∂–¥–µ–Ω–∏—è, —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è) ‚Äî –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—é—Ç—Å—è –≤ —Å—Ü–µ–Ω–∞—Ä–∏—è—Ö PremiumBonus

**–û—Å—Ç–∞—é—Ç—Å—è –¥–æ—Å—Ç—É–ø–Ω—ã–º–∏:**

- ‚úÖ –ü—Ä–æ—Å–º–æ—Ç—Ä –±–∞–ª–∞–Ω—Å–∞ –∫–ª–∏–µ–Ω—Ç–∞ (—á–∏—Ç–∞–µ—Ç—Å—è –∏–∑ PremiumBonus)
- ‚úÖ –ü—Ä–æ—Å–º–æ—Ç—Ä –∏—Å—Ç–æ—Ä–∏–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π (—á–∏—Ç–∞–µ—Ç—Å—è –∏–∑ PremiumBonus)
- ‚úÖ –ü—Ä–æ—Å–º–æ—Ç—Ä —Ç–µ–∫—É—â–µ–≥–æ —É—Ä–æ–≤–Ω—è –∫–ª–∏–µ–Ω—Ç–∞
- ‚úÖ –ü—Ä–æ—Å–º–æ—Ç—Ä –ø—Ä–æ—Ñ–∏–ª—è –∫–ª–∏–µ–Ω—Ç–∞
- ‚úÖ –ü—Ä–æ—Å–º–æ—Ç—Ä —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø–æ –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏

**–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è:**

- –†–∞–∑–¥–µ–ª—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ª–æ—è–ª—å–Ω–æ—Å—Ç—å—é –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏ —Å–∫—Ä—ã–≤–∞—é—Ç—Å—è –ø—Ä–∏ `premiumbonus_enabled: true`
- –ó–∞–ø—Ä–æ—Å—ã –∫ –ª–æ–∫–∞–ª—å–Ω—ã–º endpoint'–∞–º –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –Ω–∞ PremiumBonus —á–µ—Ä–µ–∑ –∞–¥–∞–ø—Ç–µ—Ä
- –õ–æ–∫–∞–ª—å–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã `loyalty_transactions`, `user_loyalty_levels` –Ω–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è, –Ω–æ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –¥–ª—è –≤–æ–∑–º–æ–∂–Ω–æ–≥–æ –≤–æ–∑–≤—Ä–∞—Ç–∞ –∫ –∞–≤—Ç–æ–Ω–æ–º–Ω–æ–º—É —Ä–µ–∂–∏–º—É

### 7.3 –ß—Ç–æ –ù–ï —É–¥–∞–ª—è–µ—Ç—Å—è

**–í–∞–∂–Ω–æ:** –õ–æ–∫–∞–ª—å–Ω—ã–µ –º–æ–¥—É–ª–∏ –∏ —Ñ—É–Ω–∫—Ü–∏–∏ **–Ω–µ —É–¥–∞–ª—è—é—Ç—Å—è** –∏–∑ –∫–æ–¥–∞ –∏ –ë–î, –∞ –ø–µ—Ä–µ–≤–æ–¥—è—Ç—Å—è –≤ –Ω–µ–∞–∫—Ç–∏–≤–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–∏ –≤–∫–ª—é—á–µ–Ω–∏–∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏. –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç:

1. **–ë—ã—Å—Ç—Ä–æ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç—å—Å—è** –º–µ–∂–¥—É —Ä–µ–∂–∏–º–∞–º–∏ —Ä–∞–±–æ—Ç—ã —á–µ—Ä–µ–∑ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
2. **–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –¥–∞–Ω–Ω—ã–µ** –ø—Ä–∏ –≤—Ä–µ–º–µ–Ω–Ω–æ–º –æ—Ç–∫–ª—é—á–µ–Ω–∏–∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
3. **–ò–º–µ—Ç—å backup** –Ω–∞ —Å–ª—É—á–∞–π –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –≤–Ω–µ—à–Ω–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
4. **–õ–µ–≥–∫–æ –≤–µ—Ä–Ω—É—Ç—å—Å—è** –∫ –∞–≤—Ç–æ–Ω–æ–º–Ω–æ–º—É —Ä–µ–∂–∏–º—É –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏

**–ú–µ—Ö–∞–Ω–∏–∑–º –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è:**

- –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å: "–ù–∞—Å—Ç—Ä–æ–π–∫–∏ ‚Üí –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ ‚Üí –í–∫–ª—é—á–∏—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é —Å iiko/PremiumBonus"
- –ü—Ä–∏ –≤–∫–ª—é—á–µ–Ω–∏–∏: UI –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è, –∑–∞–ø—Ä–æ—Å—ã –∏–¥—É—Ç —á–µ—Ä–µ–∑ –∞–¥–∞–ø—Ç–µ—Ä—ã –∫ –≤–Ω–µ—à–Ω–∏–º API
- –ü—Ä–∏ –≤—ã–∫–ª—é—á–µ–Ω–∏–∏: UI —Ä–∞–∑–±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è, –∑–∞–ø—Ä–æ—Å—ã –∏–¥—É—Ç –∫ –ª–æ–∫–∞–ª—å–Ω–æ–π –ë–î

---

## 8. –ù–µ–¥–æ—Å—Ç–∞—é—â–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏

### 8.1 –î–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å iiko

1. **–ú–æ–¥—É–ª—å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –º–µ–Ω—é**
   - –ó–∞–ø—Ä–æ—Å –ø–æ–ª–Ω–æ–π –Ω–æ–º–µ–Ω–∫–ª–∞—Ç—É—Ä—ã –∏–∑ iiko API
   - –ü–∞—Ä—Å–∏–Ω–≥ –∫–∞—Ç–µ–≥–æ—Ä–∏–π, –ø–æ–∑–∏—Ü–∏–π, –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤, –º–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä–æ–≤ –∏–∑ –æ—Ç–≤–µ—Ç–∞ iiko
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ/–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–ø–∏—Å–µ–π –≤ –ª–æ–∫–∞–ª—å–Ω–æ–π –ë–î
   - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ `iiko_*_id` –¥–ª—è —Å–≤—è–∑–∏ —Å iiko
   - –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã iiko –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä—É FoodMiniApp
   - –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –∏–∑ iiko (URL –∏–ª–∏ —Ñ–∞–π–ª—ã)
   - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ü–µ–Ω –∏ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏
   - –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π (—á—Ç–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ, —á—Ç–æ –æ–±–Ω–æ–≤–ª–µ–Ω–æ)

2. **–ú–æ–¥—É–ª—å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ —Å—Ç–æ–ø-–ª–∏—Å—Ç–∞**
   - –ó–∞–ø—Ä–æ—Å –æ—Å—Ç–∞—Ç–∫–æ–≤ –∏–∑ iiko API
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ —Å—Ç–æ–ø-–ª–∏—Å—Ç –ø–æ–∑–∏—Ü–∏–π —Å –Ω—É–ª–µ–≤—ã–º –æ—Å—Ç–∞—Ç–∫–æ–º
   - –£—á–µ—Ç –ø–æ–ª—É—Ñ–∞–±—Ä–∏–∫–∞—Ç–æ–≤ –∏ —Ä–µ—Ü–µ–ø—Ç—É—Ä (–µ—Å–ª–∏ iiko –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç)
   - –£–¥–∞–ª–µ–Ω–∏–µ –∏–∑ —Å—Ç–æ–ø-–ª–∏—Å—Ç–∞ –ø–æ–∑–∏—Ü–∏–π, –∫–æ—Ç–æ—Ä—ã–µ —Å–Ω–æ–≤–∞ –≤ –Ω–∞–ª–∏—á–∏–∏

3. **–ú–æ–¥—É–ª—å –æ—Ç–ø—Ä–∞–≤–∫–∏ –∑–∞–∫–∞–∑–æ–≤ –≤ iiko (—Å –æ—á–µ—Ä–µ–¥—å—é)**
   - –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞ –≤ —Ñ–æ—Ä–º–∞—Ç–µ iiko
   - –û—Ç–ø—Ä–∞–≤–∫–∞ —á–µ—Ä–µ–∑ API iiko
   - –ü—Ä–∏ —É—Å–ø–µ—Ö–µ: —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ `iiko_order_id`, —Å—Ç–∞—Ç—É—Å ‚Üí `synced`
   - –ü—Ä–∏ –æ—à–∏–±–∫–µ: —Å—Ç–∞—Ç—É—Å ‚Üí `pending`/`error`, –ø–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤ –æ—á–µ—Ä–µ–¥—å –Ω–∞ –ø–æ–≤—Ç–æ—Ä
   - –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ä–µ—Ç—Ä–∞–∏ (–º–∞–∫—Å. 5 –ø–æ–ø—ã—Ç–æ–∫)

4. **Worker –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—á–µ—Ä–µ–¥–∏ –∑–∞–∫–∞–∑–æ–≤**
   - –ö–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç –Ω–∞—Ö–æ–¥–∏—Ç –∑–∞–∫–∞–∑—ã —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º `pending`/`error`
   - –ü—ã—Ç–∞–µ—Ç—Å—è –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –∏—Ö –≤ iiko API
   - –ü—Ä–∏ —É—Å–ø–µ—Ö–µ: –æ–±–Ω–æ–≤–ª—è–µ—Ç —Å—Ç–∞—Ç—É—Å –Ω–∞ `synced`
   - –ü—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ –ª–∏–º–∏—Ç–∞ –ø–æ–ø—ã—Ç–æ–∫: —Å—Ç–∞—Ç—É—Å ‚Üí `failed`, —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∞–¥–º–∏–Ω—É

5. **Webhook-–æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—Ç iiko**
   - Endpoint –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –æ —Å–º–µ–Ω–µ —Å—Ç–∞—Ç—É—Å–∞
   - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –∑–∞–∫–∞–∑–∞ –≤ FoodMiniApp
   - –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π

6. **–ú–∞–ø–ø–∏–Ω–≥ –ø–æ–∑–∏—Ü–∏–π**
   - UI –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Å–≤—è–∑–µ–π –º–µ–∂–¥—É FoodMiniApp –∏ iiko
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –º–∞–ø–ø–∏–Ω–≥ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—è–º (—Å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ–º)
   - –í–∞–ª–∏–¥–∞—Ü–∏—è –º–∞–ø–ø–∏–Ω–≥–∞

7. **–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∑–æ–Ω –¥–æ—Å—Ç–∞–≤–∫–∏**
   - –ü–æ–ª—É—á–µ–Ω–∏–µ –∑–æ–Ω –¥–æ—Å—Ç–∞–≤–∫–∏ –∏–∑ iiko
   - –ú–∞–ø–ø–∏–Ω–≥ —Å –ø–æ–ª–∏–≥–æ–Ω–∞–º–∏ –≤ FoodMiniApp

### 8.2 –î–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å PremiumBonus

1. **–ú–æ–¥—É–ª—å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –∫–ª–∏–µ–Ω—Ç–æ–≤**
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–∞ –≤ PremiumBonus –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –≤—Ö–æ–¥–µ: `POST /buyer-info`
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ù–û–í–´–• –∫–ª–∏–µ–Ω—Ç–æ–≤ –≤ PremiumBonus: `POST /buyer-register`
   - –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –°–£–©–ï–°–¢–í–£–Æ–©–ò–• –∫–ª–∏–µ–Ω—Ç–æ–≤ –∏–∑ PremiumBonus
   - –£—Å–ª–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã—Ö –±–æ–Ω—É—Å–æ–≤:

     ```javascript
     // –ü—Å–µ–≤–¥–æ–∫–æ–¥
     async function registerOrLinkClient(phone, userData) {
       // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –∫–ª–∏–µ–Ω—Ç –≤ PremiumBonus
       const pbClient = await premiumBonusAPI.getBuyerInfo(phone);

       if (pbClient.is_registered) {
         // –ö–ª–∏–µ–Ω—Ç —É–∂–µ –µ—Å—Ç—å –≤ PB - –∑–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ
         await createLocalUser({
           ...userData,
           pb_client_id: pbClient.client_id,
           loyalty_mode: "premiumbonus",
         });
         // –ù–ï –Ω–∞—á–∏—Å–ª—è–µ–º –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–µ –±–æ–Ω—É—Å—ã
         return { isNew: false, client: pbClient };
       } else {
         // –ù–æ–≤—ã–π –∫–ª–∏–µ–Ω—Ç - —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º –≤ PB
         const newPbClient = await premiumBonusAPI.registerBuyer({
           phone: phone,
           ...userData,
         });
         await createLocalUser({
           ...userData,
           pb_client_id: newPbClient.client_id,
           loyalty_mode: "premiumbonus",
         });
         // –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–µ –±–æ–Ω—É—Å—ã –Ω–∞—á–∏—Å–ª–∏—Ç PremiumBonus –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
         return { isNew: true, client: newPbClient };
       }
     }
     ```

   - –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ø—Ä–æ—Ñ–∏–ª—è –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏: `POST /buyer-edit`
   - –•—Ä–∞–Ω–µ–Ω–∏–µ `client_id` –∏ `external_id` –≤ –ª–æ–∫–∞–ª—å–Ω–æ–π –ë–î

2. **–ú–æ–¥—É–ª—å –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è/—Å–ø–∏—Å–∞–Ω–∏—è –±–æ–Ω—É—Å–æ–≤ (—Å –æ—á–µ—Ä–µ–¥—å—é)**
   - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –ø—Ä–æ—Ü–µ—Å—Å–æ–º –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞
   - –í—ã–∑–æ–≤ `POST /purchase-request` –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ –≤—ã–≥–æ–¥—ã (–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ)
   - –ü–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤ –æ—á–µ—Ä–µ–¥—å –∑–∞–¥–∞—á–∏ –Ω–∞ —Å–æ–∑–¥–∞–Ω–∏–µ –ø–æ–∫—É–ø–∫–∏: `POST /purchase`
   - –ü—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ –∑–∞–∫–∞–∑–∞: –ø–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤ –æ—á–µ—Ä–µ–¥—å –∑–∞–¥–∞—á–∏ `POST /change-purchase-status`
   - –ü—Ä–∏ –æ—Ç–º–µ–Ω–µ –∑–∞–∫–∞–∑–∞: –ø–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤ –æ—á–µ—Ä–µ–¥—å –∑–∞–¥–∞—á–∏ `POST /cancel-purchase`
   - –ü—Ä–∏ —É—Å–ø–µ—Ö–µ: —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ `pb_purchase_id`, —Å—Ç–∞—Ç—É—Å ‚Üí `synced`
   - –ü—Ä–∏ –æ—à–∏–±–∫–µ: —Å—Ç–∞—Ç—É—Å ‚Üí `pending`/`error`, –ø–æ–≤—Ç–æ—Ä —á–µ—Ä–µ–∑ 5 –º–∏–Ω—É—Ç

3. **Worker –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—á–µ—Ä–µ–¥–∏ –ø–æ–∫—É–ø–æ–∫**
   - –ö–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç –Ω–∞—Ö–æ–¥–∏—Ç –ø–æ–∫—É–ø–∫–∏ —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º `pending`/`error`
   - –ü—ã—Ç–∞–µ—Ç—Å—è –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –∏—Ö –≤ PremiumBonus API
   - –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Å–æ–∑–¥–∞–Ω–∏–µ, –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –∏ –æ—Ç–º–µ–Ω—É –ø–æ–∫—É–ø–æ–∫
   - –ü—Ä–∏ —É—Å–ø–µ—Ö–µ: –æ–±–Ω–æ–≤–ª—è–µ—Ç —Å—Ç–∞—Ç—É—Å –Ω–∞ `synced`
   - –ü—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ –ª–∏–º–∏—Ç–∞ –ø–æ–ø—ã—Ç–æ–∫: —Å—Ç–∞—Ç—É—Å ‚Üí `failed`, —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∞–¥–º–∏–Ω—É

4. **Worker –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—á–µ—Ä–µ–¥–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –∫–ª–∏–µ–Ω—Ç–æ–≤**
   - –ö–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç –Ω–∞—Ö–æ–¥–∏—Ç –∫–ª–∏–µ–Ω—Ç–æ–≤ —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º `pb_sync_status: 'pending'`
   - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ –≤ PremiumBonus —á–µ—Ä–µ–∑ `POST /buyer-info`
   - –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç –Ω–æ–≤—ã—Ö –∏–ª–∏ —Å–≤—è–∑—ã–≤–∞–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö
   - –ü—Ä–∏ —É—Å–ø–µ—Ö–µ: —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç `pb_client_id`, —Å—Ç–∞—Ç—É—Å ‚Üí `synced`
   - –ü—Ä–∏ –æ—à–∏–±–∫–µ: –ø–æ–≤—Ç–æ—Ä —á–µ—Ä–µ–∑ 5 –º–∏–Ω—É—Ç (–º–∞–∫—Å. 5 –ø–æ–ø—ã—Ç–æ–∫)

5. **–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —É—Ä–æ–≤–Ω–µ–π –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏**
   - –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏–π –∑–∞–ø—Ä–æ—Å –≥—Ä—É–ø–ø –∫–ª–∏–µ–Ω—Ç–æ–≤ –∏–∑ PremiumBonus
   - –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ Redis
   - –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ —É—Ä–æ–≤–Ω—è –≤ Mini App

6. **–ü—Ä–æ–º–æ–∫–æ–¥—ã**
   - –í—ã–∑–æ–≤ `POST /promocode/activate-promocode` –ø—Ä–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–∏ –ø—Ä–æ–º–æ–∫–æ–¥–∞
   - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ –ø—Ä–æ—Ü–µ—Å—Å –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞

7. **–ò—Å—Ç–æ—Ä–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π**
   - –ó–∞–ø—Ä–æ—Å –∏—Å—Ç–æ—Ä–∏–∏ –∏–∑ PremiumBonus
   - –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤ Mini App –∏ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏

8. **–ê–¥–∞–ø—Ç–µ—Ä –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏**
   - –ï–¥–∏–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ª–æ–∫–∞–ª—å–Ω–æ–π –ª–æ—è–ª—å–Ω–æ—Å—Ç—å—é –∏ PremiumBonus
   - –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ä–µ–∂–∏–º–æ–≤ —á–µ—Ä–µ–∑ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

### 8.3 –û–±—â–∞—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞

1. **–°–∏—Å—Ç–µ–º–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏**
   - –¢–∞–±–ª–∏—Ü–∞ `integration_sync_logs`:
     ```sql
     CREATE TABLE integration_sync_logs (
       id INT AUTO_INCREMENT PRIMARY KEY,
       integration_type ENUM('iiko', 'premiumbonus') NOT NULL,
       module ENUM('menu', 'orders', 'stoplist', 'clients', 'loyalty') NOT NULL,
       action VARCHAR(100) NOT NULL,
       status ENUM('success', 'error') NOT NULL,
       error_message TEXT NULL,
       request_data JSON NULL,
       response_data JSON NULL,
       duration_ms INT NULL,
       created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
       INDEX idx_type_module (integration_type, module),
       INDEX idx_status (status),
       INDEX idx_created_at (created_at)
     );
     ```

2. **–°–∏—Å—Ç–µ–º–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞**
   - –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ Telegram –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
   - –î–∞—à–±–æ—Ä–¥ –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏ —Å –º–µ—Ç—Ä–∏–∫–∞–º–∏:
     - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—Å–ø–µ—à–Ω—ã—Ö/–Ω–µ—É—Å–ø–µ—à–Ω—ã—Ö —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–π
     - –°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
     - –ü–æ—Å–ª–µ–¥–Ω—è—è —É—Å–ø–µ—à–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è

3. **–ú–µ—Ö–∞–Ω–∏–∑–º —Ä–µ—Ç—Ä–∞–µ–≤**
   - –î–ª—è –Ω–µ—É–¥–∞—á–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ –≤–Ω–µ—à–Ω–∏–º API
   - –≠–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ (1s, 2s, 4s, 8s...)
   - –ú–∞–∫—Å–∏–º—É–º 5 –ø–æ–ø—ã—Ç–æ–∫
   - –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –ø–æ–ø—ã—Ç–æ–∫

4. **Rate limiting**
   - –î–ª—è –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ –≤–Ω–µ—à–Ω–∏–º API
   - –£—á–µ—Ç –ª–∏–º–∏—Ç–æ–≤ iiko (100 req/min) –∏ PremiumBonus
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Redis –¥–ª—è –ø–æ–¥—Å—á–µ—Ç–∞ –∑–∞–ø—Ä–æ—Å–æ–≤

---

## 9. –ü–æ—ç—Ç–∞–ø–Ω—ã–π –ø–ª–∞–Ω –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

### –≠—Ç–∞–ø 1: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã –±—É—Ñ–µ—Ä–∏–∑–∞—Ü–∏–∏ (1-2 –Ω–µ–¥–µ–ª–∏)

1. **–°–æ–∑–¥–∞—Ç—å —Ç–∞–±–ª–∏—Ü—ã –¥–ª—è –º–∞–ø–ø–∏–Ω–≥–∞ –∏ –ª–æ–≥–æ–≤**
   - `integration_sync_logs` ‚Äî –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
   - –û–±–Ω–æ–≤–∏—Ç—å `users`, `orders` —Å –ø–æ–ª—è–º–∏ –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏

2. **–î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –≤ —Ç–∞–±–ª–∏—Ü—ã**
   - `orders`: `iiko_order_id`, `iiko_sync_status`, `iiko_sync_attempts`, –∏ —Ç.–¥.
   - `orders`: `pb_purchase_id`, `pb_sync_status`, `pb_sync_attempts`, –∏ —Ç.–¥.
   - `users`: `pb_client_id`, `pb_sync_status`, `pb_sync_attempts`, –∏ —Ç.–¥.

3. **–ù–∞—Å—Ç—Ä–æ–∏—Ç—å –æ—á–µ—Ä–µ–¥–∏ BullMQ –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏**
   - –û—á–µ—Ä–µ–¥—å –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –∑–∞–∫–∞–∑–æ–≤ –≤ iiko
   - –û—á–µ—Ä–µ–¥—å –¥–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –∫–ª–∏–µ–Ω—Ç–æ–≤ –≤ PremiumBonus
   - –û—á–µ—Ä–µ–¥—å –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è/–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø–æ–∫—É–ø–æ–∫ –≤ PremiumBonus
   - –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫ –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫

4. **–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –±–∞–∑–æ–≤—ã–µ –∞–¥–∞–ø—Ç–µ—Ä—ã (–∑–∞–≥–ª—É—à–∫–∏)**
   - MenuAdapter –¥–ª—è iiko/local —Ä–µ–∂–∏–º–∞
   - LoyaltyAdapter –¥–ª—è PremiumBonus/local —Ä–µ–∂–∏–º–∞

5. **–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å worker'—ã –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—á–µ—Ä–µ–¥–µ–π**
   - `iikoOrderSyncWorker` ‚Äî –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—á–µ—Ä–µ–¥–∏ –∑–∞–∫–∞–∑–æ–≤ –¥–ª—è iiko
   - `pbClientSyncWorker` ‚Äî –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—á–µ—Ä–µ–¥–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –∫–ª–∏–µ–Ω—Ç–æ–≤
   - `pbPurchaseSyncWorker` ‚Äî –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—á–µ—Ä–µ–¥–∏ –ø–æ–∫—É–ø–æ–∫
   - –ö–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç –∑–∞–ø–∏—Å–∏ —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º `pending`/`error`

### –≠—Ç–∞–ø 2: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å iiko ‚Äî –º–µ–Ω—é (2-3 –Ω–µ–¥–µ–ª–∏)

1. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∫–ª–∏–µ–Ω—Ç iiko API
2. –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –Ω–æ–º–µ–Ω–∫–ª–∞—Ç—É—Ä—ã
3. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –º–µ–Ω—é (–∫–Ω–æ–ø–∫–∞ –≤ –∞–¥–º–∏–Ω–∫–µ)
4. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –º–µ–Ω—é (–≤–æ—Ä–∫–µ—Ä –∫–∞–∂–¥—ã–µ 30 –º–∏–Ω—É—Ç)
5. –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å—Ç–æ–ø-–ª–∏—Å—Ç–∞
6. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –≠—Ç–∞–ø 3: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å iiko ‚Äî –∑–∞–∫–∞–∑—ã —Å –±—É—Ñ–µ—Ä–∏–∑–∞—Ü–∏–µ–π (2-3 –Ω–µ–¥–µ–ª–∏)

1. –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞ (–≤—Å–µ–≥–¥–∞ –ø–µ—Ä–≤—ã–º)
2. –ü–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–∫–∞–∑–∞ –≤ –æ—á–µ—Ä–µ–¥—å –Ω–∞ –æ—Ç–ø—Ä–∞–≤–∫—É –≤ iiko
3. –û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–∫–∞–∑–æ–≤ –≤ iiko —á–µ—Ä–µ–∑ worker
4. Webhook –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–æ–≤
5. –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å—Ç–∞—Ç—É—Å–æ–≤
6. –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ä–µ—Ç—Ä–∞–∏ (–º–∞–∫—Å. 5 –ø–æ–ø—ã—Ç–æ–∫)
7. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ iiko (—Ä–∞–±–æ—Ç–∞ —Å –±—É—Ñ–µ—Ä–æ–º)

### –≠—Ç–∞–ø 4: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å PremiumBonus ‚Äî –∫–ª–∏–µ–Ω—Ç—ã —Å –±—É—Ñ–µ—Ä–∏–∑–∞—Ü–∏–µ–π (1-2 –Ω–µ–¥–µ–ª–∏)

1. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∫–ª–∏–µ–Ω—Ç PremiumBonus API
2. –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∫–ª–∏–µ–Ω—Ç–∞ (–≤—Å–µ–≥–¥–∞ –ø–µ—Ä–≤—ã–º)
3. –ü–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –∫–ª–∏–µ–Ω—Ç–∞ –≤ –æ—á–µ—Ä–µ–¥—å –Ω–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é –≤ PremiumBonus
4. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∫–ª–∏–µ–Ω—Ç–æ–≤ —á–µ—Ä–µ–∑ worker
5. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–∞ –∏ —É–º–Ω–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
6. –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ø—Ä–æ—Ñ–∏–ª–µ–π
7. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ PremiumBonus

### –≠—Ç–∞–ø 5: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å PremiumBonus ‚Äî –ª–æ—è–ª—å–Ω–æ—Å—Ç—å —Å –±—É—Ñ–µ—Ä–∏–∑–∞—Ü–∏–µ–π (2-3 –Ω–µ–¥–µ–ª–∏)

1. –ê–¥–∞–ø—Ç–µ—Ä –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏
2. –õ–æ–∫–∞–ª—å–Ω–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –±–æ–Ω—É—Å–∞—Ö –≤ –∑–∞–∫–∞–∑–µ
3. –ü–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–æ–∫—É–ø–∫–∏ –≤ –æ—á–µ—Ä–µ–¥—å –Ω–∞ –æ—Ç–ø—Ä–∞–≤–∫—É –≤ PremiumBonus
4. –†–∞—Å—á–µ—Ç –≤—ã–≥–æ–¥—ã –ø—Ä–∏ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–∏ –∑–∞–∫–∞–∑–∞ (–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ)
5. –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–∫—É–ø–æ–∫ –≤ PremiumBonus —á–µ—Ä–µ–∑ worker
6. –ù–∞—á–∏—Å–ª–µ–Ω–∏–µ/—Å–ø–∏—Å–∞–Ω–∏–µ –±–æ–Ω—É—Å–æ–≤
7. –ò—Å—Ç–æ—Ä–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
8. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ PremiumBonus

### –≠—Ç–∞–ø 6: –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (1-2 –Ω–µ–¥–µ–ª–∏)

1. –†–∞–∑–¥–µ–ª "–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏" –≤ –º–µ–Ω—é
2. –ù–∞—Å—Ç—Ä–æ–π–∫–∏ iiko –∏ PremiumBonus
3. –ö–Ω–æ–ø–∫–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –º–µ–Ω—é –∏–∑ iiko
4. –°—Ç–∞—Ç—É—Å—ã —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ (–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ pending/error/failed –∑–∞–ø–∏—Å–µ–π)
5. –õ–æ–≥–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
6. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –≠—Ç–∞–ø 7: –§–∏–Ω–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è (1 –Ω–µ–¥–µ–ª—è)

1. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –º–æ–¥—É–ª–µ–π
2. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –±—É—Ñ–µ—Ä–∏–∑–∞—Ü–∏–∏ –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –≤–Ω–µ—à–Ω–∏—Ö —Å–∏—Å—Ç–µ–º
3. –ù–∞–≥—Ä—É–∑–æ—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
4. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
5. –û–±—É—á–µ–Ω–∏–µ –ø–µ—Ä—Å–æ–Ω–∞–ª–∞

**–ò—Ç–æ–≥–æ: 10-16 –Ω–µ–¥–µ–ª—å (2.5-4 –º–µ—Å—è—Ü–∞)**

---

## 10. –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –º–æ–º–µ–Ω—Ç—ã –∏ —Ä–∏—Å–∫–∏

### 10.1 –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ä–∏—Å–∫–∏

1. **–ù–µ—Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä –¥–∞–Ω–Ω—ã—Ö**
   - –†–∏—Å–∫: —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –º–µ–Ω—é iiko –º–æ–∂–µ—Ç –∫–∞—Ä–¥–∏–Ω–∞–ª—å–Ω–æ –æ—Ç–ª–∏—á–∞—Ç—å—Å—è –æ—Ç FoodMiniApp
   - –†–µ—à–µ–Ω–∏–µ: –≥–∏–±–∫–∏–π –º–∞–ø–ø–∏–Ω–≥, fallback –Ω–∞ –ª–æ–∫–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

2. **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –≤–Ω–µ—à–Ω–∏—Ö API**
   - –†–∏—Å–∫: –º–µ–¥–ª–µ–Ω–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã –æ—Ç iiko/PremiumBonus —Ç–æ—Ä–º–æ–∑—è—Ç —Ä–∞–±–æ—Ç—É —Å–∏—Å—Ç–µ–º—ã
   - –†–µ—à–µ–Ω–∏–µ: –∞–≥—Ä–µ—Å—Å–∏–≤–Ω–æ–µ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ, –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –æ—á–µ—Ä–µ–¥–∏, —Ç–∞–π–º–∞—É—Ç—ã

3. **–î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å API (—Ä–µ—à–µ–Ω–æ —á–µ—Ä–µ–∑ –±—É—Ñ–µ—Ä–∏–∑–∞—Ü–∏—é)**
   - –†–∏—Å–∫: –ø–∞–¥–µ–Ω–∏–µ iiko/PremiumBonus –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ –æ—Å—Ç–∞–Ω–æ–≤–∫–µ —Ä–∞–±–æ—Ç—ã
   - –†–µ—à–µ–Ω–∏–µ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –ª–æ–∫–∞–ª—å–Ω–æ–π –ë–î –∫–∞–∫ –±—É—Ñ–µ—Ä–∞:
     - **–î–ª—è –º–µ–Ω—é (iiko)**: –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–µ—à –∏–∑ –ª–æ–∫–∞–ª—å–Ω–æ–π –ë–î (–ø–æ—Å–ª–µ–¥–Ω—è—è —É—Å–ø–µ—à–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è)
     - **–î–ª—è –∑–∞–∫–∞–∑–æ–≤ (iiko)**: –∑–∞–∫–∞–∑—ã –≤—Å–µ–≥–¥–∞ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ –ü–ï–†–í–´–ú–ò, –∑–∞—Ç–µ–º —Å—Ç–∞–≤—è—Ç—Å—è –≤ –æ—á–µ—Ä–µ–¥—å –Ω–∞ –æ—Ç–ø—Ä–∞–≤–∫—É –≤ iiko. –ü—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ iiko –∑–∞–∫–∞–∑—ã –Ω–∞–∫–∞–ø–ª–∏–≤–∞—é—Ç—Å—è –≤ –æ—á–µ—Ä–µ–¥–∏ (—Å—Ç–∞—Ç—É—Å `pending`), –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –ø—Ä–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å–≤—è–∑–∏
     - **–î–ª—è –∫–ª–∏–µ–Ω—Ç–æ–≤ (PremiumBonus)**: —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –≤—Å–µ–≥–¥–∞ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ª–æ–∫–∞–ª—å–Ω–æ –ü–ï–†–í–û–ô, –∑–∞—Ç–µ–º –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ –≤ PB. –ü—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ PB –∫–ª–∏–µ–Ω—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç —Å —Å–∏—Å—Ç–µ–º–æ–π, —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–æ–π–¥–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
     - **–î–ª—è –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏ (PremiumBonus)**: –±–∞–ª–∞–Ω—Å –∫–µ—à–∏—Ä—É–µ—Ç—Å—è –≤ Redis, –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ API –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–µ –∏–∑–≤–µ—Å—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ. –û–ø–µ—Ä–∞—Ü–∏–∏ —Å –±–æ–Ω—É—Å–∞–º–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ –∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É—é—Ç—Å—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ
     - **–ü–æ–≤—Ç–æ—Ä–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏**: worker –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –≤—Å–µ –∑–∞–ø–∏—Å–∏ —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º `pending`/`error`, –º–∞–∫—Å–∏–º—É–º 5 –ø–æ–ø—ã—Ç–æ–∫
     - –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É –æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ –Ω–µ—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π
     - **–†–µ–∑—É–ª—å—Ç–∞—Ç**: —Å–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –í–°–ï–ì–î–ê, –¥–∞–∂–µ –±–µ–∑ —Å–≤—è–∑–∏ —Å –≤–Ω–µ—à–Ω–∏–º–∏ —Å–∏—Å—Ç–µ–º–∞–º–∏

4. **–î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–∫–∞–∑–æ–≤**
   - –†–∏—Å–∫: –ø—Ä–∏ –æ—à–∏–±–∫–µ —Å–µ—Ç–∏ –∑–∞–∫–∞–∑ –º–æ–∂–µ—Ç –±—ã—Ç—å –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –≤ iiko –¥–≤–∞–∂–¥—ã
   - –†–µ—à–µ–Ω–∏–µ: –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å –∑–∞–ø—Ä–æ—Å–æ–≤, —Ö—Ä–∞–Ω–µ–Ω–∏–µ `external_order_id`, –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤

5. **–†–∞—Å—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å—Ç–∞—Ç—É—Å–æ–≤**
   - –†–∏—Å–∫: —Å—Ç–∞—Ç—É—Å –≤ FoodMiniApp –∏ iiko –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç
   - –†–µ—à–µ–Ω–∏–µ: webhook –æ—Ç iiko, –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∞—è —Å–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–æ–≤

### 10.2 –ë–∏–∑–Ω–µ—Å-—Ä–∏—Å–∫–∏

1. **–ü–µ—Ä–µ—Ö–æ–¥ –æ—Ç –ª–æ–∫–∞–ª—å–Ω–æ–π –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏ –∫ PremiumBonus**
   - –†–∏—Å–∫: –ø–æ—Ç–µ—Ä—è –∏—Å—Ç–æ—Ä–∏–∏ –±–æ–Ω—É—Å–æ–≤ –∫–ª–∏–µ–Ω—Ç–æ–≤
   - –†–µ—à–µ–Ω–∏–µ: –º–∏–≥—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö, –µ–¥–∏–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–µ –Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ –±–∞–ª–∞–Ω—Å–∞ –≤ PremiumBonus

2. **–ò–∑–º–µ–Ω–µ–Ω–∏–µ —É—Å–ª–æ–≤–∏–π –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏**
   - –†–∏—Å–∫: –∫–ª–∏–µ–Ω—Ç—ã –Ω–µ–¥–æ–≤–æ–ª—å–Ω—ã –Ω–æ–≤—ã–º–∏ —É—Å–ª–æ–≤–∏—è–º–∏ PremiumBonus
   - –†–µ—à–µ–Ω–∏–µ: –ø–ª–∞–≤–Ω—ã–π –ø–µ—Ä–µ—Ö–æ–¥, –∏–Ω—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–æ–≤, –∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏—è

3. **–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç —Å—Ç–æ—Ä–æ–Ω–Ω–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤**
   - –†–∏—Å–∫: –ø—Ä–∏ –ø—Ä–µ–∫—Ä–∞—â–µ–Ω–∏–∏ —Ä–∞–±–æ—Ç—ã —Å iiko/PremiumBonus –ø—Ä–∏–¥–µ—Ç—Å—è –ø–µ—Ä–µ–¥–µ–ª—ã–≤–∞—Ç—å —Å–∏—Å—Ç–µ–º—É
   - –†–µ—à–µ–Ω–∏–µ: –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –∞–≤—Ç–æ–Ω–æ–º–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞, –º–∏–Ω–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–∏–≤—è–∑–∫–∏ –∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º API

### 10.3 –û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ä–∏—Å–∫–∏

1. **–°–ª–æ–∂–Ω–æ—Å—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏**
   - –†–∏—Å–∫: –ø–µ—Ä—Å–æ–Ω–∞–ª –Ω–µ —Å–º–æ–∂–µ—Ç –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
   - –†–µ—à–µ–Ω–∏–µ: –ø–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è, –æ–±—É—á–µ–Ω–∏–µ, —Ç–µ—Ö–ø–æ–¥–¥–µ—Ä–∂–∫–∞

2. **–£–≤–µ–ª–∏—á–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏**
   - –†–∏—Å–∫: –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –∑–∞–π–º–µ—Ç –±–æ–ª—å—à–µ –≤—Ä–µ–º–µ–Ω–∏, —á–µ–º –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–ª–æ—Å—å
   - –†–µ—à–µ–Ω–∏–µ: –ø–æ—ç—Ç–∞–ø–Ω–æ–µ –≤–Ω–µ–¥—Ä–µ–Ω–∏–µ, MVP –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —ç—Ç–∞–ø–∞

---

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å iiko –∏ PremiumBonus ‚Äî —ç—Ç–æ **–º–∞—Å—à—Ç–∞–±–Ω—ã–π –ø—Ä–æ–µ–∫—Ç**, –∫–æ—Ç–æ—Ä—ã–π —Ç—Ä–µ–±—É–µ—Ç:

- –°–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤–æ–π –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
- –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –º–æ–¥—É–ª–µ–π
- –†–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –∞–¥–∞–ø—Ç–µ—Ä–æ–≤ –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –¥–≤—É—Ö —Ä–µ–∂–∏–º–æ–≤ —Ä–∞–±–æ—Ç—ã
- –¢—â–∞—Ç–µ–ª—å–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

**–ö–ª—é—á–µ–≤—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏:**

1. **–î—É–∞–ª—å–Ω—ã–π —Ä–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã** ‚Äî —Å–∏—Å—Ç–µ–º–∞ –º–æ–∂–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –∫–∞–∫ –ø–æ–ª–Ω–æ—Å—Ç—å—é –∞–≤—Ç–æ–Ω–æ–º–Ω–æ, —Ç–∞–∫ –∏ —Å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è–º–∏
2. **–†–µ–∂–∏–º "—Ç–æ–ª—å–∫–æ —á—Ç–µ–Ω–∏—è"** ‚Äî –ø—Ä–∏ –≤–∫–ª—é—á–µ–Ω–∏–∏ iiko –ª–æ–∫–∞–ª—å–Ω—ã–µ –º–æ–¥—É–ª–∏ (–º–µ–Ω—é, —Å—Ç–æ–ø-–ª–∏—Å—Ç, –∑–æ–Ω—ã –¥–æ—Å—Ç–∞–≤–∫–∏) –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è, –¥–∞–Ω–Ω—ã–µ –±–µ—Ä—É—Ç—Å—è –∏–∑ iiko
3. **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ª–æ–∫–∞–ª—å–Ω—ã—Ö –º–æ–¥—É–ª–µ–π** ‚Äî –æ–Ω–∏ –ù–ï —É–¥–∞–ª—è—é—Ç—Å—è, –∞ –ø–µ—Ä–µ–≤–æ–¥—è—Ç—Å—è –≤ –Ω–µ–∞–∫—Ç–∏–≤–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ, —á—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –±—ã—Å—Ç—Ä–æ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç—å—Å—è –º–µ–∂–¥—É —Ä–µ–∂–∏–º–∞–º–∏
4. **–£–º–Ω–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∫–ª–∏–µ–Ω—Ç–æ–≤** ‚Äî —Å–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ –∫–ª–∏–µ–Ω—Ç–∞ –≤ PremiumBonus –ø–µ—Ä–µ–¥ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–µ–π –∏ –Ω–µ –¥—É–±–ª–∏—Ä—É–µ—Ç –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–µ –±–æ–Ω—É—Å—ã
5. **–õ–æ–∫–∞–ª—å–Ω–∞—è –ë–î –∫–∞–∫ –±—É—Ñ–µ—Ä —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ (–ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û!)** ‚Äî –í–°–ï –¥–∞–Ω–Ω—ã–µ (–∑–∞–∫–∞–∑—ã, –∫–ª–∏–µ–Ω—Ç—ã, –ø–æ–∫—É–ø–∫–∏) –í–°–ï–ì–î–ê —Å–Ω–∞—á–∞–ª–∞ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –ª–æ–∫–∞–ª—å–Ω–æ–π –ë–î, –∑–∞—Ç–µ–º –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É—é—Ç—Å—è —Å –≤–Ω–µ—à–Ω–∏–º–∏ —Å–∏—Å—Ç–µ–º–∞–º–∏ —á–µ—Ä–µ–∑ –æ—á–µ—Ä–µ–¥–∏. –ü—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –≤–Ω–µ—à–Ω–∏—Ö —Å–∏—Å—Ç–µ–º –¥–∞–Ω–Ω—ã–µ –Ω–∞–∫–∞–ø–ª–∏–≤–∞—é—Ç—Å—è –≤ –æ—á–µ—Ä–µ–¥–∏ –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –ø—Ä–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å–≤—è–∑–∏
6. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏** ‚Äî worker'—ã –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç –∑–∞–ø–∏—Å–∏ —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º `pending`/`error`, –æ–±–µ—Å–ø–µ—á–∏–≤–∞—è –Ω—É–ª–µ–≤—É—é –ø–æ—Ç–µ—Ä—é –¥–∞–Ω–Ω—ã—Ö
7. **–ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ fallback** ‚Äî –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –≤–Ω–µ—à–Ω–∏—Ö API –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –∑–∞–∫–µ—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

**–ì–ª–∞–≤–Ω–æ–µ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–æ:** —Å–∏—Å—Ç–µ–º–∞ –æ—Å—Ç–∞–µ—Ç—Å—è –≥–∏–±–∫–æ–π –∏ –º–æ–∂–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –≤ –ª—é–±–æ–º –∏–∑ —Ç—Ä–µ—Ö —Ä–µ–∂–∏–º–æ–≤:

- –ü–æ–ª–Ω–æ—Å—Ç—å—é –∞–≤—Ç–æ–Ω–æ–º–Ω–æ (–±–µ–∑ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π)
- –° –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π —Ç–æ–ª—å–∫–æ iiko
- –° –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π —Ç–æ–ª—å–∫–æ PremiumBonus
- –° –æ–±–µ–∏–º–∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è–º–∏ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ

**–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω–æ:** —Å–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –í–°–ï–ì–î–ê, –¥–∞–∂–µ –ø—Ä–∏ –ø–æ–ª–Ω–æ–π –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –≤–Ω–µ—à–Ω–∏—Ö —Å–∏—Å—Ç–µ–º. –ö–ª–∏–µ–Ω—Ç—ã –º–æ–≥—É—Ç –¥–µ–ª–∞—Ç—å –∑–∞–∫–∞–∑—ã, —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–æ–Ω—É—Å—ã ‚Äî –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ—Å–ª–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è —Å–≤—è–∑–∏.

**–ì–ª–∞–≤–Ω—ã–π –≤—ã–∑–æ–≤:** –æ–±–µ—Å–ø–µ—á–∏—Ç—å –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å –∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å –≤–Ω–µ—à–Ω–∏–º–∏ API, –º–∏–Ω–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ä–∏—Å–∫–∏ —Ä–∞—Å—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö, –ø—Ä–∞–≤–∏–ª—å–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏—è "—Ç–æ–ª—å–∫–æ —á—Ç–µ–Ω–∏—è" –≤ UI, —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –Ω–∞–¥–µ–∂–Ω—É—é —Å–∏—Å—Ç–µ–º—É –æ—á–µ—Ä–µ–¥–µ–π –∏ –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫.

–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –Ω–∞—á–∞—Ç—å —Å **–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –º–µ–Ω—é –∏–∑ iiko** (—ç—Ç–∞–ø 2), —Ç–∞–∫ –∫–∞–∫ —ç—Ç–æ –Ω–∞–∏–º–µ–Ω–µ–µ –∫—Ä–∏—Ç–∏—á–Ω–∞—è —á–∞—Å—Ç—å, –Ω–æ –¥–∞—Å—Ç –ø–æ–Ω–∏–º–∞–Ω–∏–µ –≤—Å–µ—Ö —Å–ª–æ–∂–Ω–æ—Å—Ç–µ–π —Ä–∞–±–æ—Ç—ã —Å –≤–Ω–µ—à–Ω–∏–º–∏ API –∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ä–µ–∂–∏–º–æ–≤.
