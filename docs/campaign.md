
ĞÑ‚Ğ»Ğ¸Ñ‡Ğ½Ğ¾! Ğ¢ĞµĞ¿ĞµÑ€ÑŒ Ğ²ÑĞµ Ğ´ĞµÑ‚Ğ°Ğ»Ğ¸ Ğ½Ğ° Ğ¼ĞµÑÑ‚Ğµ. Ğ”Ğ°Ğ²Ğ°Ğ¹ Ğ·Ğ°Ñ„Ğ¸ĞºÑĞ¸Ñ€ÑƒÑ Ñ„Ğ¸Ğ½Ğ°Ğ»ÑŒĞ½ÑƒÑ Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ñƒ Ñ ÑƒÑ‡ĞµÑ‚Ğ¾Ğ¼ Ğ²ÑĞµÑ… ÑƒÑ‚Ğ¾Ñ‡Ğ½ĞµĞ½Ğ¸Ğ¹.

---

## Ğ¤Ğ¸Ğ½Ğ°Ğ»ÑŒĞ½Ğ°Ñ Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ° Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑĞ¾Ñ‡Ğ½Ñ‹Ñ… ĞºĞ°Ğ¼Ğ¿Ğ°Ğ½Ğ¸Ğ¹

---

## 1. Ğ¡Ñ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ° Ğ±Ğ°Ğ·Ñ‹ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…

### **Ğ¢Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ° `subscription_campaigns`**

```sql
CREATE TABLE subscription_campaigns (
  id INT PRIMARY KEY AUTO_INCREMENT,
  tag VARCHAR(50) UNIQUE NOT NULL,
  title VARCHAR(200) NOT NULL,
  
  -- ĞšĞ°Ğ½Ğ°Ğ»
  channel_id VARCHAR(100) NOT NULL,        -- @channel Ğ¸Ğ»Ğ¸ -1001234567890
  channel_url VARCHAR(255) NOT NULL,       -- https://t.me/channel
  
  -- Ğ¡Ğ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ñ
  welcome_message TEXT NOT NULL,
  success_message TEXT NOT NULL,
  error_message TEXT NOT NULL,
  
  -- ĞœĞµĞ´Ğ¸Ğ° Ğ´Ğ»Ñ success_message
  media_type ENUM('photo', 'video') NULL,
  media_url VARCHAR(500) NULL,
  
  -- ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ° Ğ¿Ñ€Ğ¸Ğ·Ğ¾Ğ²
  is_reward_unique BOOLEAN DEFAULT FALSE,  -- TRUE = Ğ¿Ñ€Ğ¸Ğ· Ğ¾Ğ´Ğ¸Ğ½ Ñ€Ğ°Ğ·, FALSE = Ğ¼Ğ½Ğ¾Ğ³Ğ¾Ñ€Ğ°Ğ·Ğ¾Ğ²Ñ‹Ğ¹
  
  -- ĞŸĞµÑ€Ğ¸Ğ¾Ğ´ Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ñ
  is_active BOOLEAN DEFAULT TRUE,
  is_perpetual BOOLEAN DEFAULT FALSE,
  start_date TIMESTAMP NULL,
  end_date TIMESTAMP NULL,
  
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  
  INDEX idx_tag (tag),
  INDEX idx_active_dates (is_active, start_date, end_date)
);
```

### **Ğ¢Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ° `subscription_attempts`**

```sql
CREATE TABLE subscription_attempts (
  id INT PRIMARY KEY AUTO_INCREMENT,
  campaign_id INT NOT NULL,
  user_id INT NOT NULL,
  telegram_id BIGINT NOT NULL,
  
  -- Ğ’Ñ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ğµ Ğ¼ĞµÑ‚ĞºĞ¸
  first_click_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  last_check_at TIMESTAMP NULL,
  first_subscribed_at TIMESTAMP NULL,
  last_reward_claimed_at TIMESTAMP NULL,    -- Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ½ĞµĞµ Ğ¿Ğ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ğµ Ğ¿Ñ€Ğ¸Ğ·Ğ°
  
  -- Ğ¡Ñ‡ĞµÑ‚Ñ‡Ğ¸ĞºĞ¸
  attempts_count INT DEFAULT 1,             -- Ğ¿Ğ¾Ğ¿Ñ‹Ñ‚Ğ¾Ğº Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ¸ Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑĞºĞ¸
  rewards_claimed_count INT DEFAULT 0,      -- ÑĞºĞ¾Ğ»ÑŒĞºĞ¾ Ñ€Ğ°Ğ· Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ°Ğ» Ğ¿Ñ€Ğ¸Ğ·
  
  -- Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ
  is_currently_subscribed BOOLEAN DEFAULT FALSE,
  
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  
  UNIQUE KEY unique_campaign_user (campaign_id, user_id),
  FOREIGN KEY (campaign_id) REFERENCES subscription_campaigns(id) ON DELETE CASCADE,
  FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,
  
  INDEX idx_telegram_id (telegram_id),
  INDEX idx_campaign_subscribed (campaign_id, is_currently_subscribed),
  INDEX idx_first_subscribed (campaign_id, first_subscribed_at)
);
```

### **ĞĞ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñ‹ `users`**

```sql
ALTER TABLE users 
  ADD COLUMN registration_type ENUM('bot_only', 'miniapp') DEFAULT 'bot_only',
  ADD COLUMN bot_registered_at TIMESTAMP NULL,
  ADD INDEX idx_registration_type (registration_type);

-- ĞŸÑ€Ğ¸ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğ¸ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ Ñ‡ĞµÑ€ĞµĞ· /start:
-- registration_type = 'bot_only'
-- bot_registered_at = NOW()

-- ĞŸÑ€Ğ¸ Ğ°Ğ²Ñ‚Ğ¾Ñ€Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸ Ğ² Mini App (ĞµÑĞ»Ğ¸ Ğ±Ñ‹Ğ» bot_only):
-- registration_type = 'miniapp'
-- Ğ¾ÑÑ‚Ğ°Ğ»ÑŒĞ½Ñ‹Ğµ Ğ¿Ğ¾Ğ»Ñ (phone, etc.) Ğ·Ğ°Ğ¿Ğ¾Ğ»Ğ½ÑÑÑ‚ÑÑ
```

---

## 2. Ğ›Ğ¾Ğ³Ğ¸ĞºĞ° Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‹ Ñ Ğ¿Ñ€Ğ¸Ğ·Ğ°Ğ¼Ğ¸

### **Ğ¡Ñ†ĞµĞ½Ğ°Ñ€Ğ¸Ğ¹ A: Ğ£Ğ½Ğ¸ĞºĞ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ¿Ñ€Ğ¸Ğ· (`is_reward_unique = TRUE`)**

ĞŸÑ€Ğ¸Ğ· Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ **Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ¾Ğ´Ğ¸Ğ½ Ñ€Ğ°Ğ· Ğ·Ğ° Ğ²ÑÑ Ğ¸ÑÑ‚Ğ¾Ñ€Ğ¸Ñ**.

**ĞŸÑ€Ğ¸Ğ¼ĞµÑ€:** ĞŸÑ€Ğ¾Ğ¼Ğ¾ĞºĞ¾Ğ´ `KAZAN2026` Ğ½Ğ° 500â‚½

```javascript
// ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ¿Ñ€Ğ¸ Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑĞºĞµ
if (campaign.is_reward_unique && attempt.rewards_claimed_count > 0) {
  // ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ ÑƒĞ¶Ğµ Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ°Ğ» ÑÑ‚Ğ¾Ñ‚ Ğ¿Ñ€Ğ¸Ğ· Ñ€Ğ°Ğ½ÑŒÑˆĞµ
  await bot.sendMessage(userId, "Ğ’Ñ‹ ÑƒĞ¶Ğµ Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ°Ğ»Ğ¸ ÑÑ‚Ğ¾Ñ‚ Ğ¿Ñ€Ğ¸Ğ· Ñ€Ğ°Ğ½ĞµĞµ.");
  return;
}

// Ğ’Ñ‹Ğ´Ğ°Ñ‡Ğ° Ğ¿Ñ€Ğ¸Ğ·Ğ°
await sendSuccessMessage(userId, campaign);
await db.query(
  "UPDATE subscription_attempts SET rewards_claimed_count = rewards_claimed_count + 1, last_reward_claimed_at = NOW() WHERE id = ?",
  [attempt.id]
);
```

### **Ğ¡Ñ†ĞµĞ½Ğ°Ñ€Ğ¸Ğ¹ B: ĞœĞ½Ğ¾Ğ³Ğ¾Ñ€Ğ°Ğ·Ğ¾Ğ²Ñ‹Ğ¹ Ğ¿Ñ€Ğ¸Ğ· (`is_reward_unique = FALSE`)**

ĞŸÑ€Ğ¸Ğ· Ğ²Ñ‹Ğ´Ğ°ĞµÑ‚ÑÑ **ĞºĞ°Ğ¶Ğ´Ñ‹Ğ¹ Ñ€Ğ°Ğ·** Ğ¿Ñ€Ğ¸ Ğ¿Ğ¾Ğ´Ñ‚Ğ²ĞµÑ€Ğ¶Ğ´ĞµĞ½Ğ¸Ğ¸ Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑĞºĞ¸.

**ĞŸÑ€Ğ¸Ğ¼ĞµÑ€:** Ğ˜Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ Ğ¾ ÑĞºĞ¸Ğ´ĞºĞ°Ñ… Ğ² ĞºĞ°Ğ½Ğ°Ğ»Ğµ (Ğ½Ğµ Ğ¼ĞµĞ½ÑĞµÑ‚ÑÑ)

```javascript
// Ğ’ÑĞµĞ³Ğ´Ğ° Ğ¿Ğ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµĞ¼ Ğ¿Ñ€Ğ¸Ğ·, ĞµÑĞ»Ğ¸ Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑĞ°Ğ½
if (isSubscribed) {
  await sendSuccessMessage(userId, campaign);
  await db.query(
    "UPDATE subscription_attempts SET rewards_claimed_count = rewards_claimed_count + 1, last_reward_claimed_at = NOW() WHERE id = ?",
    [attempt.id]
  );
}
```

---

## 3. Flow Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‹ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ (Ğ´ĞµÑ‚Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹)

### **Ğ¨Ğ°Ğ³ 1: ĞŸĞµÑ€ĞµÑ…Ğ¾Ğ´ Ğ¿Ğ¾ ÑÑÑ‹Ğ»ĞºĞµ**

ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ ĞºĞ»Ğ¸ĞºĞ°ĞµÑ‚: `https://t.me/yourbot?start=kazan_promo`

```javascript
bot.command('start', async (ctx) => {
  const args = ctx.message.text.split(' ')[1]; // "kazan_promo"
  
  if (!args) {
    // ĞĞ±Ñ‹Ñ‡Ğ½Ñ‹Ğ¹ /start Ğ±ĞµĞ· Ğ¼ĞµÑ‚ĞºĞ¸
    return handleRegularStart(ctx);
  }
  
  // Ğ˜Ñ‰ĞµĞ¼ ĞºĞ°Ğ¼Ğ¿Ğ°Ğ½Ğ¸Ñ Ğ¿Ğ¾ Ğ¼ĞµÑ‚ĞºĞµ
  const campaign = await getCampaignByTag(args);
  
  if (!campaign) {
    return ctx.reply("ĞšĞ°Ğ¼Ğ¿Ğ°Ğ½Ğ¸Ñ Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ğ°.");
  }
  
  if (!campaign.is_active) {
    return ctx.reply("ĞšĞ°Ğ¼Ğ¿Ğ°Ğ½Ğ¸Ñ Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞµĞ½Ğ°.");
  }
  
  // ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ´Ğ°Ñ‚
  if (!campaign.is_perpetual) {
    const now = new Date();
    if (now < campaign.start_date || now > campaign.end_date) {
      return ctx.reply("ĞšĞ°Ğ¼Ğ¿Ğ°Ğ½Ğ¸Ñ Ğ½ĞµĞ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ° Ğ² Ğ´Ğ°Ğ½Ğ½Ñ‹Ğ¹ Ğ¼Ğ¾Ğ¼ĞµĞ½Ñ‚.");
    }
  }
  
  // Ğ¡Ğ¾Ğ·Ğ´Ğ°ĞµĞ¼/Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ÑĞµĞ¼ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ
  const user = await upsertUser(ctx.from);
  
  // Ğ¡Ğ¾Ğ·Ğ´Ğ°ĞµĞ¼/Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ÑĞµĞ¼ Ğ¿Ğ¾Ğ¿Ñ‹Ñ‚ĞºÑƒ
  const attempt = await upsertAttempt(campaign.id, user.id, ctx.from.id);
  
  // ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼, Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑĞ°Ğ½ Ğ»Ğ¸ ÑƒĞ¶Ğµ
  const isSubscribed = await checkSubscription(campaign.channel_id, ctx.from.id);
  
  if (isSubscribed) {
    // ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ ÑƒĞ¶Ğµ Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑĞ°Ğ½
    return handleAlreadySubscribed(ctx, campaign, attempt);
  }
  
  // ĞŸĞ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµĞ¼ Ğ¿Ñ€Ğ¸Ğ²ĞµÑ‚ÑÑ‚Ğ²ĞµĞ½Ğ½Ğ¾Ğµ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ
  await showWelcomeMessage(ctx, campaign);
});
```

### **Ğ¨Ğ°Ğ³ 2: ĞŸÑ€Ğ¸Ğ²ĞµÑ‚ÑÑ‚Ğ²ĞµĞ½Ğ½Ğ¾Ğµ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ**

```javascript
async function showWelcomeMessage(ctx, campaign) {
  const keyboard = {
    inline_keyboard: [
      [{ text: "ğŸ“¢ ĞŸĞ¾Ğ´Ğ¿Ğ¸ÑĞ°Ñ‚ÑŒÑÑ Ğ½Ğ° ĞºĞ°Ğ½Ğ°Ğ»", url: campaign.channel_url }],
      [{ text: "âœ… Ğ¯ Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑĞ°Ğ»ÑÑ", callback_data: `check_sub:${campaign.id}` }]
    ]
  };
  
  await ctx.reply(campaign.welcome_message, {
    reply_markup: keyboard,
    parse_mode: 'HTML'
  });
}
```

### **Ğ¨Ğ°Ğ³ 3: ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑĞºĞ¸**

```javascript
bot.action(/check_sub:(\d+)/, async (ctx) => {
  const campaignId = parseInt(ctx.match[1]);
  const userId = ctx.from.id;
  
  // Rate limiting
  const attempt = await getAttempt(campaignId, userId);
  const timeSinceLastCheck = Date.now() - new Date(attempt.last_check_at).getTime();
  
  if (timeSinceLastCheck < 10000) { // 10 ÑĞµĞºÑƒĞ½Ğ´
    return ctx.answerCbQuery("â±ï¸ ĞŸĞ¾Ğ´Ğ¾Ğ¶Ğ´Ğ¸Ñ‚Ğµ 10 ÑĞµĞºÑƒĞ½Ğ´ Ğ¿ĞµÑ€ĞµĞ´ Ğ¿Ğ¾Ğ²Ñ‚Ğ¾Ñ€Ğ½Ğ¾Ğ¹ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ¾Ğ¹", { show_alert: true });
  }
  
  // ĞĞ±Ğ½Ğ¾Ğ²Ğ»ÑĞµĞ¼ ÑÑ‡ĞµÑ‚Ñ‡Ğ¸ĞºĞ¸
  await db.query(
    "UPDATE subscription_attempts SET last_check_at = NOW(), attempts_count = attempts_count + 1 WHERE id = ?",
    [attempt.id]
  );
  
  const campaign = await getCampaign(campaignId);
  
  // ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑĞºÑƒ Ñ‡ĞµÑ€ĞµĞ· Telegram API
  const isSubscribed = await checkSubscription(campaign.channel_id, userId);
  
  if (!isSubscribed) {
    // ĞĞµ Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑĞ°Ğ½
    await ctx.answerCbQuery("âŒ Ğ’Ñ‹ ĞµÑ‰Ñ‘ Ğ½Ğµ Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑĞ°Ğ½Ñ‹ Ğ½Ğ° ĞºĞ°Ğ½Ğ°Ğ»", { show_alert: true });
    await ctx.editMessageText(campaign.error_message, {
      reply_markup: ctx.callbackQuery.message.reply_markup
    });
    return;
  }
  
  // ĞŸĞ¾Ğ´Ğ¿Ğ¸ÑĞ°Ğ½! ĞĞ±Ğ½Ğ¾Ğ²Ğ»ÑĞµĞ¼ ÑÑ‚Ğ°Ñ‚ÑƒÑ
  await db.query(
    "UPDATE subscription_attempts SET is_currently_subscribed = TRUE, first_subscribed_at = COALESCE(first_subscribed_at, NOW()) WHERE id = ?",
    [attempt.id]
  );
  
  // ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ Ğ»Ğ¾Ğ³Ğ¸ĞºÑƒ Ğ²Ñ‹Ğ´Ğ°Ñ‡Ğ¸ Ğ¿Ñ€Ğ¸Ğ·Ğ°
  await handleRewardLogic(ctx, campaign, attempt);
});
```

### **Ğ¨Ğ°Ğ³ 4: Ğ›Ğ¾Ğ³Ğ¸ĞºĞ° Ğ²Ñ‹Ğ´Ğ°Ñ‡Ğ¸ Ğ¿Ñ€Ğ¸Ğ·Ğ°**

```javascript
async function handleRewardLogic(ctx, campaign, attempt) {
  // ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° ÑƒĞ½Ğ¸ĞºĞ°Ğ»ÑŒĞ½Ğ¾ÑÑ‚Ğ¸ Ğ¿Ñ€Ğ¸Ğ·Ğ°
  if (campaign.is_reward_unique && attempt.rewards_claimed_count > 0) {
    await ctx.answerCbQuery("âœ… Ğ’Ñ‹ ÑƒĞ¶Ğµ Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ°Ğ»Ğ¸ ÑÑ‚Ğ¾Ñ‚ Ğ¿Ñ€Ğ¸Ğ· Ñ€Ğ°Ğ½ĞµĞµ!");
    await ctx.editMessageText(
      "Ğ’Ñ‹ ÑƒĞ¶Ğµ ÑƒÑ‡Ğ°ÑÑ‚Ğ²Ğ¾Ğ²Ğ°Ğ»Ğ¸ Ğ² ÑÑ‚Ğ¾Ğ¹ ĞºĞ°Ğ¼Ğ¿Ğ°Ğ½Ğ¸Ğ¸. Ğ¡Ğ¿Ğ°ÑĞ¸Ğ±Ğ¾ Ğ·Ğ° Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑĞºÑƒ! ğŸ‰"
    );
    return;
  }
  
  // Ğ’Ñ‹Ğ´Ğ°ĞµĞ¼ Ğ¿Ñ€Ğ¸Ğ·
  await sendSuccessMessage(ctx, campaign);
  
  // ĞĞ±Ğ½Ğ¾Ğ²Ğ»ÑĞµĞ¼ ÑÑ‡ĞµÑ‚Ñ‡Ğ¸Ğº Ğ¿Ñ€Ğ¸Ğ·Ğ¾Ğ²
  await db.query(
    "UPDATE subscription_attempts SET rewards_claimed_count = rewards_claimed_count + 1, last_reward_claimed_at = NOW() WHERE id = ?",
    [attempt.id]
  );
  
  await ctx.answerCbQuery("ğŸ‰ ĞŸĞ¾Ğ·Ğ´Ñ€Ğ°Ğ²Ğ»ÑĞµĞ¼! ĞŸÑ€Ğ¸Ğ· Ğ¿Ğ¾Ğ»ÑƒÑ‡ĞµĞ½!");
}

async function sendSuccessMessage(ctx, campaign) {
  if (campaign.media_type === 'photo') {
    await ctx.replyWithPhoto(campaign.media_url, {
      caption: campaign.success_message,
      parse_mode: 'HTML'
    });
  } else if (campaign.media_type === 'video') {
    await ctx.replyWithVideo(campaign.media_url, {
      caption: campaign.success_message,
      parse_mode: 'HTML'
    });
  } else {
    await ctx.reply(campaign.success_message, { parse_mode: 'HTML' });
  }
}
```

---

## 4. ĞœĞ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ñ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ bot_only â†’ miniapp

### **Ğ¡Ñ†ĞµĞ½Ğ°Ñ€Ğ¸Ğ¹:**

1. ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ Ğ½Ğ°Ğ¶Ğ¸Ğ¼Ğ°ĞµÑ‚ `/start` Ğ² Ğ±Ğ¾Ñ‚Ğµ â†’ ÑĞ¾Ğ·Ğ´Ğ°ĞµÑ‚ÑÑ Ğ·Ğ°Ğ¿Ğ¸ÑÑŒ Ğ² `users`:
   - `telegram_id = 123456789`
   - `registration_type = 'bot_only'`
   - `bot_registered_at = NOW()`
   - `phone = NULL`, Ğ´Ñ€ÑƒĞ³Ğ¸Ğµ Ğ¿Ğ¾Ğ»Ñ Ğ¿ÑƒÑÑ‚Ñ‹

2. ĞŸĞ¾Ğ·Ğ¶Ğµ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ Ğ¾Ñ‚ĞºÑ€Ñ‹Ğ²Ğ°ĞµÑ‚ Mini App Ğ¸ Ğ°Ğ²Ñ‚Ğ¾Ñ€Ğ¸Ğ·ÑƒĞµÑ‚ÑÑ (Ğ´ĞµĞ»Ğ¸Ñ‚ÑÑ Ñ‚ĞµĞ»ĞµÑ„Ğ¾Ğ½Ğ¾Ğ¼)

3. Backend Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ÑĞµÑ‚: **ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒĞµÑ‚ Ğ»Ğ¸ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ Ñ Ñ‚Ğ°ĞºĞ¸Ğ¼ `telegram_id`?**

```javascript
// Ğ’ ĞºĞ¾Ğ½Ñ‚Ñ€Ğ¾Ğ»Ğ»ĞµÑ€Ğµ Ğ°Ğ²Ñ‚Ğ¾Ñ€Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸ Mini App
export const authMiniApp = async (req, res, next) => {
  try {
    const { initData } = req.body;
    const userData = validateInitData(initData); // Ğ¿Ğ°Ñ€ÑĞ¸Ğ½Ğ³ telegram_id, etc.
    
    // Ğ˜Ñ‰ĞµĞ¼ ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒÑÑ‰ĞµĞ³Ğ¾ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ
    const [existingUsers] = await db.query(
      "SELECT * FROM users WHERE telegram_id = ?",
      [userData.telegram_id]
    );
    
    if (existingUsers.length > 0) {
      // ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒĞµÑ‚ (Ğ±Ñ‹Ğ» bot_only)
      const user = existingUsers[0];
      
      if (user.registration_type === 'bot_only') {
        // ĞœĞ˜Ğ“Ğ ĞĞ¦Ğ˜Ğ¯: Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ÑĞµĞ¼ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ
        await db.query(
          `UPDATE users SET 
            registration_type = 'miniapp',
            phone = ?,
            first_name = ?,
            last_name = ?,
            username = ?,
            updated_at = NOW()
          WHERE id = ?`,
          [userData.phone, userData.first_name, userData.last_name, userData.username, user.id]
        );
        
        // Ğ’Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµĞ¼ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ½Ğ¾Ğ³Ğ¾ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ
        const [updated] = await db.query("SELECT * FROM users WHERE id = ?", [user.id]);
        return res.json({ user: updated[0], token: generateToken(user.id) });
      }
      
      // ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ ÑƒĞ¶Ğµ Ğ±Ñ‹Ğ» miniapp â€” Ğ¿Ñ€Ğ¾ÑÑ‚Ğ¾ Ğ»Ğ¾Ğ³Ğ¸Ğ½
      return res.json({ user, token: generateToken(user.id) });
    }
    
    // ĞĞ¾Ğ²Ñ‹Ğ¹ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ â€” ÑĞ¾Ğ·Ğ´Ğ°ĞµĞ¼ ÑÑ€Ğ°Ğ·Ñƒ ĞºĞ°Ğº miniapp
    const [result] = await db.query(
      `INSERT INTO users (telegram_id, phone, first_name, last_name, username, registration_type, bot_registered_at) 
       VALUES (?, ?, ?, ?, ?, 'miniapp', NOW())`,
      [userData.telegram_id, userData.phone, userData.first_name, userData.last_name, userData.username]
    );
    
    const [newUser] = await db.query("SELECT * FROM users WHERE id = ?", [result.insertId]);
    res.json({ user: newUser[0], token: generateToken(result.insertId) });
    
  } catch (error) {
    next(error);
  }
};
```

**Ğ’Ğ°Ğ¶Ğ½Ğ¾:** `user_id` Ğ¾ÑÑ‚Ğ°ĞµÑ‚ÑÑ Ğ¿Ñ€ĞµĞ¶Ğ½Ğ¸Ğ¼, Ğ¿Ñ€Ğ¾ÑÑ‚Ğ¾ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ÑÑÑ‚ÑÑ Ğ¿Ğ¾Ğ»Ñ. Ğ’ÑĞµ ÑĞ²ÑĞ·Ğ¸ Ğ² `subscription_attempts` ÑĞ¾Ñ…Ñ€Ğ°Ğ½ÑÑÑ‚ÑÑ.

---

## 5. REST API endpoints (Ğ¿Ğ¾Ğ»Ğ½Ñ‹Ğ¹ ÑĞ¿Ğ¸ÑĞ¾Ğº)

### **CRUD ĞºĞ°Ğ¼Ğ¿Ğ°Ğ½Ğ¸Ğ¹**

```javascript
// Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ ĞºĞ°Ğ¼Ğ¿Ğ°Ğ½Ğ¸Ñ
POST /api/admin/subscription-campaigns
Body: {
  tag, title, channel_id, channel_url,
  welcome_message, success_message, error_message,
  media_type, media_url,
  is_reward_unique, is_perpetual, start_date, end_date
}

// Ğ¡Ğ¿Ğ¸ÑĞ¾Ğº Ğ²ÑĞµÑ… ĞºĞ°Ğ¼Ğ¿Ğ°Ğ½Ğ¸Ğ¹
GET /api/admin/subscription-campaigns
Query: ?is_active=true&limit=20&offset=0

// ĞŸĞ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ Ğ¾Ğ´Ğ½Ñƒ ĞºĞ°Ğ¼Ğ¿Ğ°Ğ½Ğ¸Ñ
GET /api/admin/subscription-campaigns/:id

// ĞĞ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ ĞºĞ°Ğ¼Ğ¿Ğ°Ğ½Ğ¸Ñ
PATCH /api/admin/subscription-campaigns/:id

// Ğ£Ğ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ (Ğ¸Ğ»Ğ¸ Ğ´ĞµĞ°ĞºÑ‚Ğ¸Ğ²Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ)
DELETE /api/admin/subscription-campaigns/:id
```

### **Ğ¡Ñ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ°**

```javascript
// ĞĞ±Ñ‰Ğ°Ñ ÑÑ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ° ĞºĞ°Ğ¼Ğ¿Ğ°Ğ½Ğ¸Ğ¸
GET /api/admin/subscription-campaigns/:id/stats
Response: {
  total_clicks: 1247,
  total_subscriptions: 823,
  conversion_rate: 66.0,
  avg_attempts: 1.8,
  total_rewards_claimed: 823,
  new_users_count: 892,        // bot_only Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¹
  existing_users_count: 355,   // ÑƒĞ¶Ğµ Ğ±Ñ‹Ğ»Ğ¸ miniapp
  migrated_to_miniapp: 127,    // ĞºĞ¾Ğ½Ğ²ĞµÑ€Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ»Ğ¸ÑÑŒ Ğ² miniapp
  timeline: [
    { date: '2026-03-01', clicks: 45, subscriptions: 32 },
    { date: '2026-03-02', clicks: 67, subscriptions: 41 },
    ...
  ]
}

// Ğ¡Ğ¿Ğ¸ÑĞ¾Ğº ÑƒÑ‡Ğ°ÑÑ‚Ğ½Ğ¸ĞºĞ¾Ğ² ĞºĞ°Ğ¼Ğ¿Ğ°Ğ½Ğ¸Ğ¸
GET /api/admin/subscription-campaigns/:id/participants
Query: ?limit=50&offset=0&order_by=first_subscribed_at&order=DESC

// Ğ­ĞºÑĞ¿Ğ¾Ñ€Ñ‚ Ğ² CSV
GET /api/admin/subscription-campaigns/:id/export
```

---

## 6. ĞĞ´Ğ¼Ğ¸Ğ½-Ğ¿Ğ°Ğ½ĞµĞ»ÑŒ (UI-Ğ¼Ğ°ĞºĞµÑ‚)

### **Ğ¡Ñ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ğ°: Ğ¡Ğ¿Ğ¸ÑĞ¾Ğº ĞºĞ°Ğ¼Ğ¿Ğ°Ğ½Ğ¸Ğ¹**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ĞŸĞ¾Ğ´Ğ¿Ğ¸ÑĞ¾Ñ‡Ğ½Ñ‹Ğµ ĞºĞ°Ğ¼Ğ¿Ğ°Ğ½Ğ¸Ğ¸                          [+ Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ]      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Ğ¤Ğ¸Ğ»ÑŒÑ‚Ñ€Ñ‹: [Ğ’ÑĞµ â–¼] [ĞĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ğµ] [Ğ—Ğ°Ğ²ĞµÑ€ÑˆĞµĞ½Ğ½Ñ‹Ğµ]    ğŸ” ĞŸĞ¾Ğ¸ÑĞº...      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Ğ¢ĞµĞ³  â”‚ ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ    â”‚ Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ â”‚ ĞŸĞµÑ€Ğ¸Ğ¾Ğ´  â”‚ ĞŸĞ¾Ğ´Ğ¿Ğ¸ÑĞ¾Ğº â”‚ Conversion  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ kzn1 â”‚ ĞšĞ°Ğ·Ğ°Ğ½ÑŒ 20%  â”‚ ğŸŸ¢     â”‚ Ğ‘ĞµÑÑÑ€Ğ¾Ñ‡ â”‚ 823      â”‚ 66.0%      â”‚ [ğŸ“Š][âœï¸][ğŸ—‘ï¸]
â”‚ msk1 â”‚ ĞœĞ¾ÑĞºĞ²Ğ° VIP  â”‚ ğŸŸ¢     â”‚ 01-31.03â”‚ 1,204    â”‚ 72.5%      â”‚ [ğŸ“Š][âœï¸][ğŸ—‘ï¸]
â”‚ spb1 â”‚ Ğ¡ĞŸĞ± Ğ¡Ñ‚Ğ°Ñ€Ñ‚   â”‚ ğŸ”´     â”‚ Ğ—Ğ°Ğ²ĞµÑ€ÑˆĞµĞ½â”‚ 456      â”‚ 58.2%      â”‚ [ğŸ“Š][âœï¸][ğŸ—‘ï¸]
â””â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### **Ğ¤Ğ¾Ñ€Ğ¼Ğ° ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ñ ĞºĞ°Ğ¼Ğ¿Ğ°Ğ½Ğ¸Ğ¸**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ ĞºĞ°Ğ¼Ğ¿Ğ°Ğ½Ğ¸Ğ¸                                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  ĞÑĞ½Ğ¾Ğ²Ğ½Ğ°Ñ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ                                            â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ: [_____________________________________]              â”‚
â”‚  Ğ£Ğ½Ğ¸ĞºĞ°Ğ»ÑŒĞ½Ğ°Ñ Ğ¼ĞµÑ‚ĞºĞ°: [kazan_promo____] (Ğ°Ğ²Ñ‚Ğ¾ Ğ¸Ğ· Ğ½Ğ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ñ)        â”‚
â”‚                                                                  â”‚
â”‚  ğŸ“¢ ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ ĞºĞ°Ğ½Ğ°Ğ»Ğ°                                            â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  ID/Username: [@kazanfoodchannel______________]                 â”‚
â”‚  Ğ¡ÑÑ‹Ğ»ĞºĞ°: [https://t.me/kazanfoodchannel_______]                â”‚
â”‚                                                                  â”‚
â”‚  âœ‰ï¸ Ğ¢ĞµĞºÑÑ‚Ñ‹ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğ¹                                            â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  ĞŸÑ€Ğ¸Ğ²ĞµÑ‚ÑÑ‚Ğ²ĞµĞ½Ğ½Ğ¾Ğµ:                                                â”‚
â”‚  [_________________________________________________________]    â”‚
â”‚  [_________________________________________________________]    â”‚
â”‚                                                                  â”‚
â”‚  ĞŸÑ€Ğ¸ ÑƒÑĞ¿ĞµÑ…Ğµ:                                                    â”‚
â”‚  [_________________________________________________________]    â”‚
â”‚                                                                  â”‚
â”‚  ĞŸÑ€Ğ¸ Ğ¾ÑˆĞ¸Ğ±ĞºĞµ:                                                    â”‚
â”‚  [_________________________________________________________]    â”‚
â”‚                                                                  â”‚
â”‚  ğŸ–¼ï¸ ĞœĞµĞ´Ğ¸Ğ° Ğ´Ğ»Ñ ÑƒÑĞ¿ĞµÑ…Ğ°                                            â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  ( ) Ğ‘ĞµĞ· Ğ¼ĞµĞ´Ğ¸Ğ°  (â€¢) Ğ¤Ğ¾Ñ‚Ğ¾  ( ) Ğ’Ğ¸Ğ´ĞµĞ¾                            â”‚
â”‚  [Ğ—Ğ°Ğ³Ñ€ÑƒĞ·Ğ¸Ñ‚ÑŒ Ñ„Ğ°Ğ¹Ğ»] Ğ¸Ğ»Ğ¸ URL: [_________________________]         â”‚
â”‚                                                                  â”‚
â”‚  ğŸ ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ Ğ¿Ñ€Ğ¸Ğ·Ğ°                                             â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  [x] Ğ£Ğ½Ğ¸ĞºĞ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ¿Ñ€Ğ¸Ğ· (Ğ¾Ğ´Ğ¸Ğ½ Ñ€Ğ°Ğ· Ğ½Ğ° Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ)                â”‚
â”‚  [ ] ĞœĞ½Ğ¾Ğ³Ğ¾Ñ€Ğ°Ğ·Ğ¾Ğ²Ñ‹Ğ¹ Ğ¿Ñ€Ğ¸Ğ· (ĞºĞ°Ğ¶Ğ´Ñ‹Ğ¹ Ñ€Ğ°Ğ· Ğ¿Ñ€Ğ¸ Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑĞºĞµ)               â”‚
â”‚                                                                  â”‚
â”‚  ğŸ“… ĞŸĞµÑ€Ğ¸Ğ¾Ğ´ Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ñ                                             â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  [ ] Ğ‘ĞµÑÑÑ€Ğ¾Ñ‡Ğ½Ğ°Ñ ĞºĞ°Ğ¼Ğ¿Ğ°Ğ½Ğ¸Ñ                                        â”‚
â”‚  ĞĞ°Ñ‡Ğ°Ğ»Ğ¾: [01.03.2026 00:00]  ĞšĞ¾Ğ½ĞµÑ†: [31.03.2026 23:59]         â”‚
â”‚                                                                  â”‚
â”‚  [Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑŒ]  [ĞŸÑ€ĞµĞ´Ğ¿Ñ€Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€ Ğ² Ğ±Ğ¾Ñ‚Ğµ]  [ĞÑ‚Ğ¼ĞµĞ½Ğ°]                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### **Ğ”ĞµÑ‚Ğ°Ğ»ÑŒĞ½Ğ°Ñ ÑÑ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ° ĞºĞ°Ğ¼Ğ¿Ğ°Ğ½Ğ¸Ğ¸**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“Š ĞšĞ°Ğ·Ğ°Ğ½ÑŒ â€” ÑĞºĞ¸Ğ´ĞºĞ° 20%                     [Ğ ĞµĞ´Ğ°ĞºÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ]     â”‚
â”‚  Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ: ğŸŸ¢ ĞĞºÑ‚Ğ¸Ğ²Ğ½Ğ° (Ğ±ĞµÑÑÑ€Ğ¾Ñ‡Ğ½Ğ°Ñ)                               â”‚
â”‚  Ğ¡ÑÑ‹Ğ»ĞºĞ°: https://t.me/yourbot?start=kazan_promo  [ğŸ“‹ ĞšĞ¾Ğ¿Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ] [ğŸ”— QR-ĞºĞ¾Ğ´]
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  ğŸ“ˆ ĞĞ±Ñ‰Ğ¸Ğµ Ğ¿Ğ¾ĞºĞ°Ğ·Ğ°Ñ‚ĞµĞ»Ğ¸                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ ĞŸĞµÑ€ĞµÑ…Ğ¾Ğ´Ğ¾Ğ²   â”‚ ĞŸĞ¾Ğ´Ğ¿Ğ¸ÑĞ°Ğ»Ğ¸ÑÑŒ â”‚ Conversion  â”‚ Ğ¡Ñ€. Ğ¿Ğ¾Ğ¿Ñ‹Ñ‚Ğ¾Ğº â”‚    â”‚
â”‚  â”‚ 1,247       â”‚ 823         â”‚ 66.0%       â”‚ 1.8         â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                  â”‚
â”‚  ğŸ‘¥ ĞŸÑ€Ğ¾Ñ„Ğ¸Ğ»ÑŒ ÑƒÑ‡Ğ°ÑÑ‚Ğ½Ğ¸ĞºĞ¾Ğ²                                          â”‚
â”‚  â€¢ ĞĞ¾Ğ²Ñ‹Ñ… Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¹ (bot_only): 892 (71.5%)                â”‚
â”‚  â€¢ Ğ¡ÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒÑÑ‰Ğ¸Ñ… ĞºĞ»Ğ¸ĞµĞ½Ñ‚Ğ¾Ğ²: 355 (28.5%)                         â”‚
â”‚  â€¢ ĞšĞ¾Ğ½Ğ²ĞµÑ€Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ»Ğ¸ÑÑŒ Ğ² Mini App: 127 (14.2% Ğ¾Ñ‚ Ğ½Ğ¾Ğ²Ñ‹Ñ…)          â”‚
â”‚                                                                  â”‚
â”‚  ğŸ“… Ğ”Ğ¸Ğ½Ğ°Ğ¼Ğ¸ĞºĞ° Ğ¿Ğ¾ Ğ´Ğ½ÑĞ¼                      [7Ğ´][30Ğ´][Ğ’ÑĞµ Ğ²Ñ€ĞµĞ¼Ñ] â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚      ĞŸĞ¾Ğ´Ğ¿Ğ¸ÑĞºĞ¸ â”€â”€â”€â”€â”€  ĞšĞ»Ğ¸ĞºĞ¸ Â·Â·Â·Â·Â·Â·Â·                       â”‚  â”‚
â”‚  â”‚  80 â”‚                           â•±â•²                        â”‚  â”‚
â”‚  â”‚  60 â”‚                      â•±â•²  â•±  â•²  â•±â•²                  â”‚  â”‚
â”‚  â”‚  40 â”‚         â•±â•²      â•±â•²â•±  â•²â•±    â•²â•±  â•²                   â”‚  â”‚
â”‚  â”‚  20 â”‚    â•±â•²â•±  â•²â•±â•²  â•±â•±                  â•²                  â”‚  â”‚
â”‚  â”‚   0 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚  â”‚
â”‚  â”‚      01  05  10  15  20  25  30  ĞœĞ°Ñ€Ñ‚                    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                  â”‚
â”‚  ğŸ• Ğ’Ñ€ĞµĞ¼Ñ Ğ´Ğ¾ Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑĞºĞ¸                                           â”‚
â”‚  < 1 Ğ¼Ğ¸Ğ½:   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 50.0% (412)                       â”‚
â”‚  1-5 Ğ¼Ğ¸Ğ½:   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 34.5% (284)                            â”‚
â”‚  > 5 Ğ¼Ğ¸Ğ½:   â–ˆâ–ˆâ–ˆâ–ˆ 15.5% (127)                                   â”‚
â”‚                                                                  â”‚
â”‚  ğŸ“‹ ĞŸĞ¾ÑĞ»ĞµĞ´Ğ½Ğ¸Ğµ Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑĞ°Ğ²ÑˆĞ¸ĞµÑÑ                   [Ğ­ĞºÑĞ¿Ğ¾Ñ€Ñ‚ CSV]    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Ğ˜Ğ¼Ñ     â”‚ Username     â”‚ Ğ’Ñ€ĞµĞ¼Ñ      â”‚ ĞŸĞ¾Ğ¿Ñ‹Ñ‚Ğ¾Ğº  â”‚ Ğ¢Ğ¸Ğ¿     â”‚ â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚  â”‚ Ğ˜Ğ²Ğ°Ğ½ ĞŸ. â”‚ @ivan_petrov â”‚ 10:45:32   â”‚ 2        â”‚ bot_onlyâ”‚ â”‚
â”‚  â”‚ ĞœĞ°Ñ€Ğ¸Ñ Ğ¡.â”‚ @maria_s     â”‚ 10:42:18   â”‚ 1        â”‚ miniapp â”‚ â”‚
â”‚  â”‚ ...     â”‚ ...          â”‚ ...        â”‚ ...      â”‚ ...     â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                               [1] 2 3 ... 17 â†’                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 7. Ğ˜Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ñ Ñ Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¼ Ñ€Ğ°ÑÑÑ‹Ğ»Ğ¾Ğº

Ğ’ ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒÑÑ‰Ğ¸Ğ¹ Ğ¼Ğ¾Ğ´ÑƒĞ»ÑŒ `newsletter` Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞµĞ¼ Ğ½Ğ¾Ğ²Ñ‹Ğ¹ Ñ‚Ğ¸Ğ¿ Ñ€Ğ°ÑÑÑ‹Ğ»ĞºĞ¸:

```javascript
// Ğ’ Ñ„Ğ¾Ñ€Ğ¼Ğµ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ñ Ñ€Ğ°ÑÑÑ‹Ğ»ĞºĞ¸
{
  type: 'subscription_campaign',  // Ğ½Ğ¾Ğ²Ñ‹Ğ¹ Ñ‚Ğ¸Ğ¿
  campaign_id: 5,                 // ID Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑĞ¾Ñ‡Ğ½Ğ¾Ğ¹ ĞºĞ°Ğ¼Ğ¿Ğ°Ğ½Ğ¸Ğ¸
  target_audience: 'bot_only',    // Ğ¸Ğ»Ğ¸ 'miniapp', 'all'
  message_template: 'default'     // Ğ¸Ğ»Ğ¸ ĞºĞ°ÑÑ‚Ğ¾Ğ¼Ğ½Ñ‹Ğ¹ Ñ‚ĞµĞºÑÑ‚
}
```

**Ğ›Ğ¾Ğ³Ğ¸ĞºĞ° Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞ¸:**

```javascript
// Ğ“ĞµĞ½ĞµÑ€Ğ¸Ñ€ÑƒĞµĞ¼ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ
const message = `
ĞŸÑ€Ğ¸Ğ²ĞµÑ‚! Ğ£ Ğ½Ğ°Ñ ÑĞ¿ĞµÑ†Ğ¸Ğ°Ğ»ÑŒĞ½Ğ¾Ğµ Ğ¿Ñ€ĞµĞ´Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ğµ Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑÑ‡Ğ¸ĞºĞ¾Ğ² ĞºĞ°Ğ½Ğ°Ğ»Ğ° "${campaign.title}".

ĞŸĞ¾Ğ´Ğ¿Ğ¸ÑˆĞ¸ÑÑŒ Ğ¸ Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ¸ Ğ¿Ñ€Ğ¸Ğ·! ğŸ

ğŸ‘‰ https://t.me/yourbot?start=${campaign.tag}
`;

// Ğ¤Ğ¸Ğ»ÑŒÑ‚Ñ€ÑƒĞµĞ¼ Ğ°ÑƒĞ´Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ñ
let query = "SELECT telegram_id FROM users WHERE telegram_id IS NOT NULL";
if (target_audience === 'bot_only') {
  query += " AND registration_type = 'bot_only'";
} else if (target_audience === 'miniapp') {
  query += " AND registration_type = 'miniapp'";
}

const [users] = await db.query(query);

// ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ÑĞµĞ¼
for (const user of users) {
  await bot.telegram.sendMessage(user.telegram_id, message);
  await sleep(100); // rate limit
}
```

---

## 8. Ğ¡Ñ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ° Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ² (Ñ„Ğ¸Ğ½Ğ°Ğ»ÑŒĞ½Ğ°Ñ)

```
backend/src/
â”œâ”€â”€ modules/
â”‚   â”œâ”€â”€ subscriptions/
â”‚   â”‚   â”œâ”€â”€ routes.js                 // REST API
â”‚   â”‚   â”œâ”€â”€ controller.js             // Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‡Ğ¸ĞºĞ¸ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ²
â”‚   â”‚   â”œâ”€â”€ service.js                // Ğ±Ğ¸Ğ·Ğ½ĞµÑ-Ğ»Ğ¾Ğ³Ğ¸ĞºĞ° ĞºĞ°Ğ¼Ğ¿Ğ°Ğ½Ğ¸Ğ¹
â”‚   â”‚   â”œâ”€â”€ telegramService.js        // Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑĞºĞ¸ Ñ‡ĞµÑ€ĞµĞ· API
â”‚   â”‚   â”œâ”€â”€ statsService.js           // Ğ³ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ñ ÑÑ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ¸
â”‚   â”‚   â”œâ”€â”€ validation.js             // Ğ²Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ñ Ğ²Ñ…Ğ¾Ğ´Ğ½Ñ‹Ñ… Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…
â”‚   â”‚   â””â”€â”€ migrations/
â”‚   â”‚       â””â”€â”€ create_subscription_tables.sql
â”‚   â”‚
â”‚   â”œâ”€â”€ newsletter/
â”‚   â”‚   â”œâ”€â”€ service.js                // + Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²ĞºÑƒ ĞºĞ°Ğ¼Ğ¿Ğ°Ğ½Ğ¸Ğ¹
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚
â”‚   â””â”€â”€ auth/
â”‚       â”œâ”€â”€ controller.js             // + Ğ»Ğ¾Ğ³Ğ¸ĞºĞ° Ğ¼Ğ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ğ¸ bot_only â†’ miniapp
â”‚       â””â”€â”€ ...
â”‚
â”œâ”€â”€ bot/
â”‚   â”œâ”€â”€ handlers/
â”‚   â”‚   â”œâ”€â”€ subscriptionHandler.js    // Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ° /start Ñ Ğ¼ĞµÑ‚ĞºĞ°Ğ¼Ğ¸
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”œâ”€â”€ keyboards/
â”‚   â”‚   â”œâ”€â”€ subscriptionKeyboards.js  // inline-ĞºĞ½Ğ¾Ğ¿ĞºĞ¸
â”‚   â”‚   â””â”€â”€ ...
â”‚   â””â”€â”€ index.js                      // Ñ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ°Ñ†Ğ¸Ñ handlers
â”‚
â””â”€â”€ utils/
    â”œâ”€â”€ telegram.js                   // + Ğ¼ĞµÑ‚Ğ¾Ğ´ getChatMember
    â””â”€â”€ errors.js
```

---

## 9. Ğ§ĞµĞºĞ»Ğ¸ÑÑ‚ Ñ€Ğ°Ğ·Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ¸ (Ğ¿Ğ¾Ñ€ÑĞ´Ğ¾Ğº Ñ€ĞµĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸)

### **Ğ¤Ğ°Ğ·Ğ° 1: Ğ‘Ğ°Ğ·Ğ° Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ¸ Ğ¼Ğ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ğ¸**
- [ ] Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñ‹ `subscription_campaigns`, `subscription_attempts`
- [ ] Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ¿Ğ¾Ğ»Ñ Ğ² `users` (`registration_type`, `bot_registered_at`)
- [ ] ĞĞ°Ğ¿Ğ¸ÑĞ°Ñ‚ÑŒ Ğ¼Ğ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ğ¸
- [ ] Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ¸Ğ½Ğ´ĞµĞºÑÑ‹

### **Ğ¤Ğ°Ğ·Ğ° 2: Backend API**
- [ ] Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Ğ¼Ğ¾Ğ´ÑƒĞ»ÑŒ `subscriptions/`
- [ ] CRUD endpoints Ğ´Ğ»Ñ ĞºĞ°Ğ¼Ğ¿Ğ°Ğ½Ğ¸Ğ¹
- [ ] Ğ’Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ñ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… (tag, dates, channel_id)
- [ ] Service Ğ´Ğ»Ñ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‹ Ñ Telegram API (`getChatMember`)
- [ ] Stats endpoints

### **Ğ¤Ğ°Ğ·Ğ° 3: Telegram Bot**
- [ ] Handler Ğ´Ğ»Ñ `/start` Ñ Ğ¿Ğ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ğ¾Ğ¼
- [ ] ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° ĞºĞ°Ğ¼Ğ¿Ğ°Ğ½Ğ¸Ğ¸ (Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾ÑÑ‚ÑŒ, Ğ´Ğ°Ñ‚Ñ‹)
- [ ] Upsert Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ (ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ bot_only)
- [ ] Inline-ĞºĞ½Ğ¾Ğ¿ĞºĞ¸ (Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑĞºĞ° + Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ°)
- [ ] Callback handler Ğ´Ğ»Ñ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ¸ Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑĞºĞ¸
- [ ] Rate limiting (10 ÑĞµĞº Ğ¼ĞµĞ¶Ğ´Ñƒ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ°Ğ¼Ğ¸)
- [ ] Ğ›Ğ¾Ğ³Ğ¸ĞºĞ° Ğ²Ñ‹Ğ´Ğ°Ñ‡Ğ¸ Ğ¿Ñ€Ğ¸Ğ·Ğ° (ÑƒĞ½Ğ¸ĞºĞ°Ğ»ÑŒĞ½Ñ‹Ğ¹ vs Ğ¼Ğ½Ğ¾Ğ³Ğ¾Ñ€Ğ°Ğ·Ğ¾Ğ²Ñ‹Ğ¹)
- [ ] ĞÑ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞ° Ğ¼ĞµĞ´Ğ¸Ğ° (Ñ„Ğ¾Ñ‚Ğ¾/Ğ²Ğ¸Ğ´ĞµĞ¾) Ñ success_message

### **Ğ¤Ğ°Ğ·Ğ° 4: ĞĞ²Ñ‚Ğ¾Ñ€Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Mini App**
- [ ] Ğ›Ğ¾Ğ³Ğ¸ĞºĞ° Ğ¼Ğ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ğ¸ bot_only â†’ miniapp
- [ ] ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒÑÑ‰ĞµĞ³Ğ¾ telegram_id
- [ ] ĞĞ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ¿Ğ¾Ğ»ĞµĞ¹ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ

### **Ğ¤Ğ°Ğ·Ğ° 5: ĞĞ´Ğ¼Ğ¸Ğ½-Ğ¿Ğ°Ğ½ĞµĞ»ÑŒ**
- [ ] Ğ¡Ñ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ğ° ÑĞ¿Ğ¸ÑĞºĞ° ĞºĞ°Ğ¼Ğ¿Ğ°Ğ½Ğ¸Ğ¹
- [ ] Ğ¤Ğ¾Ñ€Ğ¼Ğ° ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ñ/Ñ€ĞµĞ´Ğ°ĞºÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ
- [ ] Ğ”ĞµÑ‚Ğ°Ğ»ÑŒĞ½Ğ°Ñ ÑÑ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ° (Ğ³Ñ€Ğ°Ñ„Ğ¸ĞºĞ¸, Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñ‹)
- [ ] ĞšĞ¾Ğ¿Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ ÑÑÑ‹Ğ»ĞºĞ¸ + QR-ĞºĞ¾Ğ´
- [ ] Ğ­ĞºÑĞ¿Ğ¾Ñ€Ñ‚ ÑƒÑ‡Ğ°ÑÑ‚Ğ½Ğ¸ĞºĞ¾Ğ² Ğ² CSV

### **Ğ¤Ğ°Ğ·Ğ° 6: Ğ˜Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ñ Ñ Ñ€Ğ°ÑÑÑ‹Ğ»ĞºĞ°Ğ¼Ğ¸**
- [ ] Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ñ‚Ğ¸Ğ¿ `subscription_campaign` Ğ² newsletter
- [ ] Ğ“ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ñ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ñ Ñ ÑÑÑ‹Ğ»ĞºĞ¾Ğ¹ Ğ½Ğ° ĞºĞ°Ğ¼Ğ¿Ğ°Ğ½Ğ¸Ñ
- [ ] Ğ¤Ğ¸Ğ»ÑŒÑ‚Ñ€Ğ°Ñ†Ğ¸Ñ Ğ°ÑƒĞ´Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ¸ (bot_only / miniapp / all)

### **Ğ¤Ğ°Ğ·Ğ° 7: Ğ¢ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ**
- [ ] Unit-Ñ‚ĞµÑÑ‚Ñ‹ Ğ´Ğ»Ñ services
- [ ] E2E Ñ‚ĞµÑÑ‚Ñ‹ Ğ¾ÑĞ½Ğ¾Ğ²Ğ½Ğ¾Ğ³Ğ¾ flow
- [ ] ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° rate limiting
- [ ] ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ»Ğ¾Ğ³Ğ¸ĞºĞ¸ ÑƒĞ½Ğ¸ĞºĞ°Ğ»ÑŒĞ½Ñ‹Ñ…/Ğ¼Ğ½Ğ¾Ğ³Ğ¾Ñ€Ğ°Ğ·Ğ¾Ğ²Ñ‹Ñ… Ğ¿Ñ€Ğ¸Ğ·Ğ¾Ğ²
- [ ] ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ¼Ğ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ğ¸ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ

### **Ğ¤Ğ°Ğ·Ğ° 8: Ğ”Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°Ñ†Ğ¸Ñ**
- [ ] API Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°Ñ†Ğ¸Ñ (Swagger/OpenAPI)
- [ ] Ğ“Ğ°Ğ¹Ğ´ Ğ´Ğ»Ñ Ğ°Ğ´Ğ¼Ğ¸Ğ½Ğ¸ÑÑ‚Ñ€Ğ°Ñ‚Ğ¾Ñ€Ğ¾Ğ²
- [ ] Ğ˜Ğ½ÑÑ‚Ñ€ÑƒĞºÑ†Ğ¸Ñ Ğ¿Ğ¾ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞµ ĞºĞ°Ğ½Ğ°Ğ»Ğ°

---

## 10. ĞÑ†ĞµĞ½ĞºĞ° Ñ‚Ñ€ÑƒĞ´Ğ¾Ğ·Ğ°Ñ‚Ñ€Ğ°Ñ‚ (Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ½Ğ°Ñ)

**Ğ¡ ÑƒÑ‡ĞµÑ‚Ğ¾Ğ¼ Ğ¿Ğ¾Ğ»Ğ½Ğ¾Ğ³Ğ¾ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¾Ğ½Ğ°Ğ»Ğ°:**

- Ğ¤Ğ°Ğ·Ğ° 1-2 (Ğ‘Ğ” + Backend API): **3-4 Ğ´Ğ½Ñ**
- Ğ¤Ğ°Ğ·Ğ° 3 (Bot handlers): **3-4 Ğ´Ğ½Ñ**
- Ğ¤Ğ°Ğ·Ğ° 4 (ĞœĞ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ñ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¹): **1 Ğ´ĞµĞ½ÑŒ**
- Ğ¤Ğ°Ğ·Ğ° 5 (ĞĞ´Ğ¼Ğ¸Ğ½-Ğ¿Ğ°Ğ½ĞµĞ»ÑŒ): **4-5 Ğ´Ğ½ĞµĞ¹**
- Ğ¤Ğ°Ğ·Ğ° 6 (Ğ˜Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ñ Ñ Ñ€Ğ°ÑÑÑ‹Ğ»ĞºĞ°Ğ¼Ğ¸): **1-2 Ğ´Ğ½Ñ**
- Ğ¤Ğ°Ğ·Ğ° 7-8 (Ğ¢ĞµÑÑ‚Ñ‹ + Ğ”Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°Ñ†Ğ¸Ñ): **2-3 Ğ´Ğ½Ñ**

**Ğ˜Ñ‚Ğ¾Ğ³Ğ¾: 14-19 Ñ€Ğ°Ğ±Ğ¾Ñ‡Ğ¸Ñ… Ğ´Ğ½ĞµĞ¹** (Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€Ğ½Ğ¾ 3-4 Ğ½ĞµĞ´ĞµĞ»Ğ¸).

---
