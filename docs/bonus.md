# –¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ: –ë–æ–Ω—É—Å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏ (MVP)

## –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

1. [–û–±—â–µ–µ –æ–ø–∏—Å–∞–Ω–∏–µ](#–æ–±—â–µ–µ-–æ–ø–∏—Å–∞–Ω–∏–µ)
2. [–ü–∞—Ä–∞–º–µ—Ç—Ä—ã —Å–∏—Å—Ç–µ–º—ã](#–ø–∞—Ä–∞–º–µ—Ç—Ä—ã-—Å–∏—Å—Ç–µ–º—ã)
3. [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö](#–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞-–±–∞–∑—ã-–¥–∞–Ω–Ω—ã—Ö)
4. [–ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞](#–±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞)
5. [API —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è](#api-—Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è)
6. [–ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞](#–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å-–∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞)
7. [–ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∫–ª–∏–µ–Ω—Ç–∞](#–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å-–∫–ª–∏–µ–Ω—Ç–∞)
8. [–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è](#—Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ-—Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è)

---

## –û–±—â–µ–µ –æ–ø–∏—Å–∞–Ω–∏–µ

### –¶–µ–ª—å –ø—Ä–æ–µ–∫—Ç–∞

–†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ —É–ø—Ä–æ—â–µ–Ω–Ω–æ–π –±–æ–Ω—É—Å–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏ –¥–ª—è –æ–Ω–ª–∞–π–Ω-–∑–∞–∫–∞–∑–∞ –µ–¥—ã —Å —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ MVP.

### –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- 3 —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —É—Ä–æ–≤–Ω—è –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ –∏ —Å–ø–∏—Å–∞–Ω–∏–µ –±–æ–Ω—É—Å–æ–≤
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —É—Ä–æ–≤–Ω—è–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –ê–≤—Ç–æ–Ω–∞—á–∏—Å–ª–µ–Ω–∏—è –ø–æ —Ç—Ä–∏–≥–≥–µ—Ä–∞–º (—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è, –¥–µ–Ω—å —Ä–æ–∂–¥–µ–Ω–∏—è)
- –ò—Å—Ç–µ—á–µ–Ω–∏–µ –±–æ–Ω—É—Å–æ–≤
- –î–µ—Ç–∞–ª—å–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
- –ú–∏–Ω–∏–º–∞–ª–∏—Å—Ç–∏—á–Ω–∞—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω–∞—è –ø–∞–Ω–µ–ª—å
- –î–æ—Å—Ç—É–ø —á–µ—Ä–µ–∑ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–∏—Å—Ç–µ–º—ã –≤–æ –≤–∫–ª–∞–¥–∫–µ –õ–æ—è–ª—å–Ω–æ—Å—Ç—å (—É–±—Ä–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É)

---

## –ü–∞—Ä–∞–º–µ—Ç—Ä—ã —Å–∏—Å—Ç–µ–º—ã

### –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —É—Ä–æ–≤–Ω–∏ –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏

–°–∏—Å—Ç–µ–º–∞ –≤–∫–ª—é—á–∞–µ—Ç 3 —É—Ä–æ–≤–Ω—è, –∑–∞—Ö–∞—Ä–¥–∫–æ–∂–µ–Ω–Ω—ã—Ö –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:

| –£—Ä–æ–≤–µ–Ω—å | –ü–æ—Ä–æ–≥ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è | –ü—Ä–æ—Ü–µ–Ω—Ç –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è | –ú–∞–∫—Å. –ø—Ä–æ—Ü–µ–Ω—Ç —Å–ø–∏—Å–∞–Ω–∏—è |
|---------|------------------|-------------------|----------------------|
| –ë—Ä–æ–Ω–∑–∞  | 0‚ÇΩ              | 3%                | 25%                  |
| –°–µ—Ä–µ–±—Ä–æ | 10,000‚ÇΩ         | 5%                | 25%                  |
| –ó–æ–ª–æ—Ç–æ  | 20,000‚ÇΩ         | 7%                | 25%                  |

**–ü—Ä–∞–≤–∏–ª–∞:**
- –ü–µ—Ä–≤—ã–π —É—Ä–æ–≤–µ–Ω—å (–ë—Ä–æ–Ω–∑–∞) –¥–æ—Å—Ç—É–ø–µ–Ω –≤—Å–µ–º —Å –º–æ–º–µ–Ω—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
- –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π —É—Ä–æ–≤–µ–Ω—å –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏ –ø–æ—Ä–æ–≥–∞
- –ü–æ—Ä–æ–≥ —Å—á–∏—Ç–∞–µ—Ç—Å—è –ø–æ —Å—É–º–º–µ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã—Ö –∑–∞–∫–∞–∑–æ–≤ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 60 –¥–Ω–µ–π
- –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –ø—Ä–æ—Ü–µ–Ω—Ç —Å–ø–∏—Å–∞–Ω–∏—è –æ–¥–∏–Ω–∞–∫–æ–≤ –¥–ª—è –≤—Å–µ—Ö —É—Ä–æ–≤–Ω–µ–π

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è

**–ë–æ–Ω—É—Å –∑–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é:**
- –°—É–º–º–∞: 1,000 –±–æ–Ω—É—Å–æ–≤
- –ù–∞—á–∏—Å–ª—è–µ—Ç—Å—è: –æ–¥–∏–Ω —Ä–∞–∑ –ø—Ä–∏ –ø–µ—Ä–≤–æ–π —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –≤ –ø—Ä–æ–≥—Ä–∞–º–º–µ –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏
- –°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è: 30 –¥–Ω–µ–π —Å –º–æ–º–µ–Ω—Ç–∞ –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è

**–ë–æ–Ω—É—Å –∑–∞ –¥–µ–Ω—å —Ä–æ–∂–¥–µ–Ω–∏—è:**
- –°—É–º–º–∞: 500 –±–æ–Ω—É—Å–æ–≤
- –ù–∞—á–∏—Å–ª—è–µ—Ç—Å—è: –∑–∞ 3 –¥–Ω—è –¥–æ –¥–Ω—è —Ä–æ–∂–¥–µ–Ω–∏—è
- –°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è: 7 –¥–Ω–µ–π —Å–æ –¥–Ω—è —Ä–æ–∂–¥–µ–Ω–∏—è
- –ü–µ—Ä–∏–æ–¥–∏—á–Ω–æ—Å—Ç—å: –æ–¥–∏–Ω —Ä–∞–∑ –≤ –≥–æ–¥

–ü—Ä–∏–º–µ—Ä —Ä–∞—Å—á–µ—Ç–∞ —Å—Ä–æ–∫–∞ –î–† –±–æ–Ω—É—Å–∞:
- –î–µ–Ω—å —Ä–æ–∂–¥–µ–Ω–∏—è: 25 —è–Ω–≤–∞—Ä—è
- –ù–∞—á–∏—Å–ª–µ–Ω–∏–µ: 22 —è–Ω–≤–∞—Ä—è (–∑–∞ 3 –¥–Ω—è)
- –ò—Å—Ç–µ–∫–∞–µ—Ç: 1 —Ñ–µ–≤—Ä–∞–ª—è (25 —è–Ω–≤–∞—Ä—è + 7 –¥–Ω–µ–π)

### –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã

**–§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (–∑–∞—Ö–∞—Ä–¥–∫–æ–∂–µ–Ω—ã):**
- –°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è –Ω–∞—á–∏—Å–ª–µ–Ω–Ω—ã—Ö –±–æ–Ω—É—Å–æ–≤: 60 –¥–Ω–µ–π
- –ü–µ—Ä–∏–æ–¥ —Ä–∞—Å—á–µ—Ç–∞ —Å—É–º–º—ã –¥–ª—è —É—Ä–æ–≤–Ω—è: 60 –¥–Ω–µ–π
- –û–∫—Ä—É–≥–ª–µ–Ω–∏–µ: –≤—Å–µ–≥–¥–∞ –≤–Ω–∏–∑ (floor)
- –î–µ–≥—Ä–∞–¥–∞—Ü–∏—è —É—Ä–æ–≤–Ω–µ–π: –æ—Ç–∫–ª—é—á–µ–Ω–∞

**–ï–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ —Å UI:**
- –í–∫–ª—é—á–µ–Ω–∏–µ/–≤—ã–∫–ª—é—á–µ–Ω–∏–µ –º–æ–¥—É–ª—è –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏

### –§–æ—Ä–º—É–ª—ã —Ä–∞—Å—á–µ—Ç–∞

**–ù–∞—á–∏—Å–ª–µ–Ω–∏–µ –±–æ–Ω—É—Å–æ–≤:**
- –ë–∞–∑–∞ –¥–ª—è –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è = –ò—Ç–æ–≥–æ–≤–∞—è —Å—É–º–º–∞ –∑–∞–∫–∞–∑–∞ - –°—Ç–æ–∏–º–æ—Å—Ç—å –¥–æ—Å—Ç–∞–≤–∫–∏ - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–µ –±–æ–Ω—É—Å—ã
- –°—É–º–º–∞ –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è = –ë–∞–∑–∞ √ó –ü—Ä–æ—Ü–µ–Ω—Ç –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è —É—Ä–æ–≤–Ω—è
- –û–∫—Ä—É–≥–ª–µ–Ω–∏–µ –≤–Ω–∏–∑ –¥–æ —Ü–µ–ª–æ–≥–æ —Ä—É–±–ª—è

–ü—Ä–∏–º–µ—Ä:
```
–ó–∞–∫–∞–∑: 2,000‚ÇΩ
–î–æ—Å—Ç–∞–≤–∫–∞: 200‚ÇΩ
–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ –±–æ–Ω—É—Å–æ–≤: 300‚ÇΩ
–£—Ä–æ–≤–µ–Ω—å: –°–µ—Ä–µ–±—Ä–æ (5%)

–†–∞—Å—á–µ—Ç: (2,000 - 200 - 300) √ó 0.05 = 1,500 √ó 0.05 = 75‚ÇΩ
–ù–∞—á–∏—Å–ª–∏—Ç—Å—è: 75‚ÇΩ
```

**–°–ø–∏—Å–∞–Ω–∏–µ –±–æ–Ω—É—Å–æ–≤:**
- –ë–∞–∑–∞ –¥–ª—è —Å–ø–∏—Å–∞–Ω–∏—è = –ò—Ç–æ–≥–æ–≤–∞—è —Å—É–º–º–∞ –∑–∞–∫–∞–∑–∞ - –°—Ç–æ–∏–º–æ—Å—Ç—å –¥–æ—Å—Ç–∞–≤–∫–∏
- –ú–∞–∫—Å–∏–º—É–º —Å–ø–∏—Å–∞–Ω–∏—è = –ë–∞–∑–∞ √ó 25%
- –û–∫—Ä—É–≥–ª–µ–Ω–∏–µ –≤–Ω–∏–∑ –¥–æ —Ü–µ–ª–æ–≥–æ —Ä—É–±–ª—è

–ü—Ä–∏–º–µ—Ä:
```
–ó–∞–∫–∞–∑: 2,000‚ÇΩ
–î–æ—Å—Ç–∞–≤–∫–∞: 200‚ÇΩ

–†–∞—Å—á–µ—Ç: (2,000 - 200) √ó 0.25 = 1,800 √ó 0.25 = 450‚ÇΩ
–ú–∞–∫—Å–∏–º—É–º –¥–ª—è —Å–ø–∏—Å–∞–Ω–∏—è: 450‚ÇΩ
```

---

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### –¢–∞–±–ª–∏—Ü–∞: loyalty_levels

–•—Ä–∞–Ω–∏—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± —É—Ä–æ–≤–Ω—è—Ö –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏ (–∑–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è –æ–¥–∏–Ω —Ä–∞–∑ –ø—Ä–∏ –º–∏–≥—Ä–∞—Ü–∏–∏).

**–ü–æ–ª—è:**
- `id` (INTEGER, PK, AUTO_INCREMENT)
- `name` (VARCHAR(50)) - –Ω–∞–∑–≤–∞–Ω–∏–µ —É—Ä–æ–≤–Ω—è
- `threshold_amount` (DECIMAL(10,2)) - –ø–æ—Ä–æ–≥ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è –≤ —Ä—É–±–ª—è—Ö
- `earn_percentage` (INTEGER) - –ø—Ä–æ—Ü–µ–Ω—Ç –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è (3, 5, 7)
- `max_spend_percentage` (INTEGER) - –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –ø—Ä–æ—Ü–µ–Ω—Ç —Å–ø–∏—Å–∞–Ω–∏—è (25)
- `is_enabled` (BOOLEAN, default: true)
- `created_at` (TIMESTAMP)
- `updated_at` (TIMESTAMP)

**–ò–Ω–¥–µ–∫—Å—ã:**
- PRIMARY KEY –Ω–∞ `id`
- UNIQUE –Ω–∞ `threshold_amount`

**–î–∞–Ω–Ω—ã–µ (—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ):**
```
id=1: –ë—Ä–æ–Ω–∑–∞,  –ø–æ—Ä–æ–≥=0,     –Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ=3%, —Å–ø–∏—Å–∞–Ω–∏–µ=25%
id=2: –°–µ—Ä–µ–±—Ä–æ, –ø–æ—Ä–æ–≥=10000, –Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ=5%, —Å–ø–∏—Å–∞–Ω–∏–µ=25%
id=3: –ó–æ–ª–æ—Ç–æ,  –ø–æ—Ä–æ–≥=20000, –Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ=7%, —Å–ø–∏—Å–∞–Ω–∏–µ=25%
```

---

### –¢–∞–±–ª–∏—Ü–∞: users (–∏–∑–º–µ–Ω–µ–Ω–∏—è)

–î–æ–±–∞–≤–ª—è—é—Ç—Å—è –ø–æ–ª—è –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å —Å–∏—Å—Ç–µ–º–æ–π –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏.

**–ù–æ–≤—ã–µ –ø–æ–ª—è:**
- `current_loyalty_level_id` (INTEGER, FK ‚Üí loyalty_levels.id) - —Ç–µ–∫—É—â–∏–π —É—Ä–æ–≤–µ–Ω—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `loyalty_balance` (DECIMAL(10,2), default: 0.00) - —Ç–µ–∫—É—â–∏–π –±–∞–ª–∞–Ω—Å –±–æ–Ω—É—Å–æ–≤
- `loyalty_joined_at` (TIMESTAMP, nullable) - –¥–∞—Ç–∞ –≤—Å—Ç—É–ø–ª–µ–Ω–∏—è –≤ –ø—Ä–æ–≥—Ä–∞–º–º—É

**–ò–Ω–¥–µ–∫—Å—ã:**
- INDEX –Ω–∞ `current_loyalty_level_id`
- INDEX –Ω–∞ `loyalty_joined_at`

---

### –¢–∞–±–ª–∏—Ü–∞: orders (–∏–∑–º–µ–Ω–µ–Ω–∏—è)

–î–æ–±–∞–≤–ª—è—é—Ç—Å—è –ø–æ–ª—è –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –±–æ–Ω—É—Å–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π.

**–ù–æ–≤—ã–µ –ø–æ–ª—è:**
- `bonus_spent` (DECIMAL(10,2), default: 0.00) - —Å—É–º–º–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã—Ö –±–æ–Ω—É—Å–æ–≤
- `bonus_earn_amount` (DECIMAL(10,2), nullable) - –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å—É–º–º–∞ –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è
- `bonus_earn_locked` (BOOLEAN, default: false) - —Ñ–ª–∞–≥ –∑–∞—â–∏—Ç—ã –æ—Ç –¥—É–±–ª–µ–π

**–ò–Ω–¥–µ–∫—Å—ã:**
- INDEX –Ω–∞ `bonus_earn_locked`
- INDEX –Ω–∞ (`user_id`, `status`, `created_at`) –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ —É—Ä–æ–≤–Ω—è

---

### –¢–∞–±–ª–∏—Ü–∞: loyalty_transactions

–•—Ä–∞–Ω–∏—Ç –∏—Å—Ç–æ—Ä–∏—é –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π —Å –±–æ–Ω—É—Å–∞–º–∏.

**–ü–æ–ª—è:**
- `id` (INTEGER, PK, AUTO_INCREMENT)
- `user_id` (INTEGER, FK ‚Üí users.id)
- `type` (ENUM) - —Ç–∏–ø —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
  - `earn` - –Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ
  - `spend` - —Å–ø–∏—Å–∞–Ω–∏–µ
  - `expire` - –∏—Å—Ç–µ—á–µ–Ω–∏–µ
  - `registration` - –±–æ–Ω—É—Å –∑–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é
  - `birthday` - –±–æ–Ω—É—Å –∑–∞ –¥–µ–Ω—å —Ä–æ–∂–¥–µ–Ω–∏—è
  - `adjustment` - —Ä—É—á–Ω–∞—è –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞
- `status` (ENUM)
  - `pending` - –æ–∂–∏–¥–∞–µ—Ç (–¥–ª—è —Å–ø–∏—Å–∞–Ω–∏–π –ø—Ä–∏ —Å—Ç–∞—Ç—É—Å–µ new)
  - `completed` - –≤—ã–ø–æ–ª–Ω–µ–Ω–∞
  - `cancelled` - –æ—Ç–º–µ–Ω–µ–Ω–∞
- `amount` (DECIMAL(10,2)) - —Å—É–º–º–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
- `remaining_amount` (DECIMAL(10,2)) - –æ—Å—Ç–∞—Ç–æ–∫ (–¥–ª—è —Ç–∏–ø–∞ earn)
- `order_id` (INTEGER, FK ‚Üí orders.id, nullable)
- `related_transaction_id` (INTEGER, FK ‚Üí loyalty_transactions.id, nullable)
- `description` (TEXT, nullable) - –æ–ø–∏—Å–∞–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
- `expires_at` (TIMESTAMP, nullable) - –¥–∞—Ç–∞ –∏—Å—Ç–µ—á–µ–Ω–∏—è (–¥–ª—è earn)
- `admin_id` (INTEGER, FK ‚Üí admins.id, nullable) - –∫—Ç–æ –≤—ã–ø–æ–ª–Ω–∏–ª (–¥–ª—è adjustment)
- `created_at` (TIMESTAMP)
- `updated_at` (TIMESTAMP)

**–ò–Ω–¥–µ–∫—Å—ã:**
- PRIMARY KEY –Ω–∞ `id`
- INDEX –Ω–∞ `user_id`
- INDEX –Ω–∞ `order_id`
- INDEX –Ω–∞ `type`
- INDEX –Ω–∞ `status`
- INDEX –Ω–∞ `expires_at` (–¥–ª—è –ø–æ–∏—Å–∫–∞ –∏—Å—Ç–µ–∫–∞—é—â–∏—Ö)
- COMPOSITE –Ω–∞ (`user_id`, `type`, `created_at`) –¥–ª—è –∏—Å—Ç–æ—Ä–∏–∏

**–õ–æ–≥–∏–∫–∞ FIFO –ø—Ä–∏ —Å–ø–∏—Å–∞–Ω–∏–∏:**
- –ü—Ä–∏ —Å–ø–∏—Å–∞–Ω–∏–∏ –±–æ–Ω—É—Å–æ–≤ —Å–ø–∏—Å—ã–≤–∞—é—Ç—Å—è —Å–Ω–∞—á–∞–ª–∞ —Å–∞–º—ã–µ —Å—Ç–∞—Ä—ã–µ –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è (–ø–æ created_at)
- –£ –∫–∞–∂–¥–æ–≥–æ –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è (type=earn) –µ—Å—Ç—å remaining_amount
- –ü—Ä–∏ —á–∞—Å—Ç–∏—á–Ω–æ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ —É–º–µ–Ω—å—à–∞–µ—Ç—Å—è remaining_amount

---

### –¢–∞–±–ª–∏—Ü–∞: user_loyalty_levels

–ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏—è —É—Ä–æ–≤–Ω–µ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.

**–ü–æ–ª—è:**
- `id` (INTEGER, PK, AUTO_INCREMENT)
- `user_id` (INTEGER, FK ‚Üí users.id)
- `loyalty_level_id` (INTEGER, FK ‚Üí loyalty_levels.id)
- `previous_level_id` (INTEGER, FK ‚Üí loyalty_levels.id, nullable)
- `reason` (VARCHAR(255)) - –ø—Ä–∏—á–∏–Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è
- `threshold_sum` (DECIMAL(10,2)) - —Å—É–º–º–∞ –∑–∞–∫–∞–∑–æ–≤ –Ω–∞ –º–æ–º–µ–Ω—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è
- `created_at` (TIMESTAMP)

**–ò–Ω–¥–µ–∫—Å—ã:**
- PRIMARY KEY –Ω–∞ `id`
- INDEX –Ω–∞ `user_id`
- INDEX –Ω–∞ (`user_id`, `created_at`) –¥–ª—è –∏—Å—Ç–æ—Ä–∏–∏

---

### –¢–∞–±–ª–∏—Ü–∞: loyalty_logs

–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –ª–æ–≥–∏ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ –∏ –∞—É–¥–∏—Ç–∞.

**–ü–æ–ª—è:**
- `id` (INTEGER, PK, AUTO_INCREMENT)
- `user_id` (INTEGER, FK ‚Üí users.id, nullable)
- `order_id` (INTEGER, FK ‚Üí orders.id, nullable)
- `event_type` (VARCHAR(50)) - —Ç–∏–ø —Å–æ–±—ã—Ç–∏—è
  - `balance_calculated` - —Ä–∞—Å—á–µ—Ç –±–∞–ª–∞–Ω—Å–∞
  - `level_changed` - —Å–º–µ–Ω–∞ —É—Ä–æ–≤–Ω—è
  - `bonus_expired` - –∏—Å—Ç–µ—á–µ–Ω–∏–µ –±–æ–Ω—É—Å–æ–≤
  - `duplicate_prevented` - –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω –¥—É–±–ª—å
  - `negative_balance` - –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–π –±–∞–ª–∞–Ω—Å
- `old_value` (TEXT, nullable)
- `new_value` (TEXT, nullable)
- `metadata` (JSON, nullable) - –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
- `created_at` (TIMESTAMP)

**–ò–Ω–¥–µ–∫—Å—ã:**
- PRIMARY KEY –Ω–∞ `id`
- INDEX –Ω–∞ `user_id`
- INDEX –Ω–∞ `order_id`
- INDEX –Ω–∞ `event_type`
- INDEX –Ω–∞ `created_at`

---

## –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞

### –í—Å—Ç—É–ø–ª–µ–Ω–∏–µ –≤ –ø—Ä–æ–≥—Ä–∞–º–º—É –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏

**–¢—Ä–∏–≥–≥–µ—Ä:** –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**–î–µ–π—Å—Ç–≤–∏—è:**
1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å `current_loyalty_level_id = 1` (–ë—Ä–æ–Ω–∑–∞)
2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å `loyalty_joined_at = NOW()`
3. –ù–∞—á–∏—Å–ª–∏—Ç—å 1,000 –±–æ–Ω—É—Å–æ–≤ (—Ç–∏–ø: registration)
4. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å—Ä–æ–∫ –∏—Å—Ç–µ—á–µ–Ω–∏—è: NOW() + 30 –¥–Ω–µ–π
5. –°–æ–∑–¥–∞—Ç—å –∑–∞–ø–∏—Å—å –≤ `user_loyalty_levels`

---

### –ù–∞—á–∏—Å–ª–µ–Ω–∏–µ –±–æ–Ω—É—Å–æ–≤

**–ú–æ–º–µ–Ω—Ç –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è:** –ü—Ä–∏ –ø–µ—Ä–≤–æ–º –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏ –∑–∞–∫–∞–∑–æ–º —Å—Ç–∞—Ç—É—Å–∞ `delivered` –∏–ª–∏ `completed`

**–£—Å–ª–æ–≤–∏—è:**
- –ó–∞–∫–∞–∑ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤ —Å—Ç–∞—Ç—É—Å–µ delivered/completed
- –ü–æ–ª–µ `bonus_earn_locked = false` (–∑–∞—â–∏—Ç–∞ –æ—Ç –¥—É–±–ª–µ–π)
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É—á–∞—Å—Ç–≤—É–µ—Ç –≤ –ø—Ä–æ–≥—Ä–∞–º–º–µ

**–ê–ª–≥–æ—Ä–∏—Ç–º:**

1. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏:**
   - –ï—Å–ª–∏ `bonus_earn_locked = true` ‚Üí –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å –Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ
   - –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å `bonus_earn_locked = true` –∞—Ç–æ–º–∞—Ä–Ω–æ

2. **–†–∞—Å—á–µ—Ç —Å—É–º–º—ã:**
   - –ë–∞–∑–∞ = `order_total - delivery_cost - bonus_spent`
   - –ü—Ä–æ—Ü–µ–Ω—Ç = –ø—Ä–æ—Ü–µ–Ω—Ç –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è —Ç–µ–∫—É—â–µ–≥–æ —É—Ä–æ–≤–Ω—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
   - –°—É–º–º–∞ = `floor(–ë–∞–∑–∞ √ó –ü—Ä–æ—Ü–µ–Ω—Ç)`

3. **–§–∏–∫—Å–∞—Ü–∏—è —Å—É–º–º—ã:**
   - –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ä–∞—Å—Å—á–∏—Ç–∞–Ω–Ω—É—é —Å—É–º–º—É –≤ `orders.bonus_earn_amount`
   - –î–∞–∂–µ –µ—Å–ª–∏ —É—Ä–æ–≤–µ–Ω—å –∏–∑–º–µ–Ω–∏—Ç—Å—è –ø–æ–∑–∂–µ - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —ç—Ç—É –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—É—é —Å—É–º–º—É

4. **–°–æ–∑–¥–∞–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏:**
   - –¢–∏–ø: `earn`
   - –°—Ç–∞—Ç—É—Å: `completed`
   - –°—É–º–º–∞: –∏–∑ `bonus_earn_amount`
   - –°—Ä–æ–∫ –∏—Å—Ç–µ—á–µ–Ω–∏—è: NOW() + 60 –¥–Ω–µ–π
   - remaining_amount = amount

5. **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞:**
   - –£–≤–µ–ª–∏—á–∏—Ç—å `users.loyalty_balance` –Ω–∞ —Å—É–º–º—É –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è

**–ó–∞—â–∏—Ç–∞ –æ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è:**
- –§–ª–∞–≥ `bonus_earn_locked` –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –ø–æ–≤—Ç–æ—Ä–Ω–æ–µ –Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ
- –ü—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–º –ø–µ—Ä–µ—Ö–æ–¥–µ –≤ delivered –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —É–∂–µ –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å—É–º–º–∞
- –ü—Ä–æ–≤–µ—Ä–∫–∞ affected_rows –ø—Ä–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–µ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏

---

### –°–ø–∏—Å–∞–Ω–∏–µ –±–æ–Ω—É—Å–æ–≤

**–ú–æ–º–µ–Ω—Ç —Å–ø–∏—Å–∞–Ω–∏—è:** –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞–∫–∞–∑–∞ (—Å—Ç–∞—Ç—É—Å `new`)

**–£—Å–ª–æ–≤–∏—è:**
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∫–∞–∑—ã–≤–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–æ–Ω—É—Å–æ–≤ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
- –ë–∞–ª–∞–Ω—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–æ—Å—Ç–∞—Ç–æ—á–µ–Ω
- –ù–µ –ø—Ä–µ–≤—ã—à–µ–Ω –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –ø—Ä–æ—Ü–µ–Ω—Ç —Å–ø–∏—Å–∞–Ω–∏—è (25%)

**–ê–ª–≥–æ—Ä–∏—Ç–º:**

1. **–í–∞–ª–∏–¥–∞—Ü–∏—è:**
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –±–∞–ª–∞–Ω—Å: `loyalty_balance >= –∑–∞–ø—Ä–æ—à–µ–Ω–Ω–∞—è_—Å—É–º–º–∞`
   - –†–∞—Å—Å—á–∏—Ç–∞—Ç—å –º–∞–∫—Å–∏–º—É–º: `floor((order_total - delivery_cost) √ó 0.25)`
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å: `–∑–∞–ø—Ä–æ—à–µ–Ω–Ω–∞—è_—Å—É–º–º–∞ <= –º–∞–∫—Å–∏–º—É–º`

2. **–í—ã–±–æ—Ä –±–æ–Ω—É—Å–æ–≤ –ø–æ FIFO:**
   - –í—ã–±—Ä–∞—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–µ –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è (type=earn, status=completed, remaining_amount > 0)
   - –û—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ created_at (–æ—Ç —Å—Ç–∞—Ä—ã—Ö –∫ –Ω–æ–≤—ã–º)
   - –°–ø–∏—Å—ã–≤–∞—Ç—å –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ —Å —Å–∞–º—ã—Ö —Å—Ç–∞—Ä—ã—Ö

3. **–°–æ–∑–¥–∞–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏:**
   - –¢–∏–ø: `spend`
   - –°—Ç–∞—Ç—É—Å: `pending` (–¥–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞)
   - –°—É–º–º–∞: –∑–∞–ø—Ä–æ—à–µ–Ω–Ω–∞—è —Å—É–º–º–∞
   - –ü—Ä–∏–≤—è–∑–∫–∞ –∫ order_id

4. **–£–º–µ–Ω—å—à–µ–Ω–∏–µ remaining_amount:**
   - –£ –∫–∞–∂–¥–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω–æ–≥–æ earn —É–º–µ–Ω—å—à–∏—Ç—å remaining_amount
   - –ï—Å–ª–∏ –±–æ–Ω—É—Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω –ø–æ–ª–Ω–æ—Å—Ç—å—é - remaining_amount = 0

5. **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞:**
   - –£–º–µ–Ω—å—à–∏—Ç—å `users.loyalty_balance` –Ω–∞ —Å—É–º–º—É —Å–ø–∏—Å–∞–Ω–∏—è

6. **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –∑–∞–∫–∞–∑–µ:**
   - –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å `orders.bonus_spent = —Å—É–º–º–∞`

**–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø—Ä–∏ delivered:**
- –ò–∑–º–µ–Ω–∏—Ç—å —Å—Ç–∞—Ç—É—Å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ spend –Ω–∞ `completed`
- –ù–∏–∫–∞–∫–∏—Ö –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è

---

### –û—Ç–º–µ–Ω–∞ —Å–ø–∏—Å–∞–Ω–∏—è (cancelled –∑–∞–∫–∞–∑)

**–ú–æ–º–µ–Ω—Ç:** –ü—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ –∑–∞–∫–∞–∑–∞ –≤ —Å—Ç–∞—Ç—É—Å `cancelled`

**–£—Å–ª–æ–≤–∏—è:**
- –í –∑–∞–∫–∞–∑–µ –±—ã–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω—ã –±–æ–Ω—É—Å—ã (`bonus_spent > 0`)
- –ï—Å—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è —Ç–∏–ø–∞ `spend` —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º `pending`

**–ê–ª–≥–æ—Ä–∏—Ç–º:**

1. **–û—Ç–º–µ–Ω–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏:**
   - –ù–∞–π—Ç–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é spend –¥–ª—è —ç—Ç–æ–≥–æ –∑–∞–∫–∞–∑–∞
   - –ò–∑–º–µ–Ω–∏—Ç—å —Å—Ç–∞—Ç—É—Å –Ω–∞ `cancelled`

2. **–í–æ–∑–≤—Ä–∞—Ç –±–æ–Ω—É—Å–æ–≤:**
   - –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å remaining_amount —É earn —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π (–ø–æ —Å–≤—è–∑–∏)
   - –£–≤–µ–ª–∏—á–∏—Ç—å `users.loyalty_balance` –Ω–∞ —Å—É–º–º—É –≤–æ–∑–≤—Ä–∞—Ç–∞

3. **–û–±–Ω—É–ª–µ–Ω–∏–µ –≤ –∑–∞–∫–∞–∑–µ:**
   - –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å `orders.bonus_spent = 0`

**–í–∞–∂–Ω–æ:** –í–æ–∑–≤—Ä–∞—Ç –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –∫ —Ç–µ–º –∂–µ earn —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è–º, –æ—Ç–∫—É–¥–∞ –±—ã–ª–∏ —Å–ø–∏—Å–∞–Ω—ã, —Å–æ—Ö—Ä–∞–Ω—è—è FIFO –æ—á–µ—Ä–µ–¥–Ω–æ—Å—Ç—å.

---

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —É—Ä–æ–≤–Ω—è–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

**–¢—Ä–∏–≥–≥–µ—Ä:** –ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ earn (–Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ –∑–∞ –∑–∞–∫–∞–∑)

**–ß–∞—Å—Ç–æ—Ç–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏:** –ü–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω–æ–≥–æ –∑–∞–∫–∞–∑–∞

**–ê–ª–≥–æ—Ä–∏—Ç–º:**

1. **–†–∞—Å—á–µ—Ç —Å—É–º–º—ã –∑–∞–∫–∞–∑–æ–≤:**
   - –í—ã–±—Ä–∞—Ç—å –∑–∞–∫–∞–∑—ã –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 60 –¥–Ω–µ–π
   - –°—Ç–∞—Ç—É—Å—ã: `delivered` –∏–ª–∏ `completed`
   - –°—É–º–º–∞ = `SUM(order_total - delivery_cost - bonus_spent)`

2. **–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —É—Ä–æ–≤–Ω—è:**
   - –°—Ä–∞–≤–Ω–∏—Ç—å —Å—É–º–º—É —Å –ø–æ—Ä–æ–≥–∞–º–∏ —É—Ä–æ–≤–Ω–µ–π (0‚ÇΩ, 10,000‚ÇΩ, 20,000‚ÇΩ)
   - –í—ã–±—Ä–∞—Ç—å –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å, –ø–æ—Ä–æ–≥ –∫–æ—Ç–æ—Ä–æ–≥–æ <= —Å—É–º–º–∞

3. **–ò–∑–º–µ–Ω–µ–Ω–∏–µ —É—Ä–æ–≤–Ω—è (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ):**
   - –ï—Å–ª–∏ –Ω–æ–≤—ã–π —É—Ä–æ–≤–µ–Ω—å –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è –æ—Ç —Ç–µ–∫—É—â–µ–≥–æ:
     - –û–±–Ω–æ–≤–∏—Ç—å `users.current_loyalty_level_id`
     - –°–æ–∑–¥–∞—Ç—å –∑–∞–ø–∏—Å—å –≤ `user_loyalty_levels`
     - –£–∫–∞–∑–∞—Ç—å previous_level_id, reason, threshold_sum

**–ü—Ä–∞–≤–∏–ª–∞:**
- –ü–µ—Ä–µ—Ö–æ–¥ –≤–æ–∑–º–æ–∂–µ–Ω —Ç–æ–ª—å–∫–æ –≤–≤–µ—Ä—Ö (–¥–µ–≥—Ä–∞–¥–∞—Ü–∏—è –æ—Ç–∫–ª—é—á–µ–Ω–∞ –≤ MVP)
- –£—Ä–æ–≤–µ–Ω—å –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –Ω–∞—á–∏—Å–ª–µ–Ω–∏–∏ –∑–∞ –∑–∞–∫–∞–∑
- –ü—Ä–∏ —Ä—É—á–Ω–æ–π –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–µ –±–∞–ª–∞–Ω—Å–∞ —É—Ä–æ–≤–µ–Ω—å –ù–ï –º–µ–Ω—è–µ—Ç—Å—è

---

### –ò—Å—Ç–µ—á–µ–Ω–∏–µ –±–æ–Ω—É—Å–æ–≤

**–¢—Ä–∏–≥–≥–µ—Ä:** Cron –∑–∞–¥–∞—á–∞, –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –µ–∂–µ–¥–Ω–µ–≤–Ω–æ –≤ 04:00

**–ê–ª–≥–æ—Ä–∏—Ç–º:**

1. **–ü–æ–∏—Å–∫ –∏—Å—Ç–µ–∫—à–∏—Ö:**
   - –í—ã–±—Ä–∞—Ç—å –≤—Å–µ earn —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
   - –£—Å–ª–æ–≤–∏—è:
     - `status = completed`
     - `expires_at < NOW()`
     - `remaining_amount > 0`

2. **–°–æ–∑–¥–∞–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π expire:**
   - –î–ª—è –∫–∞–∂–¥–æ–≥–æ –∏—Å—Ç–µ–∫—à–µ–≥–æ –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è:
     - –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é
     - –¢–∏–ø: `expire`
     - –°—Ç–∞—Ç—É—Å: `completed`
     - –°—É–º–º–∞: remaining_amount
     - related_transaction_id: —Å—Å—ã–ª–∫–∞ –Ω–∞ earn

3. **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–æ–≤:**
   - –£–º–µ–Ω—å—à–∏—Ç—å `users.loyalty_balance` –Ω–∞ —Å—É–º–º—É –∏—Å—Ç–µ–∫—à–∏—Ö
   - –û–±–Ω—É–ª–∏—Ç—å remaining_amount —É earn —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π

4. **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:**
   - –ó–∞–ø–∏—Å–∞—Ç—å –≤ loyalty_logs —Å–æ–±—ã—Ç–∏–µ `bonus_expired`

---

### –ë–æ–Ω—É—Å –∑–∞ –¥–µ–Ω—å —Ä–æ–∂–¥–µ–Ω–∏—è

**–¢—Ä–∏–≥–≥–µ—Ä:** Cron –∑–∞–¥–∞—á–∞, –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –µ–∂–µ–¥–Ω–µ–≤–Ω–æ –≤ 02:00

**–ê–ª–≥–æ—Ä–∏—Ç–º:**

1. **–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ü–µ–ª–µ–≤–æ–π –¥–∞—Ç—ã:**
   - –†–∞—Å—Å—á–∏—Ç–∞—Ç—å –¥–∞—Ç—É = NOW() + 3 –¥–Ω—è
   - –ò–∑–≤–ª–µ—á—å –¥–µ–Ω—å –∏ –º–µ—Å—è—Ü

2. **–ü–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:**
   - –í—ã–±—Ä–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å birth_date
   - –î–µ–Ω—å –∏ –º–µ—Å—è—Ü birth_date —Å–æ–≤–ø–∞–¥–∞—é—Ç —Å —Ü–µ–ª–µ–≤–æ–π –¥–∞—Ç–æ–π
   - –£ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–µ—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ birthday –≤ —Ç–µ–∫—É—â–µ–º –≥–æ–¥—É

3. **–ù–∞—á–∏—Å–ª–µ–Ω–∏–µ –±–æ–Ω—É—Å–∞:**
   - –°–æ–∑–¥–∞—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é:
     - –¢–∏–ø: `birthday`
     - –°—Ç–∞—Ç—É—Å: `completed`
     - –°—É–º–º–∞: 500‚ÇΩ
     - –°—Ä–æ–∫ –∏—Å—Ç–µ—á–µ–Ω–∏—è: –¥–µ–Ω—å —Ä–æ–∂–¥–µ–Ω–∏—è + 7 –¥–Ω–µ–π
     - remaining_amount = 500

4. **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞:**
   - –£–≤–µ–ª–∏—á–∏—Ç—å `users.loyalty_balance` –Ω–∞ 500‚ÇΩ

**–ü—Ä–∏–º–µ—Ä:**
- –°–µ–≥–æ–¥–Ω—è: 22 —è–Ω–≤–∞—Ä—è
- –¶–µ–ª–µ–≤–∞—è –¥–∞—Ç–∞: 25 —è–Ω–≤–∞—Ä—è (22 + 3 –¥–Ω—è)
- –ù–∞–π—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å –î–† 25 —è–Ω–≤–∞—Ä—è
- –ù–∞—á–∏—Å–ª–∏—Ç—å 500‚ÇΩ, —Å—Ä–æ–∫: 1 —Ñ–µ–≤—Ä–∞–ª—è (25 —è–Ω–≤–∞—Ä—è + 7 –¥–Ω–µ–π)

---

### –ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞ –±–∞–ª–∞–Ω—Å–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º

**–¢—Ä–∏–≥–≥–µ—Ä:** –†—É—á–Ω–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –≤ –∞–¥–º–∏–Ω –ø–∞–Ω–µ–ª–∏

**–¢–∏–ø—ã –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–æ–∫:**
- –ù–∞—á–∏—Å–ª–µ–Ω–∏–µ (adjustment —Å –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–æ–π —Å—É–º–º–æ–π)
- –°–ø–∏—Å–∞–Ω–∏–µ (adjustment —Å –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ–π —Å—É–º–º–æ–π)

**–ê–ª–≥–æ—Ä–∏—Ç–º:**

1. **–í–∞–ª–∏–¥–∞—Ü–∏—è:**
   - –£–∫–∞–∑–∞–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
   - –£–∫–∞–∑–∞–Ω–∞ —Å—É–º–º–∞ (–º–æ–∂–µ—Ç –±—ã—Ç—å –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–æ–π –∏–ª–∏ –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ–π)
   - –£–∫–∞–∑–∞–Ω–∞ –ø—Ä–∏—á–∏–Ω–∞ –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∏
   - –ü—Ä–∏ —Å–ø–∏—Å–∞–Ω–∏–∏: –±–∞–ª–∞–Ω—Å >= —Å—É–º–º–∞ —Å–ø–∏—Å–∞–Ω–∏—è

2. **–°–æ–∑–¥–∞–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏:**
   - –¢–∏–ø: `adjustment`
   - –°—Ç–∞—Ç—É—Å: `completed`
   - –°—É–º–º–∞: —É–∫–∞–∑–∞–Ω–Ω–∞—è —Å—É–º–º–∞
   - –û–ø–∏—Å–∞–Ω–∏–µ: –ø—Ä–∏—á–∏–Ω–∞
   - admin_id: ID –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞

3. **–î–ª—è –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è (+):**
   - –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å expires_at: NOW() + 60 –¥–Ω–µ–π
   - remaining_amount = amount
   - –£–≤–µ–ª–∏—á–∏—Ç—å `users.loyalty_balance`

4. **–î–ª—è —Å–ø–∏—Å–∞–Ω–∏—è (-):**
   - –°–ø–∏—Å–∞—Ç—å –ø–æ FIFO (–∫–∞–∫ –ø—Ä–∏ –æ–±—ã—á–Ω–æ–º —Å–ø–∏—Å–∞–Ω–∏–∏)
   - –£–º–µ–Ω—å—à–∏—Ç—å remaining_amount —É earn —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
   - –£–º–µ–Ω—å—à–∏—Ç—å `users.loyalty_balance`

5. **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:**
   - –ó–∞–ø–∏—Å–∞—Ç—å –≤ loyalty_logs —Å–æ–±—ã—Ç–∏–µ `balance_adjusted`
   - –°–æ—Ö—Ä–∞–Ω–∏—Ç—å old_value –∏ new_value –±–∞–ª–∞–Ω—Å–∞

**–í–∞–∂–Ω–æ:** –ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞ –ù–ï –≤–ª–∏—è–µ—Ç –Ω–∞ —Ä–∞—Å—á–µ—Ç —É—Ä–æ–≤–Ω—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

---

## API —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è

### –ö–ª–∏–µ–Ω—Ç—Å–∫–∏–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã

#### –ü–æ–ª—É—á–∏—Ç—å –±–∞–ª–∞–Ω—Å –∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø—Ä–æ–≥—Ä–∞–º–º–µ

**GET** `/api/client/loyalty/balance`

**–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è:** –¢—Ä–µ–±—É–µ—Ç—Å—è (JWT —Ç–æ–∫–µ–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)

**–û—Ç–≤–µ—Ç:** –û–±—ä–µ–∫—Ç —Å –¥–∞–Ω–Ω—ã–º–∏ –æ –±–∞–ª–∞–Ω—Å–µ, —Ç–µ–∫—É—â–µ–º —É—Ä–æ–≤–Ω–µ, –ø—Ä–æ–≥—Ä–µ—Å—Å–µ –¥–æ —Å–ª–µ–¥—É—é—â–µ–≥–æ —É—Ä–æ–≤–Ω—è, –∏—Å—Ç–µ–∫–∞—é—â–∏—Ö –±–æ–Ω—É—Å–∞—Ö

---

#### –†–∞—Å—Å—á–∏—Ç–∞—Ç—å –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ —Å–ø–∏—Å–∞–Ω–∏–µ –¥–ª—è –∑–∞–∫–∞–∑–∞

**GET** `/api/client/loyalty/calculate-max-spend`

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–∞:**
- `orderTotal` - –∏—Ç–æ–≥–æ–≤–∞—è —Å—É–º–º–∞ –∑–∞–∫–∞–∑–∞
- `deliveryCost` - —Å—Ç–æ–∏–º–æ—Å—Ç—å –¥–æ—Å—Ç–∞–≤–∫–∏

**–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è:** –¢—Ä–µ–±—É–µ—Ç—Å—è

**–õ–æ–≥–∏–∫–∞:**
- –ë–∞–∑–∞ = orderTotal - deliveryCost
- –ú–∞–∫—Å–∏–º—É–º = floor(–ë–∞–∑–∞ √ó 0.25)
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–ª–∞–Ω—Å–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –í–æ–∑–≤—Ä–∞—Ç –º–∏–Ω–∏–º—É–º–∞ –∏–∑ (–º–∞–∫—Å–∏–º—É–º, –±–∞–ª–∞–Ω—Å)

**–û—Ç–≤–µ—Ç:** –û–±—ä–µ–∫—Ç —Å –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π —Å—É–º–º–æ–π –¥–ª—è —Å–ø–∏—Å–∞–Ω–∏—è

---

#### –ü–æ–ª—É—á–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π

**GET** `/api/client/loyalty/history`

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–∞:**
- `page` - –Ω–æ–º–µ—Ä —Å—Ç—Ä–∞–Ω–∏—Ü—ã (default: 1)
- `limit` - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–µ–π (default: 50, max: 50)

**–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è:** –¢—Ä–µ–±—É–µ—Ç—Å—è

**–û—Ç–≤–µ—Ç:** –°–ø–∏—Å–æ–∫ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ —Ç–∏–ø–µ, —Å—É–º–º–µ, –¥–∞—Ç–µ, –Ω–æ–º–µ—Ä–µ –∑–∞–∫–∞–∑–∞, —Å—Ä–æ–∫–µ –∏—Å—Ç–µ—á–µ–Ω–∏—è. –§–ª–∞–≥ –Ω–∞–ª–∏—á–∏—è —Å–ª–µ–¥—É—é—â–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã.

---

#### –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ —É—Ä–æ–≤–Ω–µ–π –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏

**GET** `/api/client/loyalty/levels`

**–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è:** –¢—Ä–µ–±—É–µ—Ç—Å—è

**–û—Ç–≤–µ—Ç:** –¢–µ–∫—É—â–∏–π —É—Ä–æ–≤–µ–Ω—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —É—Ä–æ–≤–Ω–µ–π —Å –ø–æ—Ä–æ–≥–∞–º–∏ –∏ –ø—Ä–æ—Ü–µ–Ω—Ç–∞–º–∏, –ø—Ä–æ–≥—Ä–µ—Å—Å –¥–æ —Å–ª–µ–¥—É—é—â–µ–≥–æ —É—Ä–æ–≤–Ω—è.

---

### –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã

#### –ü–æ–ª—É—á–∏—Ç—å —Å—Ç–∞—Ç—É—Å –º–æ–¥—É–ª—è –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏

**GET** `/api/admin/loyalty/status`

**–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è:** –¢—Ä–µ–±—É–µ—Ç—Å—è (—Ä–æ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞)

**–û—Ç–≤–µ—Ç:** –û–±—ä–µ–∫—Ç —Å —Ñ–ª–∞–≥–æ–º –≤–∫–ª—é—á–µ–Ω–∏—è/–≤—ã–∫–ª—é—á–µ–Ω–∏—è –º–æ–¥—É–ª—è

---

#### –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å –º–æ–¥—É–ª—å –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏

**PUT** `/api/admin/loyalty/toggle`

**–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è:** –¢—Ä–µ–±—É–µ—Ç—Å—è (—Ä–æ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞)

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:** –§–ª–∞–≥ –≤–∫–ª—é—á–µ–Ω–∏—è/–≤—ã–∫–ª—é—á–µ–Ω–∏—è

**–≠—Ñ—Ñ–µ–∫—Ç:** –ì–ª–æ–±–∞–ª—å–Ω–æ–µ –≤–∫–ª—é—á–µ–Ω–∏–µ/–≤—ã–∫–ª—é—á–µ–Ω–∏–µ –≤—Å–µ–π —Å–∏—Å—Ç–µ–º—ã –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏

---

#### –ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞ –±–∞–ª–∞–Ω—Å–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**POST** `/api/admin/loyalty/adjust`

**–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è:** –¢—Ä–µ–±—É–µ—Ç—Å—è (—Ä–æ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞)

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –°—É–º–º–∞ –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∏ (–ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–∞—è –¥–ª—è –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è, –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–∞—è –¥–ª—è —Å–ø–∏—Å–∞–Ω–∏—è)
- –ü—Ä–∏—á–∏–Ω–∞ –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∏
- –¢–∏–ø –æ–ø–µ—Ä–∞—Ü–∏–∏ (earn –∏–ª–∏ spend)

**–õ–æ–≥–∏–∫–∞:**
- –í–∞–ª–∏–¥–∞—Ü–∏—è –±–∞–ª–∞–Ω—Å–∞ –ø—Ä–∏ —Å–ø–∏—Å–∞–Ω–∏–∏
- –°–æ–∑–¥–∞–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ —Ç–∏–ø–∞ adjustment
- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞

**–û—Ç–≤–µ—Ç:** –ù–æ–≤—ã–π –±–∞–ª–∞–Ω—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–æ–∑–¥–∞–Ω–Ω–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏

---

#### –ü–æ–ª—É—á–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –±–æ–Ω—É—Å–∞—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**GET** `/api/admin/users/:id/loyalty`

**–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è:** –¢—Ä–µ–±—É–µ—Ç—Å—è (—Ä–æ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞)

**–û—Ç–≤–µ—Ç:** –¢–µ–∫—É—â–∏–π –±–∞–ª–∞–Ω—Å, —É—Ä–æ–≤–µ–Ω—å, –∏—Å—Ç–æ—Ä–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π, —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ (–≤—Å–µ–≥–æ –Ω–∞—á–∏—Å–ª–µ–Ω–æ, –≤—Å–µ–≥–æ —Å–ø–∏—Å–∞–Ω–æ, –∏—Å—Ç–µ–∫–ª–æ)

---

## –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞

### –°—Ç—Ä–∞–Ω–∏—Ü–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏

**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** –†–∞–∑–¥–µ–ª "–ù–∞—Å—Ç—Ä–æ–π–∫–∏" ‚Üí "–ü—Ä–æ–≥—Ä–∞–º–º–∞ –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏"

**–≠–ª–µ–º–µ–Ω—Ç—ã:**

1. **–ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —Å—Ç–∞—Ç—É—Å–∞ –º–æ–¥—É–ª—è**
   - –í–∫–ª/–í—ã–∫–ª
   - –ü—Ä–∏ –≤—ã–∫–ª—é—á–µ–Ω–∏–∏ —Å–∏—Å—Ç–µ–º–∞ –ø–µ—Ä–µ—Å—Ç–∞–µ—Ç –Ω–∞—á–∏—Å–ª—è—Ç—å –∏ —Ä–∞–∑—Ä–µ—à–∞—Ç—å —Å–ø–∏—Å–∞–Ω–∏–µ –±–æ–Ω—É—Å–æ–≤
   - –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –±–∞–ª–∞–Ω—Å—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è

2. **–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–π –±–ª–æ–∫**
   - –¢–µ–∫—Å—Ç: "–í—Å–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Å–∏—Å—Ç–µ–º—ã (—É—Ä–æ–≤–Ω–∏, —Å—Ä–æ–∫–∏, —Ñ–æ—Ä–º—É–ª—ã –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è) –∑–∞–¥–∞–Ω—ã –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏"
   - –°—Å—ã–ª–∫–∞ –Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:**
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –º–≥–Ω–æ–≤–µ–Ω–Ω–æ –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏
- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—à–Ω–æ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏
- –õ–æ–≥–∏—Ä—É–µ—Ç—Å—è –¥–µ–π—Å—Ç–≤–∏–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞

---

### –ö–∞—Ä—Ç–æ—á–∫–∞ –∫–ª–∏–µ–Ω—Ç–∞ (—Ä–∞–∑–¥–µ–ª "–ë–æ–Ω—É—Å—ã")

**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** –ö–ª–∏–µ–Ω—Ç—ã ‚Üí –î–µ—Ç–∞–ª—å–Ω–∞—è –∫–∞—Ä—Ç–æ—á–∫–∞ –∫–ª–∏–µ–Ω—Ç–∞ ‚Üí –í–∫–ª–∞–¥–∫–∞ "–ë–æ–Ω—É—Å—ã"

**–≠–ª–µ–º–µ–Ω—Ç—ã:**

1. **–û–±—â–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è**
   - –¢–µ–∫—É—â–∏–π –±–∞–ª–∞–Ω—Å –±–æ–Ω—É—Å–æ–≤
   - –¢–µ–∫—É—â–∏–π —É—Ä–æ–≤–µ–Ω—å –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏
   - –î–∞—Ç–∞ –≤—Å—Ç—É–ø–ª–µ–Ω–∏—è –≤ –ø—Ä–æ–≥—Ä–∞–º–º—É
   - –ü—Ä–æ–≥—Ä–µ—Å—Å –¥–æ —Å–ª–µ–¥—É—é—â–µ–≥–æ —É—Ä–æ–≤–Ω—è (—Å—É–º–º–∞ –∏ –ø—Ä–æ—Ü–µ–Ω—Ç)

2. **–ö–Ω–æ–ø–∫–∞ "–ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞ –±–∞–ª–∞–Ω—Å–∞"**
   - –û—Ç–∫—Ä—ã–≤–∞–µ—Ç –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
   - –ü–æ–ª—è:
     - –¢–∏–ø –æ–ø–µ—Ä–∞—Ü–∏–∏ (–Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ/—Å–ø–∏—Å–∞–Ω–∏–µ)
     - –°—É–º–º–∞
     - –ü—Ä–∏—á–∏–Ω–∞ (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ —Ç–µ–∫—Å—Ç–æ–≤–æ–µ –ø–æ–ª–µ)
   - –í–∞–ª–∏–¥–∞—Ü–∏—è: –ø—Ä–∏ —Å–ø–∏—Å–∞–Ω–∏–∏ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ—Å—Ç—å –±–∞–ª–∞–Ω—Å–∞
   - –ü–æ—Å–ª–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –≤ –∫–∞—Ä—Ç–æ—á–∫–µ

3. **–ò—Å—Ç–æ—Ä–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π**
   - –¢–∞–±–ª–∏—Ü–∞ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö 50 —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
   - –ö–æ–ª–æ–Ω–∫–∏: –î–∞—Ç–∞, –¢–∏–ø, –°—É–º–º–∞, –ó–∞–∫–∞–∑ (–µ—Å–ª–∏ –µ—Å—Ç—å), –°—Ç–∞—Ç—É—Å, –°—Ä–æ–∫ –∏—Å—Ç–µ—á–µ–Ω–∏—è
   - –¶–≤–µ—Ç–æ–≤–∞—è –∏–Ω–¥–∏–∫–∞—Ü–∏—è —Ç–∏–ø–æ–≤ (–∑–µ–ª–µ–Ω—ã–π - –Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ, –∫—Ä–∞—Å–Ω—ã–π - —Å–ø–∏—Å–∞–Ω–∏–µ, —Å–µ—Ä—ã–π - –∏—Å—Ç–µ—á–µ–Ω–∏–µ)
   - –§–∏–ª—å—Ç—Ä –ø–æ —Ç–∏–ø—É —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
   - –ö–Ω–æ–ø–∫–∞ "–ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ" –¥–ª—è –ø–µ—Ä–µ—Ö–æ–¥–∞ –∫ –ø–æ–ª–Ω–æ–π –∏—Å—Ç–æ—Ä–∏–∏

4. **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞**
   - –í—Å–µ–≥–æ –Ω–∞—á–∏—Å–ª–µ–Ω–æ (–∑–∞ –≤—Å–µ –≤—Ä–µ–º—è)
   - –í—Å–µ–≥–æ —Å–ø–∏—Å–∞–Ω–æ (–∑–∞ –≤—Å–µ –≤—Ä–µ–º—è)
   - –ò—Å—Ç–µ–∫–ª–æ –±–æ–Ω—É—Å–æ–≤ (–∑–∞ –≤—Å–µ –≤—Ä–µ–º—è)
   - –°—Ä–µ–¥–Ω–∏–π —á–µ–∫ –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ —É—Ä–æ–≤–Ω—è (–∑–∞ 60 –¥–Ω–µ–π)

---

### –ö–∞—Ä—Ç–æ—á–∫–∞ –∑–∞–∫–∞–∑–∞ (–æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –±–æ–Ω—É—Å–æ–≤)

**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** –ó–∞–∫–∞–∑—ã ‚Üí –î–µ—Ç–∞–ª—å–Ω–∞—è –∫–∞—Ä—Ç–æ—á–∫–∞ –∑–∞–∫–∞–∑–∞

**–≠–ª–µ–º–µ–Ω—Ç—ã –≤ –±–ª–æ–∫–µ "–û–ø–ª–∞—Ç–∞":**

1. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ –±–æ–Ω—É—Å–æ–≤**
   - –°—É–º–º–∞ —Å–ø–∏—Å–∞–Ω–Ω—ã—Ö –±–æ–Ω—É—Å–æ–≤
   - –°—Ç–∞—Ç—É—Å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ (pending/completed/cancelled)
   - –°—Å—ã–ª–∫–∞ –Ω–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é –≤ –∏—Å—Ç–æ—Ä–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

2. **–ù–∞—á–∏—Å–ª–µ–Ω–æ –±–æ–Ω—É—Å–æ–≤**
   - –û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è –∑–∞–∫–∞–∑–æ–≤ –≤ —Å—Ç–∞—Ç—É—Å–µ delivered/completed
   - –°—É–º–º–∞ –Ω–∞—á–∏—Å–ª–µ–Ω–Ω—ã—Ö –±–æ–Ω—É—Å–æ–≤
   - –°—Ä–æ–∫ –∏—Å—Ç–µ—á–µ–Ω–∏—è –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è
   - –ü—Ä–æ—Ü–µ–Ω—Ç –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è –∏ —É—Ä–æ–≤–µ–Ω—å –Ω–∞ –º–æ–º–µ–Ω—Ç –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è

3. **–î–µ—Ç–∞–ª–∏ —Ä–∞—Å—á–µ—Ç–∞** (—Ä–∞—Å–∫—Ä—ã–≤–∞–µ–º—ã–π –±–ª–æ–∫)
   - –ë–∞–∑–∞ –¥–ª—è –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è (—Å —Ñ–æ—Ä–º—É–ª–æ–π)
   - –£—Ä–æ–≤–µ–Ω—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–∞ –º–æ–º–µ–Ω—Ç –∑–∞–∫–∞–∑–∞
   - –ü—Ä–æ—Ü–µ–Ω—Ç –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è
   - –ò—Ç–æ–≥–æ–≤–∞—è —Å—É–º–º–∞

**–ò–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã:**
- –ó–µ–ª–µ–Ω–∞—è –≥–∞–ª–æ—á–∫–∞ –µ—Å–ª–∏ –±–æ–Ω—É—Å—ã –Ω–∞—á–∏—Å–ª–µ–Ω—ã
- –û—Ä–∞–Ω–∂–µ–≤—ã–π –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –µ—Å–ª–∏ –∑–∞–∫–∞–∑ –≤ –ø—É—Ç–∏ (–±–æ–Ω—É—Å—ã –Ω–∞—á–∏—Å–ª—è—Ç—Å—è –ø—Ä–∏ –¥–æ—Å—Ç–∞–≤–∫–µ)
- –ö—Ä–∞—Å–Ω—ã–π –∫—Ä–µ—Å—Ç–∏–∫ –µ—Å–ª–∏ –∑–∞–∫–∞–∑ –æ—Ç–º–µ–Ω–µ–Ω (–±–æ–Ω—É—Å—ã –Ω–µ –Ω–∞—á–∏—Å–ª–µ–Ω—ã –∏–ª–∏ –≤–æ–∑–≤—Ä–∞—â–µ–Ω—ã)

---

## –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∫–ª–∏–µ–Ω—Ç–∞

### –°—Ç—Ä–∞–Ω–∏—Ü–∞ "–ë–æ–Ω—É—Å—ã –∏ —É—Ä–æ–≤–Ω–∏"

**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é ‚Üí "–ë–æ–Ω—É—Å—ã"

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã:**

#### –°–µ–∫—Ü–∏—è 1: –ë–∞–ª–∞–Ω—Å –±–æ–Ω—É—Å–æ–≤

**–≠–ª–µ–º–µ–Ω—Ç—ã:**
- –ö—Ä—É–ø–Ω—ã–π —Ç–µ–∫—Å—Ç —Å —Ç–µ–∫—É—â–∏–º –±–∞–ª–∞–Ω—Å–æ–º
- –ü–æ—è—Å–Ω–µ–Ω–∏–µ "1 –±–æ–Ω—É—Å = 1 —Ä—É–±–ª—å"
- –ò–∫–æ–Ω–∫–∞ –∫–æ–ø–∏–ª–∫–∏ –∏–ª–∏ –º–æ–Ω–µ—Ç

**–ü—Ä–∏–º–µ—Ä:**
```
üí∞ –í–∞—à –±–∞–ª–∞–Ω—Å
1,500 –±–æ–Ω—É—Å–æ–≤ = 1,500‚ÇΩ
```

---

#### –°–µ–∫—Ü–∏—è 2: –¢–µ–∫—É—â–∏–π —É—Ä–æ–≤–µ–Ω—å –∏ –ø—Ä–æ–≥—Ä–µ—Å—Å

**–≠–ª–µ–º–µ–Ω—Ç—ã:**

1. **–ö–∞—Ä—Ç–æ—á–∫–∞ —Ç–µ–∫—É—â–µ–≥–æ —É—Ä–æ–≤–Ω—è**
   - –ù–∞–∑–≤–∞–Ω–∏–µ —É—Ä–æ–≤–Ω—è
   - –ë–µ–π–¥–∂ "–í–∞—à —É—Ä–æ–≤–µ–Ω—å"
   - –ò–∫–æ–Ω–∫–∞ —É—Ä–æ–≤–Ω—è
   - –£—Å–ª–æ–≤–∏—è —É—Ä–æ–≤–Ω—è:
     - –ü—Ä–æ—Ü–µ–Ω—Ç –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è
     - –ú–∞–∫—Å–∏–º—É–º —Å–ø–∏—Å–∞–Ω–∏—è

2. **–ü—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä –¥–æ —Å–ª–µ–¥—É—é—â–µ–≥–æ —É—Ä–æ–≤–Ω—è**
   - –í–∏–∑—É–∞–ª—å–Ω–∞—è –ø–æ–ª–æ—Å–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
   - –¢–µ–∫—É—â–∞—è —Å—É–º–º–∞ –∑–∞–∫–∞–∑–æ–≤ / –ü–æ—Ä–æ–≥ —Å–ª–µ–¥—É—é—â–µ–≥–æ —É—Ä–æ–≤–Ω—è
   - –¢–µ–∫—Å—Ç "–î–æ –ó–æ–ª–æ—Ç–∞: 7,500‚ÇΩ"
   - –ü–æ—è—Å–Ω–µ–Ω–∏–µ "–ó–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 60 –¥–Ω–µ–π"

**–ü—Ä–∏–º–µ—Ä:**
```
ü•à –°–µ—Ä–µ–±—Ä–æ - –≤–∞—à —É—Ä–æ–≤–µ–Ω—å
–ù–∞—á–∏—Å–ª–µ–Ω–∏–µ: 5%
–ú–∞–∫—Å–∏–º—É–º —Å–ø–∏—Å–∞–Ω–∏—è: 25%

[‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñë‚ñë] 12,500‚ÇΩ / 20,000‚ÇΩ
–î–æ —É—Ä–æ–≤–Ω—è –ó–æ–ª–æ—Ç–æ –æ—Å—Ç–∞–ª–æ—Å—å: 7,500‚ÇΩ
```

---

#### –°–µ–∫—Ü–∏—è 3: –í—Å–µ —É—Ä–æ–≤–Ω–∏ (–∫–∞—Ä—Ç–æ—á–∫–∏)

**–≠–ª–µ–º–µ–Ω—Ç—ã:**
- 3 –∫–∞—Ä—Ç–æ—á–∫–∏ —É—Ä–æ–≤–Ω–µ–π (–ë—Ä–æ–Ω–∑–∞, –°–µ—Ä–µ–±—Ä–æ, –ó–æ–ª–æ—Ç–æ)
- –î–ª—è –∫–∞–∂–¥–æ–≥–æ:
  - –ù–∞–∑–≤–∞–Ω–∏–µ
  - –ò–∫–æ–Ω–∫–∞
  - –ü–æ—Ä–æ–≥ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è
  - –ü—Ä–æ—Ü–µ–Ω—Ç –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è
  - –ú–∞–∫—Å–∏–º—É–º —Å–ø–∏—Å–∞–Ω–∏—è

**–ò–Ω–¥–∏–∫–∞—Ü–∏—è:**
- –¢–µ–∫—É—â–∏–π —É—Ä–æ–≤–µ–Ω—å: –≤—ã–¥–µ–ª–µ–Ω —Ü–≤–µ—Ç–æ–º, –±–µ–π–¥–∂ "–í–∞—à —É—Ä–æ–≤–µ–Ω—å"
- –î–æ—Å—Ç–∏–≥–Ω—É—Ç—ã–µ —Ä–∞–Ω–µ–µ: –≥–∞–ª–æ—á–∫–∞
- –ë—É–¥—É—â–∏–µ: —Å–µ—Ä—ã–π —Ü–≤–µ—Ç, —Ç–µ–∫—Å—Ç "–î–æ—Å—Ç—É–ø–µ–Ω —Å X‚ÇΩ"

---

#### –°–µ–∫—Ü–∏—è 4: –°–∫–æ—Ä–æ —Å–≥–æ—Ä—è—Ç

**–≠–ª–µ–º–µ–Ω—Ç—ã:**

**–ï—Å–ª–∏ –µ—Å—Ç—å –∏—Å—Ç–µ–∫–∞—é—â–∏–µ –±–æ–Ω—É—Å—ã (—Å—Ä–æ–∫ < 14 –¥–Ω–µ–π):**
- –ò–∫–æ–Ω–∫–∞ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è (–∂–µ–ª—Ç–∞—è/–æ—Ä–∞–Ω–∂–µ–≤–∞—è)
- –¢–µ–∫—Å—Ç: "200 –±–æ–Ω—É—Å–æ–≤ —Å–≥–æ—Ä—è—Ç —á–µ—Ä–µ–∑ 12 –¥–Ω–µ–π"
- –ö–Ω–æ–ø–∫–∞ "–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å"

**–ï—Å–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ –∏—Å—Ç–µ–∫–∞—é—â–∏—Ö:**
- –°–ø–∏—Å–æ–∫ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
- –î–ª—è –∫–∞–∂–¥–æ–π: –°—É–º–º–∞ | –î–∞—Ç–∞ –∏—Å—Ç–µ—á–µ–Ω–∏—è | –î–Ω–µ–π –æ—Å—Ç–∞–ª–æ—Å—å
- –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ –¥–∞—Ç–µ (–±–ª–∏–∂–∞–π—à–∏–µ –ø–µ—Ä–≤—ã–µ)

**–ï—Å–ª–∏ –Ω–µ—Ç –∏—Å—Ç–µ–∫–∞—é—â–∏—Ö:**
- –ù–µ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è

---

#### –°–µ–∫—Ü–∏—è 5: –ò—Å—Ç–æ—Ä–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π

**–≠–ª–µ–º–µ–Ω—Ç—ã:**

**–¢–∞–±–ª–∏—Ü–∞/—Å–ø–∏—Å–æ–∫ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π:**

–î–ª—è –∫–∞–∂–¥–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏:
- –î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è
- –ò–∫–æ–Ω–∫–∞ —Ç–∏–ø–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
- –¢–∏–ø –æ–ø–µ—Ä–∞—Ü–∏–∏ (—Ç–µ–∫—Å—Ç):
  - üü¢ –ù–∞—á–∏—Å–ª–µ–Ω–æ
  - üî¥ –°–ø–∏—Å–∞–Ω–æ
  - ‚ö´ –°–≥–æ—Ä–µ–ª–∏ (—Å–µ—Ä—ã–π/—Ç–µ–º–Ω—ã–π, –ø–æ–ª—É–ø—Ä–æ–∑—Ä–∞—á–Ω—ã–π)
  - üéÅ –ë–æ–Ω—É—Å –∑–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é
  - üéÇ –ë–æ–Ω—É—Å –∫–æ –¥–Ω—é —Ä–æ–∂–¥–µ–Ω–∏—è
  - ‚öôÔ∏è –ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞
- –°—É–º–º–∞ (—Å —Ü–≤–µ—Ç–æ–º –∏ –∑–Ω–∞–∫–æ–º)
- –ù–æ–º–µ—Ä –∑–∞–∫–∞–∑–∞ (—Å—Å—ã–ª–∫–∞, –µ—Å–ª–∏ –µ—Å—Ç—å)
- –°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è (–¥–ª—è –Ω–∞—á–∏—Å–ª–µ–Ω–∏–π):
  - –î–ª—è –∞–∫—Ç–∏–≤–Ω—ã—Ö: "–ò—Å—Ç–µ–∫–∞–µ—Ç: 15.03.2026"
  - –î–ª—è –∏—Å—Ç–µ–∫—à–∏—Ö: "–ò—Å—Ç–µ–∫" (—Å–µ—Ä—ã–º)

**–í–∏–∑—É–∞–ª—å–Ω–æ–µ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ —Å–≥–æ—Ä–µ–≤—à–∏—Ö:**
- –ö–∞—Ä—Ç–æ—á–∫–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ —Å –ø–æ–Ω–∏–∂–µ–Ω–Ω–æ–π –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å—é (opacity: 0.5)
- –°–µ—Ä—ã–π —Ñ–æ–Ω
- –ò–∫–æ–Ω–∫–∞ ‚ö´ (—á–µ—Ä–Ω–∞—è/—Ç–µ–º–Ω–∞—è)
- –¢–µ–∫—Å—Ç —Å–µ—Ä—ã–º —Ü–≤–µ—Ç–æ–º
- –°—Ä–æ–∫: "–ò—Å—Ç–µ–∫–ª–∏: 15.01.2026"

**–ü–∞–≥–∏–Ω–∞—Ü–∏—è:**
- –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –ø–æ 20 –∑–∞–ø–∏—Å–µ–π –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É
- –ö–Ω–æ–ø–∫–∞ "–ó–∞–≥—Ä—É–∑–∏—Ç—å –µ—â–µ" –¥–ª—è –ø–æ–¥–≥—Ä—É–∑–∫–∏ —Å–ª–µ–¥—É—é—â–∏—Ö 20

**–§–∏–ª—å—Ç—Ä—ã (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ –¥–ª—è –±—É–¥—É—â–∏—Ö –≤–µ—Ä—Å–∏–π):**
- –ü–æ —Ç–∏–ø—É —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
- –ü–æ –ø–µ—Ä–∏–æ–¥—É

---

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –∫–æ—Ä–∑–∏–Ω–æ–π

**–í–∞–∂–Ω–æ:** –≠—Ç–æ—Ç —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª —É–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω, –Ω–µ –º–µ–Ω—è–µ–º –ª–æ–≥–∏–∫—É —Ä–∞–±–æ—Ç—ã.

**–≠–ª–µ–º–µ–Ω—Ç—ã –≤ –∫–æ—Ä–∑–∏–Ω–µ:**

1. **–û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞**
   - "–£ –≤–∞—Å 1,500 –±–æ–Ω—É—Å–æ–≤"
   - –°—Å—ã–ª–∫–∞ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É "–ë–æ–Ω—É—Å—ã –∏ —É—Ä–æ–≤–Ω–∏"

2. **–°–ª–∞–π–¥–µ—Ä —Å–ø–∏—Å–∞–Ω–∏—è –±–æ–Ω—É—Å–æ–≤**
   - –ú–∏–Ω–∏–º—É–º: 0
   - –ú–∞–∫—Å–∏–º—É–º: —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ API (endpoint calculate-max-spend)
   - –®–∞–≥: 1 —Ä—É–±–ª—å
   - Live –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏—Ç–æ–≥–æ–≤–æ–π —Å—É–º–º—ã –∑–∞–∫–∞–∑–∞ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏

3. **–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –Ω–∞—á–∏—Å–ª–µ–Ω–∏–∏**
   - "–ü–æ—Å–ª–µ –∑–∞–∫–∞–∑–∞ –≤–∞–º –Ω–∞—á–∏—Å–ª–∏—Ç—Å—è +XX‚ÇΩ"
   - –û–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å–ª–∞–π–¥–µ—Ä–∞ (–ø–µ—Ä–µ—Å—á–µ—Ç –æ—Ç –Ω–æ–≤–æ–π —Å—É–º–º—ã)

4. **–í–∞–ª–∏–¥–∞—Ü–∏—è**
   - –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ —Å–ª–∞–π–¥–µ—Ä–∞ –µ—Å–ª–∏ –±–∞–ª–∞–Ω—Å = 0
   - –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –∫–Ω–æ–ø–∫–∏ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è –µ—Å–ª–∏ –∑–∞–ø—Ä–æ—à–µ–Ω–æ –±–æ–ª—å—à–µ –º–∞–∫—Å–∏–º—É–º–∞
   - –°–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ–º –±–∞–ª–∞–Ω—Å–µ

---

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

**–ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ:**
- –ë–∞–ª–∞–Ω—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: Redis, TTL 60 —Å–µ–∫—É–Ω–¥
  - –ö–ª—é—á: `loyalty:balance:{userId}`
  - –ò–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è: –ø—Ä–∏ –ª—é–±–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –º–æ–¥—É–ª—è: Redis, TTL 10 –º–∏–Ω—É—Ç
  - –ö–ª—é—á: `loyalty:settings`
  - –ò–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è: –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫
- –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —É—Ä–æ–≤–Ω–∏: Redis, –±–µ–∑ TTL (–ø–æ—Å—Ç–æ—è–Ω–Ω–æ)
  - –ö–ª—é—á: `loyalty:levels`
  - –ó–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –æ–¥–∏–Ω —Ä–∞–∑ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ

**–ò–Ω–¥–µ–∫—Å—ã –ë–î:**
- –í—Å–µ –≤–Ω–µ—à–Ω–∏–µ –∫–ª—é—á–∏ –ø—Ä–æ–∏–Ω–¥–µ–∫—Å–∏—Ä–æ–≤–∞–Ω—ã
- Composite –∏–Ω–¥–µ–∫—Å—ã –¥–ª—è —á–∞—Å—Ç—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤:
  - `(user_id, status, created_at)` –Ω–∞ orders
  - `(user_id, type, created_at)` –Ω–∞ loyalty_transactions
  - `(type, status, expires_at)` –Ω–∞ loyalty_transactions
- –ò–Ω–¥–µ–∫—Å—ã –Ω–∞ –ø–æ–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –∏ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏

**–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤:**
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ JOIN –≤–º–µ—Å—Ç–æ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- –ê–≥—Ä–µ–≥–∞—Ü–∏—è –Ω–∞ —É—Ä–æ–≤–Ω–µ –ë–î (SUM, COUNT)
- –ü–∞–≥–∏–Ω–∞—Ü–∏—è –¥–ª—è –±–æ–ª—å—à–∏—Ö —Å–ø–∏—Å–∫–æ–≤ (history)
- SELECT —Ç–æ–ª—å–∫–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö –ø–æ–ª–µ–π

---

### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

**–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è:**
- JWT —Ç–æ–∫–µ–Ω—ã –¥–ª—è –∫–ª–∏–µ–Ω—Ç–æ–≤
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–æ–ª–µ–π –¥–ª—è –∞–¥–º–∏–Ω—Å–∫–∏—Ö —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤
- Rate limiting –Ω–∞ API:
  - –ö–ª–∏–µ–Ω—Ç—Å–∫–∏–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã: 100 –∑–∞–ø—Ä–æ—Å–æ–≤/–º–∏–Ω—É—Ç—É
  - –ê–¥–º–∏–Ω—Å–∫–∏–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã: 200 –∑–∞–ø—Ä–æ—Å–æ–≤/–º–∏–Ω—É—Ç—É

**–í–∞–ª–∏–¥–∞—Ü–∏—è:**
- –í—Å–µ –≤—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤–∞–ª–∏–¥–∏—Ä—É—é—Ç—Å—è –Ω–∞ backend
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∏–∞–ø–∞–∑–æ–Ω–æ–≤ –¥–ª—è —á–∏—Å–ª–æ–≤—ã—Ö –ø–æ–ª–µ–π
- –ó–∞—â–∏—Ç–∞ –æ—Ç SQL injection (–ø–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã)
- –ó–∞—â–∏—Ç–∞ –æ—Ç XSS (—ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—ã–≤–æ–¥–∞)
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞ –∫ –¥–∞–Ω–Ω—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –ë–î:**
- –í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å –±–æ–Ω—É—Å–∞–º–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –≤ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è—Ö
- –£—Ä–æ–≤–µ–Ω—å –∏–∑–æ–ª—è—Ü–∏–∏: READ COMMITTED –¥–ª—è –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞ –æ–ø–µ—Ä–∞—Ü–∏–π
- SERIALIZABLE –¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π (–∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞ –±–∞–ª–∞–Ω—Å–∞)
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ SELECT ... FOR UPDATE –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è race conditions

**–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:**
- –í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–æ–≤ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –≤ loyalty_logs
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–æ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ (–æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–µ –±–∞–ª–∞–Ω—Å—ã, –ø–æ–ø—ã—Ç–∫–∏ –ø—Ä–µ–≤—ã—Å–∏—Ç—å –ª–∏–º–∏—Ç—ã)
- –ó–∞–ø–∏—Å—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –≤—ã–ø–æ–ª–Ω–∏–≤—à–µ–≥–æ –¥–µ–π—Å—Ç–≤–∏–µ (–¥–ª—è adjustment)
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ä—ã—Ö –∏ –Ω–æ–≤—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö

---

### –ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å

**–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫:**
- Try-catch –¥–ª—è –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π —Å –ë–î
- –û—Ç–∫–∞—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö
- –ò–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤

**–ó–∞—â–∏—Ç–∞ –æ—Ç race conditions:**
- –§–ª–∞–≥ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ `bonus_earn_locked` –≤ –∑–∞–∫–∞–∑–∞—Ö
- Atomic –æ–ø–µ—Ä–∞—Ü–∏–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è (UPDATE ... WHERE)
- –ü—Ä–æ–≤–µ—Ä–∫–∞ affected_rows –ø–æ—Å–ª–µ UPDATE
- Retry –ª–æ–≥–∏–∫–∞ –ø—Ä–∏ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞—Ö

**–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:**
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥—É–±–ª–µ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –≤ loyalty_logs
- –ê–ª–µ—Ä—Ç—ã –ø—Ä–∏ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–∏ –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã—Ö –±–∞–ª–∞–Ω—Å–æ–≤
- –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏–π –±–∞–ª–∞–Ω—Å–∞ (—Å—É–º–º–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π vs loyalty_balance)
- –ú–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ API —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤

**Cron –∑–∞–¥–∞—á–∏:**
- –ò—Å—Ç–µ—á–µ–Ω–∏–µ –±–æ–Ω—É—Å–æ–≤: –µ–∂–µ–¥–Ω–µ–≤–Ω–æ –≤ 04:00
  - Timeout: 30 –º–∏–Ω—É—Ç
  - Batch –æ–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ 1000 –∑–∞–ø–∏—Å–µ–π
  - –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –î–† –±–æ–Ω—É—Å–æ–≤: –µ–∂–µ–¥–Ω–µ–≤–Ω–æ –≤ 02:00
  - Timeout: 15 –º–∏–Ω—É—Ç
  - –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤
  - –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞—á–∏—Å–ª–µ–Ω–∏–π

---
### –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å

**–ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ:**
- Redis –¥–ª—è —á–∞—Å—Ç–æ –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ–º—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- Cache warming –¥–ª—è –±–∞–ª–∞–Ω—Å–æ–≤ –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –ü—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫–∞ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —É—Ä–æ–≤–Ω–µ–π

**–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è:**
- Batch –æ–ø–µ—Ä–∞—Ü–∏–∏ –¥–ª—è cron –∑–∞–¥–∞—á (–ø–æ 1000 –∑–∞–ø–∏—Å–µ–π)
- –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏ –≥–¥–µ –≤–æ–∑–º–æ–∂–Ω–æ (—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è)
- –õ–µ–Ω–∏–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –∏—Å—Ç–æ—Ä–∏–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π (–ø–∞–≥–∏–Ω–∞—Ü–∏—è)

**–ê—Ä—Ö–∏–≤–∞—Ü–∏—è (–¥–ª—è –±—É–¥—É—â–∏—Ö –≤–µ—Ä—Å–∏–π):**
- –ü–∞—Ä—Ç–∏—Ü–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã loyalty_transactions –ø–æ –º–µ—Å—è—Ü–∞–º
- –ê—Ä—Ö–∏–≤–∞—Ü–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π —Å—Ç–∞—Ä—à–µ 1 –≥–æ–¥–∞ –≤ –æ—Ç–¥–µ–ª—å–Ω—É—é —Ç–∞–±–ª–∏—Ü—É
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–∞ –∫ –∞—Ä—Ö–∏–≤–Ω—ã–º –¥–∞–Ω–Ω—ã–º —á–µ—Ä–µ–∑ API

---

## –ú–∏–≥—Ä–∞—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

**–®–∞–≥ 1:** –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã loyalty_levels
- –°–æ–∑–¥–∞–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Ç–∞–±–ª–∏—Ü—ã
- –í—Å—Ç–∞–≤–∫–∞ 3 —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —É—Ä–æ–≤–Ω–µ–π
- –°–æ–∑–¥–∞–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–æ–≤

**–®–∞–≥ 2:** –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã users
- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—è current_loyalty_level_id
- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—è loyalty_balance
- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—è loyalty_joined_at
- –°–æ–∑–¥–∞–Ω–∏–µ –≤–Ω–µ—à–Ω–∏—Ö –∫–ª—é—á–µ–π –∏ –∏–Ω–¥–µ–∫—Å–æ–≤

**–®–∞–≥ 3:** –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã orders
- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—è bonus_spent
- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—è bonus_earn_amount
- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—è bonus_earn_locked
- –°–æ–∑–¥–∞–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–æ–≤

**–®–∞–≥ 4:** –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã loyalty_transactions
- –°–æ–∑–¥–∞–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Ç–∞–±–ª–∏—Ü—ã
- –°–æ–∑–¥–∞–Ω–∏–µ –≤—Å–µ—Ö –∏–Ω–¥–µ–∫—Å–æ–≤
- –°–æ–∑–¥–∞–Ω–∏–µ –≤–Ω–µ—à–Ω–∏—Ö –∫–ª—é—á–µ–π

**–®–∞–≥ 5:** –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã user_loyalty_levels
- –°–æ–∑–¥–∞–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Ç–∞–±–ª–∏—Ü—ã
- –°–æ–∑–¥–∞–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–æ–≤ –∏ –≤–Ω–µ—à–Ω–∏—Ö –∫–ª—é—á–µ–π

**–®–∞–≥ 6:** –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã loyalty_logs
- –°–æ–∑–¥–∞–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Ç–∞–±–ª–∏—Ü—ã
- –°–æ–∑–¥–∞–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–æ–≤

**–®–∞–≥ 7:** –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –£—Å—Ç–∞–Ω–æ–≤–∫–∞ current_loyalty_level_id = 1 (–ë—Ä–æ–Ω–∑–∞) –¥–ª—è –≤—Å–µ—Ö
- –£—Å—Ç–∞–Ω–æ–≤–∫–∞ loyalty_balance = 0.00
- –£—Å—Ç–∞–Ω–æ–≤–∫–∞ loyalty_joined_at = NOW()

---

## –≠—Ç–∞–ø—ã —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

### –≠—Ç–∞–ø 1: Backend (–±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –∏ API)

**–°—Ä–æ–∫:** 18 —á–∞—Å–æ–≤

**–ó–∞–¥–∞—á–∏:**

1. **–ú–∏–≥—Ä–∞—Ü–∏–∏ –ë–î** (2 —á–∞—Å–∞)
   - –°–æ–∑–¥–∞–Ω–∏–µ –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –º–∏–≥—Ä–∞—Ü–∏–π
   - –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –Ω–∞ dev –æ–∫—Ä—É–∂–µ–Ω–∏–∏
   - –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö

2. **–ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö** (3 —á–∞—Å–∞)
   - –°–æ–∑–¥–∞–Ω–∏–µ –º–æ–¥–µ–ª–µ–π –¥–ª—è –≤—Å–µ—Ö —Ç–∞–±–ª–∏—Ü
   - –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å–≤—è–∑–µ–π –º–µ–∂–¥—É –º–æ–¥–µ–ª—è–º–∏
   - –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–æ–ª–µ–π

3. **–ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞** (8 —á–∞—Å–æ–≤)
   - –ü—Ä–æ—Ü–µ—Å—Å –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è —Å —Ñ–∏–∫—Å–∞—Ü–∏–µ–π —Å—É–º–º—ã
   - –õ–æ–≥–∏–∫–∞ —Å–º–µ–Ω—ã —Å—Ç–∞—Ç—É—Å–æ–≤ –∑–∞–∫–∞–∑–∞ (–æ—Ç–∫–∞—Ç—ã, –ø–æ–≤—Ç–æ—Ä—ã)
   - –°–ø–∏—Å–∞–Ω–∏–µ –ø–æ FIFO
   - –ó–∞—â–∏—Ç–∞ –æ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è
   - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —É—Ä–æ–≤–Ω—è–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

4. **API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã** (4 —á–∞—Å–∞)
   - –ö–ª–∏–µ–Ω—Ç—Å–∫–∏–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã (balance, calculate, history, levels)
   - –ê–¥–º–∏–Ω—Å–∫–∏–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã (status, toggle, adjust, user info)
   - –í–∞–ª–∏–¥–∞—Ü–∏—è –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

5. **Cron –∑–∞–¥–∞—á–∏** (3 —á–∞—Å–∞)
   - –ò—Å—Ç–µ—á–µ–Ω–∏–µ –±–æ–Ω—É—Å–æ–≤
   - –û–±—Ä–∞–±–æ—Ç–∫–∞ –î–† –±–æ–Ω—É—Å–æ–≤
   - –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è

---

### –≠—Ç–∞–ø 2: –ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å

**–°—Ä–æ–∫:** 6 —á–∞—Å–æ–≤

**–ó–∞–¥–∞—á–∏:**

1. **–°—Ç—Ä–∞–Ω–∏—Ü–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫** (1 —á–∞—Å)
   - –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å –≤–∫–ª/–≤—ã–∫–ª –º–æ–¥—É–ª—è
   - –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–π –±–ª–æ–∫
   - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫

2. **–ö–∞—Ä—Ç–æ—á–∫–∞ –∫–ª–∏–µ–Ω—Ç–∞** (3 —á–∞—Å–∞)
   - –†–∞–∑–¥–µ–ª "–ë–æ–Ω—É—Å—ã"
   - –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞ –∏ —É—Ä–æ–≤–Ω—è
   - –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∏
   - –ò—Å—Ç–æ—Ä–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
   - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

3. **–ö–∞—Ä—Ç–æ—á–∫–∞ –∑–∞–∫–∞–∑–∞** (2 —á–∞—Å–∞)
   - –ë–ª–æ–∫ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –±–æ–Ω—É—Å–∞—Ö
   - –î–µ—Ç–∞–ª–∏ —Ä–∞—Å—á–µ—Ç–∞
   - –°—Ç–∞—Ç—É—Å –æ–ø–µ—Ä–∞—Ü–∏–π

---

### –≠—Ç–∞–ø 3: –ö–ª–∏–µ–Ω—Ç—Å–∫–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

**–ó–∞–¥–∞—á–∏:**

1. **–°—Ç—Ä–∞–Ω–∏—Ü–∞ "–ë–æ–Ω—É—Å—ã –∏ —É—Ä–æ–≤–Ω–∏"** (6 —á–∞—Å–æ–≤)
   - –í—Å–µ 5 —Å–µ–∫—Ü–∏–π —Å–æ–≥–ª–∞—Å–Ω–æ –º–∞–∫–µ—Ç—É
   - –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π –¥–∏–∑–∞–π–Ω
   - –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
   - –ò—Å—Ç–æ—Ä–∏—è —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º —Å–≥–æ—Ä–µ–≤—à–∏—Ö
   - –°–µ–∫—Ü–∏—è "–°–∫–æ—Ä–æ —Å–≥–æ—Ä—è—Ç"

2. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –∫–æ—Ä–∑–∏–Ω–æ–π** (3 —á–∞—Å–∞)
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞
   - –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ API –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ –º–∞–∫—Å–∏–º—É–º–∞
   - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ª–æ–≥–∏–∫–∏ –ø–µ—Ä–µ—Å—á–µ—Ç–∞ –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è

---
## –ü—Ä–∏–æ—Ä–∏—Ç–∏–∑–∞—Ü–∏—è –∑–∞–¥–∞—á

### –ö—Ä–∏—Ç–∏—á–Ω—ã–µ (–Ω–µ–æ–±—Ö–æ–¥–∏–º—ã –¥–ª—è –∑–∞–ø—É—Å–∫–∞)

1. –ú–∏–≥—Ä–∞—Ü–∏–∏ –ë–î –∏ –º–æ–¥–µ–ª–∏
2. –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è/—Å–ø–∏—Å–∞–Ω–∏—è
3. API –¥–ª—è –∫–ª–∏–µ–Ω—Ç–∞ (balance, calculate, history)
4. –°—Ç—Ä–∞–Ω–∏—Ü–∞ "–ë–æ–Ω—É—Å—ã –∏ —É—Ä–æ–≤–Ω–∏" (–∫–ª–∏–µ–Ω—Ç)
5. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –∫–æ—Ä–∑–∏–Ω–æ–π
6. Cron –∑–∞–¥–∞—á–∞ –∏—Å—Ç–µ—á–µ–Ω–∏—è –±–æ–Ω—É—Å–æ–≤

### –í–∞–∂–Ω—ã–µ (–Ω—É–∂–Ω—ã –≤ –ø–µ—Ä–≤—ã–µ –¥–Ω–∏)

7. –ö–∞—Ä—Ç–æ—á–∫–∞ –∫–ª–∏–µ–Ω—Ç–∞ –≤ –∞–¥–º–∏–Ω–∫–µ
8. API –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∏ –±–∞–ª–∞–Ω—Å–∞
9. Cron –∑–∞–¥–∞—á–∞ –î–† –±–æ–Ω—É—Å–æ–≤
10. –ö–∞—Ä—Ç–æ—á–∫–∞ –∑–∞–∫–∞–∑–∞ —Å –±–æ–Ω—É—Å–∞–º–∏

### –ñ–µ–ª–∞—Ç–µ–ª—å–Ω—ã–µ (–º–æ–∂–Ω–æ –æ—Ç–ª–æ–∂–∏—Ç—å)

11. –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≤ –∞–¥–º–∏–Ω–∫–µ
12. –§–∏–ª—å—Ç—Ä—ã –≤ –∏—Å—Ç–æ—Ä–∏–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
13. –î–µ—Ç–∞–ª—å–Ω—ã–µ –ª–æ–≥–∏ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
14. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

---

## –í–æ–∑–º–æ–∂–Ω—ã–µ —Ä–∏—Å–∫–∏ –∏ —Ä–µ—à–µ–Ω–∏—è

### –†–∏—Å–∫ 1: –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è

**–ü—Ä–æ–±–ª–µ–º–∞:** –ü—Ä–∏ –Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω–æ–π —Å–µ—Ç–∏ –∏–ª–∏ –æ—à–∏–±–∫–∞—Ö –≤–æ–∑–º–æ–∂–Ω–æ –ø–æ–≤—Ç–æ—Ä–Ω–æ–µ –Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ –±–æ–Ω—É—Å–æ–≤ –∑–∞ –æ–¥–∏–Ω –∑–∞–∫–∞–∑.

**–†–µ—à–µ–Ω–∏–µ:**
- –§–ª–∞–≥ `bonus_earn_locked` –±–ª–æ–∫–∏—Ä—É–µ—Ç –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è
- –ê—Ç–æ–º–∞—Ä–Ω–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ —Ñ–ª–∞–≥–∞
- –ü—Ä–æ–≤–µ—Ä–∫–∞ affected_rows
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–ø—ã—Ç–æ–∫ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è

---

### –†–∏—Å–∫ 2: Race condition –ø—Ä–∏ —Å–ø–∏—Å–∞–Ω–∏–∏

**–ü—Ä–æ–±–ª–µ–º–∞:** –î–≤–∞ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –∑–∞–∫–∞–∑–∞ –º–æ–≥—É—Ç —Å–ø–∏—Å–∞—Ç—å –±–æ–ª—å—à–µ –±–æ–Ω—É—Å–æ–≤, —á–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ –Ω–∞ –±–∞–ª–∞–Ω—Å–µ.

**–†–µ—à–µ–Ω–∏–µ:**
- –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –ë–î —Å —É—Ä–æ–≤–Ω–µ–º –∏–∑–æ–ª—è—Ü–∏–∏ SERIALIZABLE
- SELECT ... FOR UPDATE –ø—Ä–∏ —á—Ç–µ–Ω–∏–∏ –±–∞–ª–∞–Ω—Å–∞
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–ª–∞–Ω—Å–∞ –ø–µ—Ä–µ–¥ –∫–∞–∂–¥—ã–º —Å–ø–∏—Å–∞–Ω–∏–µ–º
- –û—Ç–∫–∞—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ–º –±–∞–ª–∞–Ω—Å–µ

---

### –†–∏—Å–∫ 3: –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å cron –∑–∞–¥–∞—á

**–ü—Ä–æ–±–ª–µ–º–∞:** –ü—Ä–∏ –±–æ–ª—å—à–æ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π cron –∑–∞–¥–∞—á–∏ –º–æ–≥—É—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è –¥–æ–ª–≥–æ.

**–†–µ—à–µ–Ω–∏–µ:**
- Batch –æ–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ 1000 –∑–∞–ø–∏—Å–µ–π
- Timeout –Ω–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
- –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã —Å –∏–Ω–¥–µ–∫—Å–∞–º–∏

---

### –†–∏—Å–∫ 4: –ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –±–∞–ª–∞–Ω—Å–∞ –∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π

**–ü—Ä–æ–±–ª–µ–º–∞:** –ò–∑-–∑–∞ –æ—à–∏–±–æ–∫ –±–∞–ª–∞–Ω—Å –º–æ–∂–µ—Ç –Ω–µ —Å–æ–≤–ø–∞–¥–∞—Ç—å —Å —Å—É–º–º–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π.

**–†–µ—à–µ–Ω–∏–µ:**
- –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ (–º–æ–∂–Ω–æ –∑–∞–ø—É—Å–∫–∞—Ç—å –≤—Ä—É—á–Ω—É—é)
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π –±–∞–ª–∞–Ω—Å–∞
- –ê–ª–µ—Ä—Ç—ã –ø—Ä–∏ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–∏ —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏–π
- –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è –ø–µ—Ä–µ—Å—á–µ—Ç–∞ –±–∞–ª–∞–Ω—Å–∞ –ø–æ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è–º
