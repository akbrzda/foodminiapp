# Roadmap разработки системы онлайн-заказа еды

## Этап 0. Подготовка инфраструктуры

### 0.1 Настройка окружения разработки
- Создание Docker Compose конфигурации для локальной разработки
- Настройка MySQL контейнера с PostGIS расширением
- Настройка Redis контейнера
- Создание базовой структуры проекта

### 0.2 Инициализация проектов
- Инициализация Backend проекта (Node.js + Express)
- Инициализация Telegram Mini App проекта (Vue.js + Pinia)
- Инициализация Admin Panel проекта (Vue.js + Pinia)
- Настройка Shadcn UI для фронтенд проектов

---

## Этап 1. Backend: Базовая архитектура

### 1.1 Структура базы данных
- Проектирование схемы БД
- Создание таблиц для пользователей
- Создание таблиц для заказов
- Создание таблиц для меню (категории, позиции, модификаторы)
- Создание таблиц для городов и филиалов
- Создание таблиц для адресов доставки
- Создание таблиц для бонусной программы
- Создание таблиц для полигонов доставки (PostGIS)
- Создание таблиц для очереди синхронизации
- Создание таблиц для логирования

### 1.2 Базовый Express сервер
- Настройка Express приложения
- Настройка подключения к MySQL
- Настройка подключения к Redis
- Создание базовой структуры роутеров
- Настройка middleware для обработки ошибок
- Настройка CORS

### 1.3 Система аутентификации
- Реализация middleware для проверки Telegram данных
- Создание эндпоинта авторизации через Telegram
- Генерация и валидация JWT токенов
- Middleware для защиты приватных эндпоинтов

---

## Этап 2. Backend: Управление пользователями

### 2.1 API пользователей
- Эндпоинт регистрации/получения пользователя по номеру телефона
- Эндпоинт получения профиля пользователя
- Эндпоинт обновления данных пользователя
- Эндпоинт управления адресами доставки

### 2.2 Система ролей и доступов
- Реализация ролевой модели (Администратор, Менеджер, CEO)
- Middleware для проверки прав доступа
- Привязка пользователей к городам

---

## Этап 3. Backend: Справочники

### 3.1 API городов и филиалов
- Эндпоинт получения списка городов
- Эндпоинт получения филиалов города
- Эндпоинт управления городами (для админов)
- Эндпоинт управления филиалами (для админов)

### 3.2 API меню
- Эндпоинт получения категорий меню по городу
- Эндпоинт получения позиций меню
- Эндпоинт получения модификаторов позиции
- Эндпоинт создания/редактирования категорий
- Эндпоинт создания/редактирования позиций
- Эндпоинт создания/редактирования модификаторов
- Загрузка изображений для позиций меню

### 3.3 API полигонов доставки
- Эндпоинт получения полигонов по городу/филиалу
- Эндпоинт проверки попадания адреса в зону доставки (PostGIS)
- Эндпоинт управления полигонами (для админов)

---

## Этап 4. Backend: Заказы

### 4.1 API корзины и оформления заказа
- Эндпоинт расчёта стоимости заказа
- Эндпоинт валидации состава заказа
- Эндпоинт создания заказа (доставка)
- Эндпоинт создания заказа (самовывоз)
- Генерация 4-значного номера заказа
- Применение бонусов к заказу

### 4.2 API управления заказами
- Эндпоинт получения списка заказов (для клиента)
- Эндпоинт получения детальной информации о заказе
- Эндпоинт получения истории заказов
- Эндпоинт повторения заказа

### 4.3 API заказов для админ-панели
- Эндпоинт получения списка всех заказов с фильтрами
- Эндпоинт изменения статуса заказа
- Эндпоинт получения статистики по заказам

---

## Этап 5. Backend: Программа лояльности

### 5.1 Логика бонусной программы
- Реализация правил начисления бонусов
- Реализация правил списания бонусов
- Расчёт доступных к использованию бонусов

### 5.2 API бонусов
- Эндпоинт получения баланса бонусов
- Эндпоинт получения истории операций с бонусами
- Обработка бонусов при создании заказа

---

## Этап 6. Backend: Система синхронизации

### 6.1 Модуль интеграции с "Гуляш"
- Создание клиента для API системы "Гуляш"
- Реализация методов отправки заказов
- Реализация методов синхронизации клиентов
- Реализация методов синхронизации бонусов
- Реализация методов получения меню
- Реализация методов получения полигонов

### 6.2 Очередь синхронизации на BullMQ
- Настройка BullMQ с Redis
- Создание очереди для заказов
- Создание очереди для клиентов
- Создание очереди для бонусных операций
- Реализация обработчиков очередей
- Реализация логики повторных попыток с экспоненциальной задержкой

### 6.3 Offline-first логика
- Локальное сохранение всех операций
- Автоматическая постановка в очередь при недоступности "Гуляша"
- Обработка конфликтов при синхронизации
- Сохранение статуса синхронизации для каждой операции

### 6.4 API управления синхронизацией
- Эндпоинт просмотра очереди синхронизации
- Эндпоинт просмотра ошибок синхронизации
- Эндпоинт ручного запуска синхронизации
- Эндпоинт повторной отправки неуспешных операций

---

## Этап 7. Backend: WebSocket для real-time обновлений

### 7.1 WebSocket сервер
- Настройка WebSocket сервера
- Реализация аутентификации WebSocket соединений
- Создание комнат для групповых обновлений

### 7.2 События в реальном времени
- Отправка уведомлений о новых заказах
- Отправка обновлений статуса заказов
- Отправка обновлений баланса бонусов
- Отправка уведомлений об ошибках синхронизации

---

## Этап 8. Backend: Логирование и аудит

### 8.1 Система логирования
- Логирование всех операций с заказами
- Логирование действий администраторов
- Логирование попыток синхронизации
- Логирование ошибок

### 8.2 API логов
- Эндпоинт получения логов действий администраторов
- Эндпоинт получения логов синхронизации
- Фильтрация и поиск по логам

---

## Этап 9. Telegram Mini App: Базовая структура

### 9.1 Настройка проекта
- Инициализация Vue.js приложения
- Настройка Pinia store
- Настройка Axios с interceptors
- Интеграция Telegram Mini App SDK
- Настройка Shadcn UI компонентов

### 9.2 Базовая навигация
- Создание роутинга приложения
- Главный экран
- Экран меню
- Экран корзины
- Экран профиля
- Экран истории заказов

---

## Этап 10. Telegram Mini App: Авторизация

### 10.1 Процесс авторизации
- Экран запроса номера телефона
- Интеграция с Telegram для получения контакта
- Отправка данных на backend
- Сохранение токена авторизации
- Обработка состояния авторизации в Pinia

### 10.2 Управление профилем
- Экран просмотра профиля
- Форма редактирования данных пользователя
- Управление адресами доставки

---

## Этап 11. Telegram Mini App: Выбор города и филиала

### 11.1 Определение местоположения
- Запрос геолокации пользователя
- Определение города по координатам
- Отображение списка городов

### 11.2 Выбор филиала
- Экран выбора филиала в городе
- Сохранение выбора в локальном хранилище
- Отображение текущего филиала

---

## Этап 12. Telegram Mini App: Меню

### 12.1 Отображение меню
- Список категорий меню
- Список позиций в категории
- Карточка позиции с модификаторами
- Отображение изображений позиций
- Поиск по меню

### 12.2 Кеширование меню
- Сохранение меню в Pinia store
- Обновление меню при изменении города
- Offline доступ к меню

---

## Этап 13. Telegram Mini App: Корзина и заказ

### 13.1 Управление корзиной
- Добавление позиций в корзину
- Изменение количества
- Удаление позиций
- Добавление модификаторов
- Расчёт итоговой суммы
- Применение бонусов

### 13.2 Оформление заказа
- Экран выбора типа заказа (доставка/самовывоз)
- Форма доставки с вводом адреса
- Форма самовывоза с выбором филиала
- Выбор времени выполнения
- Выбор способа оплаты
- Поле комментария к заказу
- Подтверждение заказа

### 13.3 Валидация и отправка
- Валидация данных заказа
- Проверка адреса на попадание в зону доставки
- Отправка заказа на backend
- Обработка ответа и ошибок
- Очистка корзины после успешного заказа

---

## Этап 14. Telegram Mini App: Программа лояльности

### 14.1 Отображение бонусов
- Виджет баланса бонусов на главном экране
- Экран детальной информации о бонусах
- История операций с бонусами

### 14.2 Использование бонусов
- Применение бонусов при оформлении заказа
- Расчёт максимальной суммы к списанию
- Отображение экономии

---

## Этап 15. Telegram Mini App: История заказов

### 15.1 Список заказов
- Отображение списка всех заказов пользователя
- Фильтрация по статусу
- Группировка по датам

### 15.2 Детали заказа
- Экран детальной информации о заказе
- Отображение состава заказа
- Отображение адреса/филиала
- Отображение информации о бонусах
- Кнопка повторения заказа

---

## Этап 16. Telegram Mini App: Real-time обновления

### 16.1 WebSocket интеграция
- Подключение к WebSocket серверу
- Обработка событий обновления статуса заказа
- Обработка событий обновления баланса бонусов
- Переподключение при обрыве соединения

### 16.2 Уведомления
- Отображение уведомлений об изменении статуса заказа
- Обновление UI при получении событий

---

## Этап 17. Admin Panel: Базовая структура

### 17.1 Настройка проекта
- Инициализация Vue.js приложения
- Настройка Pinia store
- Настройка Axios с interceptors
- Настройка Shadcn UI компонентов
- Настройка адаптивной вёрстки

### 17.2 Система авторизации
- Экран входа для администраторов
- Проверка токена авторизации
- Обработка ролей и доступов

### 17.3 Базовая навигация
- Боковое меню навигации
- Главная панель
- Маршрутизация между разделами

---

## Этап 18. Admin Panel: Управление заказами

### 18.1 Список заказов
- Таблица всех заказов с фильтрами
- Фильтр по городу
- Фильтр по статусу
- Фильтр по дате
- Фильтр по типу заказа
- Поиск по номеру заказа

### 18.2 Карточка заказа
- Детальная информация о заказе
- Состав заказа
- Информация о клиенте
- Адрес доставки или филиал
- История изменения статуса
- Кнопки управления статусом

### 18.3 Real-time обновления
- WebSocket подключение
- Автоматическое обновление списка заказов
- Визуальное выделение новых заказов
- Звуковое уведомление о новом заказе
- Отметка офлайн-заказов

---

## Этап 19. Admin Panel: Управление клиентами

### 19.1 Список клиентов
- Таблица всех клиентов
- Поиск по номеру телефона
- Поиск по имени
- Фильтр по городу

### 19.2 Карточка клиента
- Контактные данные
- История заказов клиента
- Баланс бонусов
- История операций с бонусами
- Список адресов доставки

---

## Этап 20. Admin Panel: Управление меню

### 20.1 Категории меню
- Список категорий
- Создание категории
- Редактирование категории
- Удаление категории
- Изменение порядка категорий

### 20.2 Позиции меню
- Список позиций в категории
- Создание позиции
- Редактирование позиции
- Удаление позиции
- Загрузка изображений
- Управление доступностью позиции

### 20.3 Модификаторы
- Список модификаторов для позиции
- Создание модификатора
- Редактирование модификатора
- Удаление модификатора

---

## Этап 21. Admin Panel: Города и филиалы

### 21.1 Управление городами
- Список городов
- Создание города
- Редактирование города
- Деактивация города

### 21.2 Управление филиалами
- Список филиалов города
- Создание филиала
- Редактирование филиала
- Деактивация филиала
- Настройка времени работы

---

## Этап 22. Admin Panel: Полигоны доставки

### 22.1 Просмотр полигонов
- Интеграция карты (например, Leaflet или Mapbox)
- Отображение полигонов на карте
- Список полигонов с параметрами
- Информация о времени доставки

### 22.2 Управление полигонами
- Создание полигона на карте
- Редактирование границ полигона
- Настройка параметров доставки для полигона
- Удаление полигона

---

## Этап 23. Admin Panel: Синхронизация с "Гуляш"

### 23.1 Управление синхронизацией
- Экран очереди синхронизации
- Отображение количества задач в очереди
- Отображение статуса каждой задачи
- Кнопка ручного запуска синхронизации
- Повторная отправка неуспешных операций

### 23.2 Логи синхронизации
- Список попыток синхронизации
- Детали ошибок синхронизации
- Фильтр по типу операции
- Фильтр по статусу
- Экспорт логов

---

## Этап 24. Admin Panel: Аналитика

### 24.1 Дашборд
- Общая статистика по заказам
- Количество заказов за период
- Сумма заказов за период
- Популярные позиции меню
- Графики динамики заказов

### 24.2 Отчёты
- Отчёт по продажам по периодам
- Отчёт по филиалам
- Отчёт по способам оплаты
- Отчёт по типам заказов

---

## Этап 25. Admin Panel: Управление пользователями панели

### 25.1 Список пользователей
- Таблица администраторов и менеджеров
- Фильтр по роли
- Поиск по имени/email

### 25.2 Управление доступами
- Создание администратора/менеджера
- Редактирование данных пользователя
- Назначение роли
- Привязка к городам (для менеджеров)
- Деактивация пользователя

---

## Этап 26. Admin Panel: Уведомления

### 26.1 Браузерные уведомления
- Запрос разрешения на уведомления
- Отправка уведомления о новом заказе
- Отправка уведомления об ошибке синхронизации

### 26.2 Telegram уведомления
- Настройка Telegram бота для уведомлений
- Привязка Telegram аккаунтов сотрудников
- Отправка уведомлений в Telegram

---

## Этап 27. Admin Panel: Логи и аудит

### 27.1 Журнал действий
- Список действий администраторов
- Фильтр по пользователю
- Фильтр по типу действия
- Фильтр по дате
- Детальная информация о действии

### 27.2 Системные логи
- Просмотр системных логов
- Фильтр по уровню (info, warning, error)
- Поиск по логам

---

## Этап 28. Развёртывание production окружения

### 28.1 Подготовка VPS
- Настройка Linux сервера
- Установка Docker и Docker Compose
- Настройка firewall
- Настройка SSL сертификатов

### 28.2 Настройка базы данных
- Развёртывание MySQL с PostGIS
- Настройка резервного копирования
- Оптимизация производительности
- Миграция схемы БД

### 28.3 Настройка Redis
- Развёртывание Redis
- Настройка persistence
- Настройка безопасности

### 28.4 Развёртывание Backend
- Создание Docker образа для Backend
- Настройка pm2 для управления процессами
- Настройка переменных окружения
- Запуск BullMQ workers

### 28.5 Развёртывание Frontend приложений
- Сборка Telegram Mini App в production режиме
- Сборка Admin Panel в production режиме
- Настройка Apache для раздачи статики
- Настройка проксирования запросов к API

### 28.6 Настройка WebSocket
- Настройка WebSocket сервера на production
- Настройка Apache для проксирования WebSocket
- Тестирование подключений

---

## Этап 29. Финальная интеграция и тестирование

### 29.1 Интеграция с системой "Гуляш"
- Получение доступов к API "Гуляша"
- Настройка реальных эндпоинтов
- Тестирование отправки заказов
- Тестирование синхронизации клиентов
- Тестирование бонусной программы
- Тестирование получения меню
- Тестирование получения полигонов

### 29.2 Сквозное тестирование
- Тестирование полного цикла создания заказа
- Тестирование работы в offline режиме
- Тестирование синхронизации после восстановления связи
- Тестирование программы лояльности
- Тестирование real-time обновлений
- Тестирование работы ролей и доступов

### 29.3 Нагрузочное тестирование
- Тестирование производительности API
- Тестирование работы очередей при большом количестве задач
- Тестирование WebSocket соединений
- Оптимизация узких мест

---

## Этап 30. Запуск и поддержка

### 30.1 Подготовка к запуску
- Финальная проверка всех функций
- Подготовка инструкций для персонала
- Обучение администраторов и менеджеров
- Подготовка резервных копий

### 30.2 Мягкий запуск
- Запуск для ограниченной группы пользователей
- Мониторинг работы системы
- Сбор обратной связи
- Исправление критических ошибок

### 30.3 Полный запуск
- Открытие доступа для всех пользователей
- Мониторинг нагрузки
- Оперативное реагирование на проблемы
- Сбор метрик использования

---

## Примечания

Этапы 1-8 (Backend) и 9-16 (Mini App) могут разрабатываться параллельно разными разработчиками.

Этапы 17-27 (Admin Panel) можно начинать после завершения основных Backend функций.

Рекомендуется использовать feature-флаги для разделения MVP функционала и продакшен версии.

Важно документировать все API эндпоинты для синхронизации работы frontend и backend команд.
