# Техническое задание (ТЗ)

## 1. Общая информация

### 1.1 Назначение документа

Данный документ описывает полное техническое задание на разработку системы онлайн-заказа еды, включающей:

- Telegram Mini App для клиентов
- Веб-приложение с админ-панелью
- Backend-систему
- Механизм синхронизации с внешней системой управления заказами «Гуляш»

Документ предназначен для:

- презентации руководству
- оценки объёма и сложности проекта
- основы для разработки, планирования и декомпозиции задач

---

### 1.2 Цели проекта

- Создать единый клиентский канал заказов через Telegram
- Обеспечить стабильную работу даже при недоступности системы «Гуляш»
- Синхронизировать данные между Mini App, админ-панелью и «Гуляшом»
- Реализовать программу лояльности
- Обеспечить масштабируемость и готовность к продакшену

---

## 2. Архитектура системы

### 2.1 Общая схема

```
[Telegram Mini App]
        |
        v
[Backend API (Node.js + Express)]
        |
        +--> [MySQL Database]
        |
        +--> [WebSocket Server]
        |
        +--> [Sync Module]
                    |
                    v
               [Система Гуляш]

[Admin Panel (Web)] ----^
```

---

### 2.2 Технологический стек

#### Frontend

- Vue.js
- Shadcn UI
- Telegram Mini App SDK

#### Backend

- Node.js
- Express.js
- WebSocket (real-time обновления)

#### Database

- MySQL

#### Инфраструктура

- VPS
- Linux
- Apache
- pm2

---

## 3. Telegram Mini App (Клиентская часть)

### 3.1 Общие положения

Telegram Mini App является основным клиентским интерфейсом системы. Пользователь взаимодействует с приложением внутри Telegram без необходимости установки отдельного мобильного приложения. Mini App предназначен для оформления заказов, просмотра меню, участия в программе лояльности и просмотра истории заказов.

Приложение проектируется с учётом offline-first подхода и должно корректно работать при временной недоступности внешней системы «Гуляш».

---

### 3.2 Авторизация пользователя

Авторизация пользователя осуществляется автоматически через Telegram с использованием механизма передачи контакта.

**Логика работы:**

- Пользователю предлагается кнопка «Поделиться номером телефона»
- Telegram передаёт номер телефона в Mini App
- Номер телефона становится уникальным идентификатором пользователя в системе

**Ограничения:**

- Без передачи номера телефона пользователь может просматривать меню и информацию
- Оформление заказа и использование бонусов недоступны

**Хранимые данные пользователя:**

- номер телефона
- имя
- фамилия
- дата рождения
- email

Дополнительные данные используются исключительно для передачи в систему «Гуляш».

---

### 3.3 Определение города и филиала

При первом запуске Mini App выполняется попытка определения города пользователя.

**Алгоритм:**

1. Запрос геолокации у пользователя
2. При успешном получении — определение города
3. При отказе — отображение списка доступных городов

После выбора города пользователь вручную выбирает филиал (ресторан).

Источник данных по городам и филиалам — система «Гуляш». Данные кешируются локально.

---

### 3.4 Меню

Меню отображается в разрезе выбранного города.

**Структура меню:**

- категории
- позиции
- модификаторы

Каждая позиция может содержать:

- название
- описание
- цену
- изображение
- набор модификаторов

**MVP:**

- меню создаётся и редактируется локально через админ-панель

**Продакшен:**

- меню поступает из системы «Гуляш»
- редактирование недоступно (read-only)

---

### 3.5 Корзина и оформление заказа

Пользователь может добавить позиции меню в корзину и оформить заказ.

**Поддерживаемые типы заказа:**

- доставка
- самовывоз

**Общие параметры заказа:**

- список позиций и модификаторов
- сумма заказа
- использование бонусов
- изменение количество позиций, удаление позиций
- комментарий к заказу
- желаемое время выполнения (только текущий день)

По умолчанию используется значение «как можно скорее».

---

### 3.6 Доставка

При выборе доставки пользователю предлагается примерный адрес исходя из геолокации, после чего он указывает адрес.

**Форма адреса:**

- улица
- дом
- подъезд
- квартира
- домофон
- комментарий

Адреса сохраняются в профиле пользователя. Поддерживается несколько адресов, один из которых может быть выбран по умолчанию.

Проверка попадания адреса в зону доставки выполняется на основе локально сохранённых полигонов.

---

### 3.7 Самовывоз

При выборе самовывоза пользователь:

- использует ранее выбранный город
- выбирает филиал
- указывает время получения заказа

---

### 3.8 Оплата

Оплата производится при получении заказа.

**Поддерживаемые способы:**

- наличные (с указанием купюры для сдачи)
- банковская карта

Онлайн-оплата в рамках текущего ТЗ не реализуется.

---

### 3.9 Программа лояльности

Программа лояльности полностью повторяет логику системы «Гуляш».

**Особенности:**

- баланс бонусов кешируется локально
- начисление и списание выполняются даже при недоступности «Гуляша»
- при восстановлении связи данные синхронизируются

---

### 3.10 История заказов

Пользователь имеет доступ к истории своих заказов.

**Список заказов содержит:**

- дату
- 4-значный номер заказа
- сумму
- тип заказа

**Карточка заказа содержит:**

- состав заказа
- адрес или филиал
- способ оплаты
- информацию о бонусах

Дополнительно доступна функция повторного оформления заказа.

---

## 4. Админ-панель

### 4.1 Назначение админ-панели

Админ-панель является рабочим инструментом персонала и управляющего состава. В условиях недоступности системы «Гуляш» админ-панель становится **единственным источником информации о заказах** и используется для фактической работы кухни и менеджеров.

Админ-панель реализуется как веб-приложение и работает в режиме реального времени.

---

### 4.2 Роли и доступы

**Администратор**

- просматривает аналитику и заказы по всем городам (меняя в фильтре)
- настраивает систему, меняет настройки
- управляет пользователями (админами и менеджерами)
- просматривает полигоны доставки
- редактирует меню (MVP: локально)
- синхронизирует данные с «Гуляшем»
- просматривает очередь синхронизации и ошибки
- ведёт аудит действий админов

**Менеджер**

- доступ только к своим городам
- просматривает аналитику и заказы по своим городам
- редактирует меню (MVP: локально)
- просматривает полигоны доставки

**CEO**

- просмотр всех городов без технических разделов
- доступ к аналитике и заказам по всем городам
- просмотр полигона доставки
- редактирует меню (MVP: локально)
- просматривает очередь синхронизации и ошибки
- синхронизирует данные с «Гуляшем»

---

### 4.3 Работа с заказами

Админ-панель отображает список заказов в режиме реального времени.

**Функциональность:**

- автоматическое обновление списка заказов
- визуальное выделение новых заказов
- отображение офлайн-заказов

При недоступности «Гуляша» заказы принимаются и отображаются в админ-панели, после восстановления связи статусы синхронизируются.

---

### 4.4 Уведомления

При поступлении нового заказа:

- звуковое уведомление в браузере
- визуальный индикатор
- Telegram-уведомление ответственным сотрудникам

---

### 4.5 Клиенты

Раздел клиентов содержит:

- список пользователей
- контактные данные
- историю заказов
- бонусный баланс

---

### 4.6 Полигоны доставки

Раздел предназначен для просмотра зон доставки.

**Отображается:**

- карта с полигонами
- параметры зоны
- последнее известное время доставки

Редактирование недоступно.

---

### 4.7 Логи и синхронизация

В системе ведётся расширенное логирование:

- действия администраторов
- ошибки синхронизации
- история попыток отправки данных в «Гуляш»

Предусмотрен экран очереди синхронизации.

---

## 5. Backend и синхронизация

### 5.1 Общая логика

Backend реализует offline-first подход. Все критичные данные сохраняются локально и синхронизируются при восстановлении связи.

### 5.2 Очередь синхронизации

Все операции, требующие отправки в «Гуляш», попадают в очередь:

- создание заказов
- операции с бонусами
- создание клиентов

Очередь поддерживает автоматические повторы с увеличивающимся интервалом.

---

## 6. Диаграммы логики

### 6.1 Оформление заказа в офлайне

```
Пользователь → Mini App → Backend → БД (локально)
                         ×
                      Гуляш
```

### 6.2 Синхронизация

```
Очередь → Гуляш → Успех / Ошибка
```

---

## 7. Нефункциональные требования

- отказоустойчивость
- масштабируемость
- real-time обновления
- соответствие 152-ФЗ

---

## 8. Рекомендации

- использовать feature-флаги для MVP
- документировать API контракты
- готовить систему к росту нагрузки

---

## 9. Заключение

Данное техническое задание описывает полнофункциональную систему онлайн-заказа еды, ориентированную на стабильную работу, масштабируемость и удобство использования как клиентами, так и персоналом.
