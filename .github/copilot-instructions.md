# FoodMiniApp - Инструкции для AI-агентов

## Язык и документация

- **Весь код, комментарии, коммиты и документация пишутся на русском языке**
- Перед выполнением задачи всегда читай существующую документацию (`README.md`, `docs/`, `TASKS.md`)
- Комментируй только важные блоки кода, не каждую строку
- Запрещено использовать сторонние библиотеки без одобрения пользователя
- Документация Tailwind CSS: https://tailwindcss.com/docs
- Документация Shadcn UI: https://ui.shadcn.com/docs
- Иконки Lucide: https://lucide.dev/guide/packages/lucide-vue-next
- Документация по Vue 3: https://vuejs.org/guide/introduction.html

## Архитектура проекта

Монорепозиторий из трёх основных компонентов:

### Backend (`backend/`)

- **Стек**: Node.js (Express), MySQL 8.0, Redis, BullMQ
- **Паттерн**: REST API + WebSocket для реального времени
- **Структура**: `/src/routes` → `/src/services` → `/src/utils`
- **Workers**: BullMQ воркеры в `/src/workers` для фоновых задач (истечение бонусов, пересчёт уровней, birthday-бонусы)

### Admin Panel (`admin-panel/`)

- **Стек**: Vue 3 + Vite + Tailwind CSS
- **Иконки**: **Только `lucide-vue-next`** (запрещено использовать другие)
- **Компоненты UI**: Shadcn UI
- **Стор**: Pinia (`/src/stores`)
- **Роутинг**: Vue Router с проверкой ролей (`admin`, `ceo`, `manager`)
- Всегда адаптивный дизайн для мобильных устройств
- Пагинация, фильтры и сортировка для таблиц с большим количеством данных
- Всегда придерживаться документации Tailwind и Shadcn UI при создании интерфейсов и придерживаться темной и светлой темы

### Telegram MiniApp (`telegram-miniapp/`)

- **Стек**: Vue 3 + Vite + Tailwind CSS
- **API**: Интеграция с backend через `/src/api/client.js`
- **Иконки**: **Только `lucide-vue-next`** (запрещено использовать другие)

### Миграции БД

**Обязательное правило**: при создании миграции **всегда** обновляй `backend/database/schema.sql`:

```bash
# 1. Создать файл миграции: backend/database/migrations/number_description.sql
# 2. Применить миграцию: cd backend && npm run migrate
# 3. Обновить schema.sql вручную с теми же изменениями
```

Миграции выполняются через `backend/src/scripts/migrate.js`, который отслеживает выполненные миграции в таблице `migrations`.

### Tailwind CSS

- **Всегда используй документацию Tailwind** для классов
- Не используй inline-стили без необходимости
- Создавай и переиспользуй компоненты с Shadcn UI

## Команды разработки

### Backend

```bash
cd backend
npm run dev          # Development с nodemon
npm start            # Production
npm run worker       # Запуск воркеров BullMQ
npm run migrate      # Применение миграций
npm run init-db      # Инициализация БД из schema.sql
```

### Frontend (Admin Panel / Telegram MiniApp)

```bash
cd admin-panel       # или telegram-miniapp
npm run dev          # Vite dev server
npm run build        # Production build
```

### Docker

```bash
docker-compose up -d        # Запуск MySQL + Redis + phpMyAdmin
docker-compose down         # Остановка
```

## Workflow задач

1. **Создай план**: Добавь `TASKS.md` с детальными шагами (для каждой задачи очищай сначала файл, если там уже все задачи были выполнены)
2. **Читай контекст**: Изучи связанные файлы перед изменениями
3. **Пиши чистый код**: Поддерживаемый, без избыточных комментариев
4. **Проверяй**: Тестируй изменения перед завершением
5. **Обновляй документацию**: Актуализируй `README.md` при добавлении функций, таблиц, эндпоинтов

## Ключевые файлы

- `backend/database/schema.sql` — актуальная схема БД (обновляется вместе с миграциями)
- `README.md` — подробная документация системы лояльности и всех модулей
- `docs/bonus.md` — полное техническое задание бонусной системы
- `docs/menu.md` — полное техническое задание управление меню
- `docs/doc.md` — полное техническое задание проекта

❌ **Запрещено**:

- Создавать лишние файлы после выполнения задачи
- Использовать иконки кроме `lucide-vue-next`
- Игнорировать обновление `schema.sql` при миграциях
- Комментировать каждую строку кода
- Запускать сервисы не проверяя запущены они или нет
- Нельзя открывать терминалы каждый раз при запуске команды

✅ **Хорошие практики**:

- Сначала проверяй выводы всех доступных терминалов, если сервис не запущен, потом запускай
- Команды в терминале всегда выполняй из корневой папки соответствующего сервиса
- Всегд придерживаться технической документации и не импровизировать без согласования
- Пиши лаконичные и понятные коммиты, отражающие суть изменений
- If code file more than 500 lines split it into several files logically;
